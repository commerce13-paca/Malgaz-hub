<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Malgaz Hub - R√©seau Social Premium</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #8B5CF6;
      --primary-dark: #7C3AED;
      --secondary: #10B981;
      --accent: #F59E0B;
      --danger: #EF4444;
      --warning: #F59E0B;
      --info: #3B82F6;
      --dark: #0F172A;
      --darker: #020617;
      --light: #F8FAFC;
      --gradient: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
      --glass: rgba(255, 255, 255, 0.08);
      --glass-border: rgba(255, 255, 255, 0.12);
      --shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      --neon-glow: 0 0 10px rgba(139, 92, 246, 0.7), 0 0 20px rgba(139, 92, 246, 0.5), 0 0 30px rgba(139, 92, 246, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
    }

    body {
      background: var(--darker);
      color: var(--light);
      line-height: 1.6;
      overflow-x: hidden;
      min-height: 100vh;
    }

    .app-container {
      max-width: 500px;
      margin: 0 auto;
      min-height: 100vh;
      background: var(--dark);
      position: relative;
      box-shadow: 0 0 100px rgba(139, 92, 246, 0.15);
      overflow: hidden;
    }

    .app-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(236, 72, 153, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(16, 185, 129, 0.05) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    .header {
      background: var(--gradient);
      padding: 20px;
      position: relative;
      overflow: hidden;
      box-shadow: var(--neon-glow);
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('https://images.unsplash.com/photo-1611162617474-5b21e879e113?w=500') center/cover;
      opacity: 0.2;
    }

    .header-content {
      position: relative;
      z-index: 2;
      text-align: center;
    }

    .logo {
      font-size: 28px;
      font-weight: 800;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-bottom: 10px;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    }

    .tagline {
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 15px;
    }

    .user-balance {
      background: rgba(255, 255, 255, 0.1);
      padding: 10px 15px;
      border-radius: 12px;
      margin-top: 10px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .nav-container {
      display: flex;
      background: var(--darker);
      border-bottom: 1px solid var(--glass-border);
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
    }

    .nav-tab {
      flex: 1;
      padding: 18px 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      border-bottom: 3px solid transparent;
      font-size: 13px;
      font-weight: 600;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      position: relative;
    }

    .nav-tab.active {
      border-bottom: 3px solid var(--primary);
      color: var(--primary);
      background: rgba(139, 92, 246, 0.05);
    }

    .nav-icon {
      font-size: 18px;
    }

    .notification-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      background: var(--danger);
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      box-shadow: 0 0 10px rgba(239, 68, 68, 0.7);
    }

    .content {
      padding: 0;
      position: relative;
      z-index: 1;
    }

    .section {
      display: none;
      animation: fadeIn 0.5s ease;
    }

    .section.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .card {
      background: var(--glass);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 20px;
      margin: 15px;
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
    }

    .card:hover {
      transform: translateY(-5px);
      border-color: rgba(139, 92, 246, 0.3);
      box-shadow: var(--shadow), var(--neon-glow);
    }

    .post {
      background: var(--glass);
      border-radius: 20px;
      padding: 0;
      margin: 15px;
      border: 1px solid var(--glass-border);
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
    }

    .post:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow), 0 0 15px rgba(139, 92, 246, 0.3);
    }

    .post-header {
      padding: 15px 20px;
      border-bottom: 1px solid var(--glass-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .post-user {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      background-size: cover;
      background-position: center;
      border: 2px solid var(--primary);
      position: relative;
      box-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
    }

    .user-info {
      display: flex;
      flex-direction: column;
    }

    .user-name {
      font-weight: 600;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .post-time {
      font-size: 12px;
      opacity: 0.7;
    }

    .post-content {
      padding: 20px;
    }

    .post-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 10px;
      color: var(--light);
    }

    .post-text {
      margin-bottom: 15px;
      line-height: 1.5;
    }

    .post-media {
      display: grid;
      gap: 10px;
      margin: 15px 0;
    }

    .post-image {
      width: 100%;
      border-radius: 12px;
      max-height: 400px;
      object-fit: cover;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .post-video {
      width: 100%;
      border-radius: 12px;
      max-height: 400px;
    }

    .post-actions {
      display: flex;
      gap: 0;
      border-top: 1px solid var(--glass-border);
    }

    .action-btn {
      flex: 1;
      padding: 15px;
      background: none;
      border: none;
      color: rgba(255, 255, 255, 0.7);
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-weight: 600;
    }

    .action-btn:hover {
      background: rgba(255, 255, 255, 0.05);
      color: white;
    }

    .action-btn.active {
      color: var(--primary);
      text-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
    }

    .earnings-badge {
      background: var(--secondary);
      color: white;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
    }

    .products-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      padding: 15px;
    }

    .product-card {
      background: var(--glass);
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid var(--glass-border);
      transition: all 0.3s ease;
    }

    .product-card:hover {
      transform: translateY(-5px);
      border-color: var(--primary);
      box-shadow: var(--shadow), 0 0 15px rgba(139, 92, 246, 0.3);
    }

    .product-image {
      width: 100%;
      height: 120px;
      object-fit: cover;
    }

    .product-info {
      padding: 12px;
    }

    .product-name {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 5px;
    }

    .product-price {
      color: var(--accent);
      font-weight: 700;
      font-size: 16px;
    }

    .buy-btn {
      width: 100%;
      padding: 10px;
      background: var(--gradient);
      border: none;
      color: white;
      font-weight: 600;
      border-radius: 8px;
      margin-top: 8px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
    }

    .buy-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(139, 92, 246, 0.7);
    }

    .upload-container {
      text-align: center;
      padding: 20px;
      border: 2px dashed var(--glass-border);
      border-radius: 12px;
      margin: 10px 0;
      cursor: pointer;
      transition: all 0.3s;
    }

    .upload-container:hover {
      border-color: var(--primary);
      background: rgba(139, 92, 246, 0.05);
      box-shadow: 0 0 15px rgba(139, 92, 246, 0.2);
    }

    .upload-icon {
      font-size: 48px;
      color: var(--primary);
      margin-bottom: 10px;
      text-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
    }

    .file-input {
      display: none;
    }

    .image-preview {
      width: 100%;
      max-height: 200px;
      object-fit: cover;
      border-radius: 12px;
      margin: 10px 0;
      display: none;
    }

    .comments-section {
      margin-top: 20px;
      border-top: 1px solid var(--glass-border);
      padding-top: 15px;
    }

    .comment {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }

    .comment-avatar {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      background: var(--gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 12px;
      background-size: cover;
      background-position: center;
      border: 1px solid var(--primary);
    }

    .comment-content {
      flex: 1;
    }

    .comment-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
    }

    .comment-author {
      font-weight: 600;
      font-size: 14px;
    }

    .comment-time {
      font-size: 12px;
      opacity: 0.7;
    }

    .comment-text {
      font-size: 14px;
      line-height: 1.4;
    }

    .comment-form {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .comment-input {
      flex: 1;
      padding: 10px 15px;
      border-radius: 20px;
      border: 1px solid var(--glass-border);
      background: rgba(15, 23, 42, 0.8);
      color: var(--light);
      font-size: 14px;
      transition: all 0.3s;
    }

    .comment-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 10px rgba(139, 92, 246, 0.3);
    }

    .comment-submit {
      padding: 10px 20px;
      background: var(--primary);
      border: none;
      border-radius: 20px;
      color: white;
      cursor: pointer;
      transition: all 0.3s;
    }

    .comment-submit:hover {
      background: var(--primary-dark);
      transform: scale(1.05);
    }

    .auth-form {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--darker);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .auth-card {
      background: var(--dark);
      border-radius: 24px;
      padding: 30px;
      width: 100%;
      max-width: 400px;
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow), var(--neon-glow);
      backdrop-filter: blur(20px);
    }

    .form-group {
      margin-bottom: 20px;
    }

    input, textarea, select {
      width: 100%;
      padding: 15px;
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      background: rgba(15, 23, 42, 0.8);
      color: var(--light);
      font-size: 16px;
      transition: all 0.3s;
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3);
    }

    .btn {
      padding: 15px 25px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      font-size: 16px;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--gradient);
      color: white;
      box-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(139, 92, 246, 0.7);
    }

    .btn-secondary {
      background: var(--glass);
      color: var(--light);
      border: 1px solid var(--glass-border);
    }

    .btn-block {
      width: 100%;
    }

    .hidden {
      display: none !important;
    }

    .fab {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      box-shadow: 0 8px 30px rgba(139, 92, 246, 0.4), var(--neon-glow);
      cursor: pointer;
      z-index: 1000;
      transition: all 0.3s;
    }

    .fab:hover {
      transform: scale(1.1);
      box-shadow: 0 10px 40px rgba(139, 92, 246, 0.6), 0 0 20px rgba(139, 92, 246, 0.8);
    }

    .badge {
      background: var(--primary);
      color: white;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      box-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
    }

    .badge-admin {
      background: var(--accent);
      box-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
    }

    .badge-new {
      background: var(--secondary);
      box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
    }

    .badge-premium {
      background: var(--gradient);
      box-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
    }

    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      backdrop-filter: blur(5px);
    }

    .modal-content {
      background: var(--dark);
      border-radius: 24px;
      padding: 30px;
      width: 100%;
      max-width: 500px;
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow), var(--neon-glow);
      max-height: 90vh;
      overflow-y: auto;
      backdrop-filter: blur(20px);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 700;
    }

    .close-btn {
      background: none;
      border: none;
      color: var(--light);
      font-size: 24px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .close-btn:hover {
      color: var(--primary);
      transform: scale(1.1);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin: 20px 0;
    }

    .stat-card {
      background: var(--glass);
      padding: 20px;
      border-radius: 16px;
      text-align: center;
      border: 1px solid var(--glass-border);
      transition: all 0.3s;
    }

    .stat-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .stat-number {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 5px;
      text-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
    }

    .stat-label {
      font-size: 12px;
      opacity: 0.7;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--secondary);
      color: white;
      padding: 15px 20px;
      border-radius: 12px;
      box-shadow: var(--shadow);
      z-index: 10000;
      max-width: 300px;
      font-weight: 600;
      animation: slideInRight 0.3s ease;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .notification.error {
      background: var(--danger);
    }

    .notification.warning {
      background: var(--warning);
    }

    .notification.info {
      background: var(--info);
    }

    @keyframes slideInRight {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: var(--primary);
    }

    .loading-spinner {
      font-size: 48px;
      margin-bottom: 15px;
      animation: spin 1s linear infinite;
      text-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .cart-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--danger);
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 10px rgba(239, 68, 68, 0.7);
    }

    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid var(--glass-border);
    }

    .cart-item:last-child {
      border-bottom: none;
    }

    .cart-item-info {
      flex: 1;
    }

    .cart-item-name {
      font-weight: 600;
    }

    .cart-item-price {
      color: var(--accent);
      font-size: 14px;
    }

    .cart-item-actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .quantity-btn {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      border: none;
      background: var(--glass);
      color: var(--light);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }

    .quantity-btn:hover {
      background: var(--primary);
      transform: scale(1.1);
    }

    .partnership-card {
      background: var(--glass);
      border-radius: 16px;
      padding: 20px;
      margin: 10px 0;
      border: 1px solid var(--glass-border);
      transition: all 0.3s;
    }

    .partnership-card.premium {
      border-color: var(--accent);
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
      box-shadow: 0 0 15px rgba(245, 158, 11, 0.3);
    }

    .partnership-card:hover {
      transform: translateY(-3px);
      border-color: var(--primary);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .partnership-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .partnership-price {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent);
    }

    .notifications-panel {
      position: fixed;
      top: 0;
      right: -400px;
      width: 380px;
      height: 100vh;
      background: var(--dark);
      border-left: 1px solid var(--glass-border);
      z-index: 2000;
      transition: right 0.3s ease;
      overflow-y: auto;
      backdrop-filter: blur(20px);
    }

    .notifications-panel.open {
      right: 0;
    }

    .notifications-header {
      padding: 20px;
      border-bottom: 1px solid var(--glass-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .notification-item {
      padding: 15px 20px;
      border-bottom: 1px solid var(--glass-border);
      cursor: pointer;
      transition: background 0.3s;
    }

    .notification-item:hover {
      background: var(--glass);
    }

    .notification-item.unread {
      background: rgba(59, 130, 246, 0.1);
    }

    .notification-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }

    .notification-icon.success { background: var(--secondary); }
    .notification-icon.warning { background: var(--warning); }
    .notification-icon.info { background: var(--info); }
    .notification-icon.earning { background: var(--accent); }
    .notification-icon.like { background: var(--primary); }
    .notification-icon.comment { background: var(--info); }
    .notification-icon.share { background: var(--secondary); }

    .tab-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .tab-btn {
      flex: 1;
      padding: 12px;
      background: var(--glass);
      border: 1px solid var(--glass-border);
      color: var(--light);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      font-weight: 600;
    }

    .tab-btn.active {
      background: var(--primary);
      border-color: var(--primary);
      box-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
    }

    .event-card, .product-management-card {
      background: var(--glass);
      border-radius: 16px;
      padding: 20px;
      margin: 10px 0;
      border: 1px solid var(--glass-border);
    }

    .event-image, .product-management-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 15px;
    }

    /* √âTOILE DE CERTIFICATION PREMIUM AM√âLIOR√âE */
    .premium-star {
      width: 28px;
      height: 28px;
      position: absolute;
      top: -5px;
      right: -5px;
      background: 
          radial-gradient(circle at 30% 30%, #64B5F6 0%, #1976D2 40%, #0D47A1 100%);
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 
          /* Ombre externe */
          0 2px 8px rgba(0, 0, 0, 0.4),
          0 0 20px rgba(33, 150, 243, 0.3),
          /* Reflets internes */
          inset 1px 1px 12px rgba(255, 255, 255, 0.8),
          inset -1px -1px 10px rgba(13, 71, 161, 0.6),
          /* Point de lumi√®re */
          inset 3px 3px 5px rgba(255, 255, 255, 0.4);
      z-index: 10;
      border: 2px solid var(--dark);
      animation: pulse 2s infinite;
    }

    .premium-star::before {
      content: '';
      position: absolute;
      width: 16px;
      height: 16px;
      background: 
          linear-gradient(135deg, #000 0%, #333 30%, #000 100%);
      clip-path: polygon(
          50% 0%, 
          61% 35%, 
          98% 35%, 
          68% 57%, 
          79% 91%, 
          50% 70%, 
          21% 91%, 
          32% 57%, 
          2% 35%, 
          39% 35%
      );
      filter: 
          drop-shadow(0 0 1px rgba(100, 181, 246, 0.6))
          drop-shadow(0 0 2px rgba(33, 150, 243, 0.3));
      transform: rotate(5deg);
    }

    .premium-star::after {
      content: '';
      position: absolute;
      width: 6px;
      height: 6px;
      background: 
          radial-gradient(circle, 
              rgba(255,255,255,0.9) 0%, 
              rgba(255,255,255,0.4) 70%, 
              transparent 100%);
      border-radius: 50%;
      top: 5px;
      left: 5px;
      filter: blur(0.3px);
      box-shadow: 0 0 3px rgba(255, 255, 255, 0.5);
    }

    /* Effet de brillance suppl√©mentaire */
    .premium-star .sparkle {
      position: absolute;
      width: 3px;
      height: 3px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 50%;
      top: 8px;
      right: 6px;
      filter: blur(0.2px);
      box-shadow: 0 0 2px rgba(255, 255, 255, 0.8);
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    /* NOUVEAUX STYLES POUR LES AM√âLIORATIONS */

    /* Interface admin am√©lior√©e */
    .admin-panel {
      background: var(--glass);
      border-radius: 20px;
      padding: 20px;
      margin: 15px;
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow);
    }

    .admin-section {
      display: none;
    }

    .admin-section.active {
      display: block;
    }

    .admin-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--glass-border);
      padding-bottom: 10px;
    }

    .admin-tab {
      padding: 10px 15px;
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .admin-tab.active {
      background: var(--primary);
      border-color: var(--primary);
    }

    .user-list {
      display: grid;
      gap: 15px;
    }

    .user-card {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px;
      background: var(--glass);
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      transition: all 0.3s;
    }

    .user-card:hover {
      transform: translateY(-3px);
      border-color: var(--primary);
    }

    .certification-controls {
      margin-left: auto;
      display: flex;
      gap: 10px;
    }

    /* Syst√®me d'abonnement */
    .follow-btn {
      padding: 8px 15px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .follow-btn:hover {
      background: var(--primary-dark);
      transform: scale(1.05);
    }

    .follow-btn.following {
      background: var(--secondary);
    }

    /* Section tendances */
    .trending-card {
      background: var(--glass);
      border-radius: 16px;
      padding: 15px;
      margin: 10px 0;
      border: 1px solid var(--glass-border);
      transition: all 0.3s;
    }

    .trending-card:hover {
      transform: translateY(-3px);
      border-color: var(--primary);
    }

    .trending-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .trending-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .trending-content {
      font-size: 14px;
    }

    .trending-stats {
      display: flex;
      gap: 15px;
      margin-top: 10px;
      font-size: 12px;
      opacity: 0.7;
    }

    /* Section stories */
    .stories-container {
      display: flex;
      gap: 10px;
      padding: 15px;
      overflow-x: auto;
    }

    .story {
      min-width: 80px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
      cursor: pointer;
    }

    .story-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      background-size: cover;
      background-position: center;
      border: 2px solid var(--primary);
      position: relative;
    }

    .story-avatar::after {
      content: '';
      position: absolute;
      top: -3px;
      left: -3px;
      right: -3px;
      bottom: -3px;
      border-radius: 50%;
      border: 2px solid var(--primary);
      animation: pulse 2s infinite;
    }

    .story-username {
      font-size: 12px;
      text-align: center;
      max-width: 80px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* Section recherche */
    .search-container {
      padding: 15px;
      position: sticky;
      top: 0;
      background: var(--dark);
      z-index: 10;
      border-bottom: 1px solid var(--glass-border);
    }

    .search-input {
      width: 100%;
      padding: 12px 20px;
      border-radius: 25px;
      border: 1px solid var(--glass-border);
      background: var(--glass);
      color: var(--light);
      font-size: 14px;
      transition: all 0.3s;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 10px rgba(139, 92, 246, 0.3);
    }

    @media (max-width: 500px) {
      .app-container {
        max-width: 100%;
      }
      
      .nav-tab {
        padding: 15px 8px;
        font-size: 12px;
      }
      
      .nav-icon {
        font-size: 16px;
      }
      
      .products-grid {
        grid-template-columns: 1fr;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .notifications-panel {
        width: 100%;
        right: -100%;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- HEADER -->
    <div class="header">
      <div class="header-content">
        <div class="logo">
          <i class="fas fa-crown"></i>
          MALGAZ HUB
        </div>
        <div class="tagline">R√©seau Social ‚Ä¢ E-commerce ‚Ä¢ Partenariats ‚Ä¢ Mon√©tisation</div>
        <div id="user-balance" class="user-balance hidden">
          <i class="fas fa-coins"></i>
          <span id="balance-amount">0.00 ‚Ç¨</span>
        </div>
      </div>
    </div>

    <!-- NAVIGATION -->
    <div class="nav-container">
      <div class="nav-tab active" data-tab="feed">
        <i class="fas fa-home nav-icon"></i>
        <span>Fil</span>
      </div>
      <div class="nav-tab" data-tab="shop">
        <i class="fas fa-store nav-icon"></i>
        <span>Boutique</span>
      </div>
      <div class="nav-tab" data-tab="cart">
        <i class="fas fa-shopping-cart nav-icon"></i>
        <span>Panier</span>
        <div id="cart-badge" class="cart-badge hidden">0</div>
      </div>
      <div class="nav-tab" data-tab="partnerships">
        <i class="fas fa-handshake nav-icon"></i>
        <span>Partenariats</span>
      </div>
      <div class="nav-tab" data-tab="profile">
        <i class="fas fa-user nav-icon"></i>
        <span>Profil</span>
        <div id="notification-badge" class="notification-badge hidden">0</div>
      </div>
    </div>

    <!-- CONTENU PRINCIPAL -->
    <div class="content">
      <!-- FIL D'ACTUALIT√â -->
      <div id="feed" class="section active">
        <!-- Stories -->
        <div class="stories-container" id="stories-container">
          <!-- Stories g√©n√©r√©es dynamiquement -->
        </div>

        <!-- Section recherche -->
        <div class="search-container">
          <input type="text" class="search-input" placeholder="üîç Rechercher des publications, personnes, produits..." id="search-input">
        </div>

        <div id="feed-content">
          <!-- Posts g√©n√©r√©s dynamiquement -->
        </div>
      </div>

      <!-- BOUTIQUE -->
      <div id="shop" class="section">
        <div class="card">
          <h2 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-tshirt"></i>Boutique Malgaz
          </h2>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-number" id="total-products">0</div>
              <div class="stat-label">Produits</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="total-sales">0</div>
              <div class="stat-label">Ventes</div>
            </div>
          </div>
          <div class="products-grid" id="products-content">
            <!-- Produits g√©n√©r√©s dynamiquement -->
          </div>
        </div>
      </div>

      <!-- PANIER -->
      <div id="cart" class="section">
        <div class="card">
          <h2 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-shopping-cart"></i>Mon Panier
          </h2>
          <div id="cart-content">
            <!-- Contenu du panier g√©n√©r√© dynamiquement -->
          </div>
          <div id="cart-total" class="hidden" style="margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--glass-border);">
            <div style="display: flex; justify-content: space-between; font-weight: 600; font-size: 18px;">
              <span>Total:</span>
              <span id="total-amount">0.00 ‚Ç¨</span>
            </div>
            <button class="btn btn-primary btn-block" style="margin-top: 15px;" onclick="createOrder()">
              <i class="fas fa-credit-card"></i> Passer la commande
            </button>
          </div>
        </div>
      </div>

      <!-- PARTENARIATS -->
      <div id="partnerships" class="section">
        <div class="card">
          <h2 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-crown"></i>Programme de Partenariats
          </h2>
          <div id="partnerships-content">
            <!-- Partenariats g√©n√©r√©s dynamiquement -->
          </div>
        </div>
      </div>

      <!-- PROFIL -->
      <div id="profile" class="section">
        <div class="card">
          <div id="profile-content">
            <!-- Contenu du profil g√©n√©r√© dynamiquement -->
          </div>
        </div>

        <!-- Section Admin (visible uniquement pour les administrateurs) -->
        <div id="admin-panel" class="admin-panel hidden">
          <h2 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-crown"></i>Panneau d'Administration
          </h2>
          
          <div class="admin-tabs">
            <div class="admin-tab active" data-tab="users">Utilisateurs</div>
            <div class="admin-tab" data-tab="content">Contenu</div>
            <div class="admin-tab" data-tab="certifications">Certifications</div>
            <div class="admin-tab" data-tab="analytics">Analytiques</div>
          </div>
          
          <div id="admin-users" class="admin-section active">
            <h3 style="margin-bottom: 15px;">Gestion des Utilisateurs</h3>
            <div class="user-list" id="admin-users-list">
              <!-- Liste des utilisateurs pour l'admin -->
            </div>
          </div>
          
          <div id="admin-content" class="admin-section">
            <h3 style="margin-bottom: 15px;">Gestion du Contenu</h3>
            <div id="admin-content-list">
              <!-- Liste du contenu pour l'admin -->
            </div>
          </div>
          
          <div id="admin-certifications" class="admin-section">
            <h3 style="margin-bottom: 15px;">Gestion des Certifications</h3>
            <div id="admin-certifications-list">
              <!-- Liste des certifications pour l'admin -->
            </div>
          </div>
          
          <div id="admin-analytics" class="admin-section">
            <h3 style="margin-bottom: 15px;">Analytiques</h3>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-number" id="admin-total-users">0</div>
                <div class="stat-label">Utilisateurs</div>
              </div>
              <div class="stat-card">
                <div class="stat-number" id="admin-total-posts">0</div>
                <div class="stat-label">Publications</div>
              </div>
              <div class="stat-card">
                <div class="stat-number" id="admin-total-products">0</div>
                <div class="stat-label">Produits</div>
              </div>
              <div class="stat-card">
                <div class="stat-number" id="admin-total-revenue">0</div>
                <div class="stat-label">Revenus (‚Ç¨)</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- BOUTON FLOATING POUR CR√âER UN POST -->
    <div class="fab hidden" id="create-fab">
      <i class="fas fa-plus"></i>
    </div>

    <!-- BOUTON NOTIFICATIONS -->
    <div class="fab hidden" id="notifications-fab" style="bottom: 100px; background: var(--info);">
      <i class="fas fa-bell"></i>
      <div id="floating-notification-badge" class="notification-badge hidden">0</div>
    </div>

    <!-- FORMULAIRE AUTH -->
    <div id="auth-modal" class="auth-form">
      <div class="auth-card">
        <h2 style="text-align: center; margin-bottom: 30px; display: flex; align-items: center; justify-content: center; gap: 10px;">
          <i class="fas fa-rocket"></i>Malgaz Hub
        </h2>
        
        <div id="login-form">
          <div class="form-group">
            <input id="login-user" placeholder="Nom d'utilisateur" />
          </div>
          <div class="form-group">
            <input id="login-pass" type="password" placeholder="Mot de passe" />
          </div>
          
          <button class="btn btn-primary btn-block" onclick="login()">
            <i class="fas fa-sign-in-alt"></i> Se connecter
          </button>
          
          <div style="text-align: center; margin-top: 20px; font-size: 14px; opacity: 0.7;">
            Pas de compte ? <a href="#" onclick="showRegisterForm()" style="color: var(--primary);">S'inscrire</a>
          </div>
          
          <div style="text-align: center; margin-top: 10px; font-size: 14px; opacity: 0.7;">
            <a href="#" onclick="showForgotPasswordForm()" style="color: var(--primary);">Mot de passe oubli√© ?</a>
          </div>
        </div>

        <div id="register-form" class="hidden">
          <div class="form-group">
            <input id="register-username" placeholder="Nom d'utilisateur" />
          </div>
          <div class="form-group">
            <input id="register-email" type="email" placeholder="Email" />
          </div>
          <div class="form-group">
            <input id="register-password" type="password" placeholder="Mot de passe" />
          </div>
          
          <button class="btn btn-primary btn-block" onclick="register()">
            <i class="fas fa-user-plus"></i> S'inscrire
          </button>
          
          <div style="text-align: center; margin-top: 20px; font-size: 14px; opacity: 0.7;">
            D√©j√† un compte ? <a href="#" onclick="showLoginForm()" style="color: var(--primary);">Se connecter</a>
          </div>
        </div>

        <div id="forgot-password-form" class="hidden">
          <div class="form-group">
            <input id="forgot-email" placeholder="Email" />
          </div>
          
          <button class="btn btn-primary btn-block" onclick="resetPassword()">
            <i class="fas fa-key"></i> R√©initialiser le mot de passe
          </button>
          
          <div style="text-align: center; margin-top: 20px; font-size: 14px; opacity: 0.7;">
            <a href="#" onclick="showLoginForm()" style="color: var(--primary);">Retour √† la connexion</a>
          </div>
        </div>
      </div>
    </div>

    <!-- MODAL CR√âATION POST/√âV√âNEMENT/PRODUIT -->
    <div id="create-modal" class="modal-backdrop hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title" id="create-modal-title">Cr√©er une publication</h2>
          <button class="close-btn" onclick="closeCreateModal()">&times;</button>
        </div>

        <div class="tab-buttons">
          <button class="tab-btn active" data-type="post">Publication</button>
          <button class="tab-btn" data-type="event">√âv√©nement</button>
          <button class="tab-btn" data-type="product">Produit</button>
        </div>
        
        <!-- FORMULAIRE PUBLICATION -->
        <div id="post-form" class="create-form active">
          <div class="form-group">
            <input type="text" id="post-title" placeholder="Titre de la publication" />
          </div>
          <div class="form-group">
            <textarea id="post-content" placeholder="Contenu de la publication" rows="4"></textarea>
          </div>
          
          <div class="upload-container" onclick="document.getElementById('post-media').click()">
            <i class="fas fa-cloud-upload-alt upload-icon"></i>
            <div>Ajouter des photos/vid√©os</div>
            <div style="font-size: 12px; opacity: 0.7; margin-top: 5px;">Cliquez pour s√©lectionner des fichiers</div>
          </div>
          
          <input type="file" id="post-media" class="file-input" multiple accept="image/*,video/*" onchange="previewPostMedia()" />
          <div id="media-preview" class="post-media"></div>
        </div>

        <!-- FORMULAIRE √âV√âNEMENT -->
        <div id="event-form" class="create-form hidden">
          <div class="form-group">
            <input type="text" id="event-title" placeholder="Titre de l'√©v√©nement" />
          </div>
          <div class="form-group">
            <textarea id="event-description" placeholder="Description de l'√©v√©nement" rows="3"></textarea>
          </div>
          <div class="form-group">
            <input type="date" id="event-date" />
          </div>
          <div class="form-group">
            <input type="time" id="event-time" />
          </div>
          <div class="form-group">
            <input type="text" id="event-location" placeholder="Lieu de l'√©v√©nement" />
          </div>
          <div class="form-group">
            <input type="text" id="event-price" placeholder="Prix (ex: 25,00 ‚Ç¨)" />
          </div>
          <div class="form-group">
            <input type="number" id="event-capacity" placeholder="Capacit√© maximum" />
          </div>
          
          <div class="upload-container" onclick="document.getElementById('event-image').click()">
            <i class="fas fa-image upload-icon"></i>
            <div>Ajouter une image pour l'√©v√©nement</div>
          </div>
          <input type="file" id="event-image" class="file-input" accept="image/*" onchange="previewEventImage()" />
          <div id="event-image-preview" class="post-media"></div>
        </div>

        <!-- FORMULAIRE PRODUIT -->
        <div id="product-form" class="create-form hidden">
          <div class="form-group">
            <input type="text" id="product-name" placeholder="Nom du produit" />
          </div>
          <div class="form-group">
            <textarea id="product-description" placeholder="Description du produit" rows="3"></textarea>
          </div>
          <div class="form-group">
            <input type="text" id="product-price" placeholder="Prix (ex: 29,99 ‚Ç¨)" />
          </div>
          <div class="form-group">
            <input type="number" id="product-stock" placeholder="Quantit√© en stock" />
          </div>
          
          <div class="upload-container" onclick="document.getElementById('product-image').click()">
            <i class="fas fa-image upload-icon"></i>
            <div>Ajouter une image du produit</div>
          </div>
          <input type="file" id="product-image" class="file-input" accept="image/*" onchange="previewProductImage()" />
          <div id="product-image-preview" class="post-media"></div>
        </div>
        
        <button class="btn btn-primary btn-block" onclick="createContent()">
          <i class="fas fa-paper-plane"></i> Publier
        </button>
      </div>
    </div>

    <!-- MODAL COMMANDE -->
    <div id="order-modal" class="modal-backdrop hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Finaliser la commande</h2>
          <button class="close-btn" onclick="closeOrderModal()">&times;</button>
        </div>
        
        <div class="form-group">
          <input type="text" id="shipping-address" placeholder="Adresse de livraison" />
        </div>
        <div class="form-group">
          <select id="payment-method">
            <option value="">S√©lectionnez le mode de paiement</option>
            <option value="mobile_money">Mobile Money</option>
            <option value="credit_card">Carte de cr√©dit</option>
            <option value="cash">Paiement √† la livraison</option>
          </select>
        </div>
        
        <div id="order-summary">
          <!-- R√©capitulatif de commande -->
        </div>
        
        <button class="btn btn-primary btn-block" onclick="confirmOrder()">
          <i class="fas fa-check"></i> Confirmer la commande
        </button>
      </div>
    </div>

    <!-- MODAL CHANGEMENT D'AVATAR -->
    <div id="avatar-modal" class="modal-backdrop hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Changer la photo de profil</h2>
          <button class="close-btn" onclick="closeAvatarModal()">&times;</button>
        </div>
        
        <div class="upload-container" onclick="document.getElementById('avatar-input').click()">
          <i class="fas fa-camera upload-icon"></i>
          <div>Choisir une photo</div>
          <div style="font-size: 12px; opacity: 0.7; margin-top: 5px;">Cliquez pour s√©lectionner une image</div>
        </div>
        
        <input type="file" id="avatar-input" class="file-input" accept="image/*" onchange="previewAvatar()" />
        
        <div id="avatar-preview" style="text-align: center; margin: 20px 0;">
          <div class="user-avatar" id="preview-avatar" style="width: 100px; height: 100px; margin: 0 auto; position: relative;">
            <!-- L'√©toile premium sera ajout√©e ici si l'utilisateur est premium -->
          </div>
        </div>
        
        <button class="btn btn-primary btn-block" onclick="saveAvatar()">
          <i class="fas fa-save"></i> Enregistrer la photo
        </button>
      </div>
    </div>

    <!-- PANEL NOTIFICATIONS -->
    <div id="notifications-panel" class="notifications-panel">
      <div class="notifications-header">
        <h3>Notifications</h3>
        <button class="close-btn" onclick="closeNotifications()">&times;</button>
      </div>
      <div id="notifications-list">
        <!-- Notifications g√©n√©r√©es dynamiquement -->
      </div>
      <div style="padding: 20px; text-align: center;">
        <button class="btn btn-secondary btn-block" onclick="markAllNotificationsAsRead()">
          <i class="fas fa-check-double"></i> Tout marquer comme lu
        </button>
      </div>
    </div>
  </div>

<script>
  // CONFIGURATION BACKEND
  const API_BASE_URL = 'http://localhost:3000/api';

  // √âtat de l'application
  let currentUser = null;
  let currentToken = null;
  let posts = [];
  let products = [];
  let events = [];
  let cart = [];
  let partnerships = [];
  let userStats = {};
  let notifications = [];
  let unreadNotifications = 0;
  let currentSection = 'feed';
  let likedPosts = new Set();
  let currentCreateType = 'post';
  let followers = [];
  let following = [];
  let stories = [];
  let trending = [];

  // DONN√âES PAR D√âFAUT
  const defaultData = {
    posts: [
      {
        id: 1,
        title: "üéâ Bienvenue sur Malgaz Hub !",
        content: "D√©couvrez notre plateforme innovante qui combine r√©seau social, e-commerce et mon√©tisation. Partagez vos passions, vendez vos produits et d√©veloppez votre communaut√© !",
        user_username: "Admin",
        user_avatar: "",
        created_at: new Date().toISOString(),
        likes: 24,
        comments_count: 3,
        shares: 5,
        earnings: 8.50,
        media: [],
        comments: [
          {
            id: 1,
            author: "Marie",
            avatar: "",
            text: "Super plateforme ! L'interface est magnifique üëè",
            created_at: new Date(Date.now() - 3600000).toISOString()
          },
          {
            id: 2,
            author: "Thomas",
            avatar: "",
            text: "J'adore le concept ! H√¢te de voir les fonctionnalit√©s üí´",
            created_at: new Date(Date.now() - 7200000).toISOString()
          }
        ]
      }
    ],
    products: [
      {
        id: 1,
        name: "T-shirt Malgaz Premium",
        description: "T-shirt 100% coton bio avec logo brod√© - Couleur noire",
        price: "29.99",
        stock: 50,
        image: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=300&h=300&fit=crop",
        sales: 15
      },
      {
        id: 2,
        name: "Casquette Malgaz",
        description: "Casquette ajustable avec logo brod√© - Taille unique",
        price: "19.99",
        stock: 30,
        image: "https://images.unsplash.com/photo-1588850561407-ed78c282e89b?w=300&h=300&fit=crop",
        sales: 8
      }
    ],
    events: [
      {
        id: 1,
        title: "üé™ Lancement Officiel Malgaz Hub",
        description: "Venez c√©l√©brer le lancement officiel de notre plateforme ! Au programme : d√©monstrations, goodies gratuits, rencontres avec l'√©quipe et surprises !",
        date: "2024-12-15",
        time: "18:00",
        location: "Espace Malgaz, 123 Avenue de la Innovation, Paris",
        price: "Gratuit",
        capacity: 150,
        attendees: 89,
        image: "",
        user_username: "Organisateur",
        user_avatar: "",
        created_at: new Date().toISOString()
      }
    ],
    partnerships: [
      {
        id: 1,
        title: "Partenaire Basique",
        price: 9.99,
        level: "basic",
        benefits: ["5% de commission sur les ventes", "Support standard", "Statistiques basiques", "Acc√®s √† la communaut√©"]
      },
      {
        id: 2,
        title: "Partenaire Premium",
        price: 29.99,
        level: "premium",
        benefits: ["15% de commission sur les ventes", "Support prioritaire 24/7", "Statistiques avanc√©es", "Badge Premium visible", "Acc√®s early aux nouvelles features"]
      }
    ],
    stories: [
      {
        id: 1,
        user_username: "Admin",
        user_avatar: "",
        created_at: new Date().toISOString(),
        media: "https://images.unsplash.com/photo-1611162617474-5b21e879e113?w=300&h=500&fit=crop",
        type: "image"
      },
      {
        id: 2,
        user_username: "Marie",
        user_avatar: "",
        created_at: new Date(Date.now() - 3600000).toISOString(),
        media: "https://images.unsplash.com/photo-1611162616305-c69b3fa7fbe0?w=300&h=500&fit=crop",
        type: "image"
      }
    ],
    trending: [
      {
        id: 1,
        title: "Nouvelle Collection √ât√©",
        content: "D√©couvrez la nouvelle collection d'√©t√© avec des designs exclusifs",
        hashtag: "#MalgazSummer",
        posts: 125,
        icon: "fas fa-sun"
      },
      {
        id: 2,
        title: "Concours Photo",
        content: "Participez √† notre concours photo et gagnez des prix exclusifs",
        hashtag: "#MalgazContest",
        posts: 89,
        icon: "fas fa-camera"
      }
    ]
  };

  // INITIALISATION
  document.addEventListener('DOMContentLoaded', function() {
    initializeApp();
  });

  function initializeApp() {
    setupNavigation();
    setupEventListeners();
    checkAuth();
    loadInitialData();
  }

  function setupEventListeners() {
    document.getElementById('create-fab').addEventListener('click', openCreateModal);
    document.getElementById('notifications-fab').addEventListener('click', openNotifications);
    
    // Gestion des onglets de cr√©ation
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const type = this.getAttribute('data-type');
        switchCreateTab(type);
      });
    });

    // Gestion des onglets admin
    document.querySelectorAll('.admin-tab').forEach(tab => {
      tab.addEventListener('click', function() {
        const tabName = this.getAttribute('data-tab');
        switchAdminTab(tabName);
      });
    });

    // Recherche en temps r√©el
    document.getElementById('search-input').addEventListener('input', function() {
      searchContent(this.value);
    });
  }

  function switchCreateTab(type) {
    currentCreateType = type;
    
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.classList.remove('active');
    });
    document.querySelector(`[data-type="${type}"]`).classList.add('active');
    
    document.querySelectorAll('.create-form').forEach(form => {
      form.classList.add('hidden');
    });
    document.getElementById(`${type}-form`).classList.remove('hidden');
    
    const titles = {
      'post': 'Cr√©er une publication',
      'event': 'Cr√©er un √©v√©nement',
      'product': 'Cr√©er un produit'
    };
    document.getElementById('create-modal-title').textContent = titles[type];
  }

  function switchAdminTab(tabName) {
    document.querySelectorAll('.admin-tab').forEach(tab => {
      tab.classList.remove('active');
    });
    document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
    
    document.querySelectorAll('.admin-section').forEach(section => {
      section.classList.remove('active');
    });
    document.getElementById(`admin-${tabName}`).classList.add('active');
  }

  // FONCTIONS BACKEND
  async function makeRequest(endpoint, options = {}) {
    try {
      const response = await fetch(`${API_BASE_URL}${endpoint}`, {
        headers: {
          'Content-Type': 'application/json',
          'Authorization': currentToken ? `Bearer ${currentToken}` : '',
          ...options.headers
        },
        ...options
      });

      if (response.ok) {
        return await response.json();
      } else {
        throw new Error('Request failed');
      }
    } catch (error) {
      console.error('API request failed:', error);
      throw error;
    }
  }

  async function loadInitialData() {
    try {
      // Charger les posts
      const postsData = await makeRequest('/posts');
      posts = postsData.posts || [];
      
      // Charger les produits
      const productsData = await makeRequest('/products');
      products = productsData.products || [];
      
      // Charger les √©v√©nements
      const eventsData = await makeRequest('/events');
      events = eventsData.events || [];
      
      // Charger le panier
      if (currentUser) {
        const cartData = await makeRequest('/cart');
        cart = cartData.cart || [];
      }
      
      renderAll();
      showNotification('Donn√©es charg√©es avec succ√®s ‚úÖ', 'success');
    } catch (error) {
      // Fallback sur les donn√©es locales
      console.log('Backend non disponible, utilisation des donn√©es locales');
      loadLocalData();
      showNotification('Mode d√©monstration activ√© üîß', 'info');
    }
  }

  function loadLocalData() {
    posts = JSON.parse(localStorage.getItem('malgaz_posts')) || defaultData.posts;
    products = JSON.parse(localStorage.getItem('malgaz_products')) || defaultData.products;
    events = JSON.parse(localStorage.getItem('malgaz_events')) || defaultData.events;
    partnerships = defaultData.partnerships;
    notifications = JSON.parse(localStorage.getItem('malgaz_notifications')) || [];
    stories = JSON.parse(localStorage.getItem('malgaz_stories')) || defaultData.stories;
    trending = defaultData.trending;
    
    unreadNotifications = notifications.filter(n => !n.read).length;
    userStats = {
      posts: posts.filter(p => p.user_username === (currentUser?.username || 'Admin')).length,
      earnings: posts.reduce((sum, post) => sum + (post.earnings || 0), 0),
      sales: products.reduce((sum, product) => sum + (product.sales || 0), 0),
      followers: currentUser ? (currentUser.followers || Math.floor(Math.random() * 100) + 10) : 0,
      following: currentUser ? (currentUser.following || Math.floor(Math.random() * 50) + 5) : 0
    };
    
    renderAll();
  }

  function saveLocalData() {
    localStorage.setItem('malgaz_posts', JSON.stringify(posts));
    localStorage.setItem('malgaz_products', JSON.stringify(products));
    localStorage.setItem('malgaz_events', JSON.stringify(events));
    localStorage.setItem('malgaz_notifications', JSON.stringify(notifications));
    localStorage.setItem('malgaz_stories', JSON.stringify(stories));
    if (currentUser) {
      localStorage.setItem('malgaz_user', JSON.stringify(currentUser));
    }
  }

  // AUTHENTIFICATION
  async function register() {
    const username = document.getElementById('register-username').value;
    const email = document.getElementById('register-email').value;
    const password = document.getElementById('register-password').value;

    if (!username || !email || !password) {
      showNotification('Veuillez remplir tous les champs', 'error');
      return;
    }

    try {
      const data = await makeRequest('/auth/register', {
        method: 'POST',
        body: JSON.stringify({ username, email, password })
      });
      
      if (data.success) {
        handleLoginSuccess(data.token, data.user);
        showNotification(`Bienvenue ${username} ! üéâ`, 'success');
      }
    } catch (error) {
      // Fallback local
      handleLocalRegistration(username, email);
    }
  }

  async function login() {
    const username = document.getElementById('login-user').value;
    const password = document.getElementById('login-pass').value;

    if (!username || !password) {
      showNotification('Veuillez remplir tous les champs', 'error');
      return;
    }

    // COMPTE ADMIN SP√âCIAL - HOLDEST13
    if (username === 'HOLDEST13' && password === 'HOLDEST13') {
      handleAdminLogin();
      return;
    }

    try {
      const data = await makeRequest('/auth/login', {
        method: 'POST',
        body: JSON.stringify({ username, password })
      });
      
      if (data.success) {
        handleLoginSuccess(data.token, data.user);
        showNotification(`Content de vous revoir ${username} ! üëã`, 'success');
      }
    } catch (error) {
      // Fallback local
      handleLocalLogin(username);
    }
  }

  function resetPassword() {
    const email = document.getElementById('forgot-email').value;
    
    if (!email) {
      showNotification('Veuillez entrer votre email', 'error');
      return;
    }
    
    showNotification('Instructions de r√©initialisation envoy√©es √† ' + email, 'success');
    showLoginForm();
  }

  function showForgotPasswordForm() {
    document.getElementById('login-form').classList.add('hidden');
    document.getElementById('register-form').classList.add('hidden');
    document.getElementById('forgot-password-form').classList.remove('hidden');
  }

  function handleAdminLogin() {
    currentUser = {
      id: 1,
      username: 'HOLDEST13',
      email: 'holdest13@malgaz.com',
      role: 'admin',
      partnership_level: 'premium',
      balance: 250.75,
      avatar: '',
      followers: 1250,
      following: 45,
      certified: true
    };
    currentToken = 'admin-token';
    
    localStorage.setItem('token', currentToken);
    localStorage.setItem('user', JSON.stringify(currentUser));
    
    document.getElementById('auth-modal').classList.add('hidden');
    showCreateFab();
    showNotificationsFab();
    loadInitialData();
    
    // Notification de bienvenue pour l'admin
    notifications.unshift({
      id: Date.now(),
      title: "üëë Bienvenue Administrateur !",
      message: "Vous avez acc√®s √† toutes les fonctionnalit√©s d'administration",
      type: "success",
      read: false,
      created_at: new Date().toISOString()
    });
    unreadNotifications++;
    
    saveLocalData();
    renderNotifications();
    updateNotificationBadge();
    
    showNotification(`Bienvenue Administrateur HOLDEST13 ! üëë`, 'success');
  }

  function handleLoginSuccess(token, user) {
    currentToken = token;
    currentUser = user;
    
    localStorage.setItem('token', currentToken);
    localStorage.setItem('user', JSON.stringify(currentUser));
    
    document.getElementById('auth-modal').classList.add('hidden');
    showCreateFab();
    showNotificationsFab();
    loadInitialData();
    
    // Notification de bienvenue
    notifications.unshift({
      id: Date.now(),
      title: "üëã Bienvenue sur Malgaz Hub !",
      message: "D√©couvrez toutes les fonctionnalit√©s de notre plateforme",
      type: "success",
      read: false,
      created_at: new Date().toISOString()
    });
    unreadNotifications++;
    
    saveLocalData();
    renderNotifications();
    updateNotificationBadge();
  }

  function handleLocalRegistration(username, email) {
    currentUser = {
      id: Date.now(),
      username: username,
      email: email,
      role: 'user',
      partnership_level: 'basic',
      balance: 0,
      avatar: '',
      followers: Math.floor(Math.random() * 20) + 5,
      following: Math.floor(Math.random() * 10) + 2,
      certified: false
    };
    currentToken = 'demo-token';
    
    localStorage.setItem('token', currentToken);
    localStorage.setItem('user', JSON.stringify(currentUser));
    
    document.getElementById('auth-modal').classList.add('hidden');
    showCreateFab();
    showNotificationsFab();
    loadInitialData();
    
    // Notification de bienvenue
    notifications.unshift({
      id: Date.now(),
      title: "üéâ Bienvenue sur Malgaz Hub !",
      message: "Votre compte a √©t√© cr√©√© avec succ√®s",
      type: "success",
      read: false,
      created_at: new Date().toISOString()
    });
    unreadNotifications++;
    
    saveLocalData();
    renderNotifications();
    updateNotificationBadge();
    
    showNotification(`Bienvenue ${username} ! üéâ (Mode d√©mo)`, 'success');
  }

  function handleLocalLogin(username) {
    currentUser = {
      id: Date.now(),
      username: username,
      email: `${username}@demo.com`,
      role: 'user',
      partnership_level: 'basic',
      balance: Math.random() * 100,
      avatar: '',
      followers: Math.floor(Math.random() * 50) + 10,
      following: Math.floor(Math.random() * 20) + 5,
      certified: Math.random() > 0.7
    };
    currentToken = 'demo-token';
    
    localStorage.setItem('token', currentToken);
    localStorage.setItem('user', JSON.stringify(currentUser));
    
    document.getElementById('auth-modal').classList.add('hidden');
    showCreateFab();
    showNotificationsFab();
    loadInitialData();
    
    // Notification de bienvenue
    notifications.unshift({
      id: Date.now(),
      title: "üëã Bon retour sur Malgaz Hub !",
      message: "Content de vous revoir sur notre plateforme",
      type: "success",
      read: false,
      created_at: new Date().toISOString()
    });
    unreadNotifications++;
    
    saveLocalData();
    renderNotifications();
    updateNotificationBadge();
    
    showNotification(`Content de vous revoir ${username} ! üëã (Mode d√©mo)`, 'success');
  }

  function checkAuth() {
    const savedToken = localStorage.getItem('token');
    const savedUser = localStorage.getItem('user');
    
    if (savedToken && savedUser) {
      currentToken = savedToken;
      currentUser = JSON.parse(savedUser);
      document.getElementById('auth-modal').classList.add('hidden');
      showCreateFab();
      showNotificationsFab();
    }
  }

  function logout() {
    currentUser = null;
    currentToken = null;
    localStorage.removeItem('token');
    localStorage.removeItem('user');
    document.getElementById('auth-modal').classList.remove('hidden');
    document.getElementById('create-fab').classList.add('hidden');
    document.getElementById('notifications-fab').classList.add('hidden');
    document.getElementById('user-balance').classList.add('hidden');
    
    posts = [];
    products = [];
    cart = [];
    notifications = [];
    renderAll();
    
    showNotification('D√©connexion r√©ussie', 'success');
  }

  // RENDU DE L'INTERFACE
  function renderAll() {
    renderStories();
    renderFeed();
    renderProducts();
    renderPartnerships();
    renderProfile();
    renderNotifications();
    renderCart();
    updateStats();
    updateCartBadge();
    updateNotificationBadge();
    
    // Afficher le panneau admin si l'utilisateur est admin
    if (currentUser && currentUser.role === 'admin') {
      document.getElementById('admin-panel').classList.remove('hidden');
      renderAdminPanel();
    } else {
      document.getElementById('admin-panel').classList.add('hidden');
    }
  }

  function renderStories() {
    const storiesContainer = document.getElementById('stories-container');
    
    if (stories.length === 0) return;
    
    storiesContainer.innerHTML = stories.map(story => `
      <div class="story" onclick="viewStory(${story.id})">
        <div class="story-avatar" style="background-image: url('${story.user_avatar || ''}')">
          ${!story.user_avatar ? (story.user_username ? story.user_username.charAt(0).toUpperCase() : 'U') : ''}
        </div>
        <div class="story-username">${story.user_username}</div>
      </div>
    `).join('');
  }

  function renderFeed() {
    const feedContent = document.getElementById('feed-content');
    
    let feedHTML = '';
    
    // Afficher les tendances
    if (trending.length > 0) {
      feedHTML += trending.map(trend => `
        <div class="trending-card">
          <div class="trending-header">
            <div class="trending-icon">
              <i class="${trend.icon}"></i>
            </div>
            <div>
              <div style="font-weight: 600;">${trend.title}</div>
              <div style="font-size: 12px; opacity: 0.7;">${trend.content}</div>
            </div>
          </div>
          <div style="color: var(--primary); font-weight: 600; margin: 5px 0;">${trend.hashtag}</div>
          <div class="trending-stats">
            <span>${trend.posts} publications</span>
          </div>
        </div>
      `).join('');
    }

    // Afficher les √©v√©nements
    if (events.length > 0) {
      feedHTML += events.map(event => `
        <div class="post" data-event-id="${event.id}">
          <div class="post-header">
            <div class="post-user">
              <div class="user-avatar" style="background-image: url('${event.user_avatar || ''}')">
                ${!event.user_avatar ? (event.user_username ? event.user_username.charAt(0).toUpperCase() : 'O') : ''}
                ${event.user_username === 'HOLDEST13' || (event.user_certified) ? 
                  '<div class="premium-star"><div class="sparkle"></div></div>' : ''}
              </div>
              <div class="user-info">
                <div class="user-name">${event.user_username || 'Organisateur'}</div>
                <div class="post-time">${formatDate(event.created_at)}</div>
              </div>
            </div>
            <div class="badge" style="background: var(--accent);">
              <i class="fas fa-calendar"></i> √âv√©nement
            </div>
          </div>
          
          <div class="post-content">
            <div class="post-title">${escapeHtml(event.title)}</div>
            <div class="post-text">${escapeHtml(event.description)}</div>
            
            ${event.image ? `
              <div class="post-media">
                <img src="${event.image}" class="post-image" alt="Image de l'√©v√©nement">
              </div>
            ` : ''}
            
            <div style="margin: 15px 0; padding: 15px; background: rgba(245, 158, 11, 0.1); border-radius: 12px; border: 1px solid var(--accent);">
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 14px;">
                <div><strong>üìÖ Date:</strong> ${formatDisplayDate(event.date)}</div>
                <div><strong>‚è∞ Heure:</strong> ${event.time}</div>
                <div><strong>üìç Lieu:</strong> ${event.location}</div>
                <div><strong>üí∞ Prix:</strong> ${event.price}</div>
                <div><strong>üë• Capacit√©:</strong> ${event.capacity} personnes</div>
                <div><strong>üé´ Participants:</strong> ${event.attendees || 0}</div>
              </div>
            </div>
          </div>
          
          <div class="post-actions">
            <button class="action-btn" onclick="attendEvent(${event.id})">
              <i class="fas fa-calendar-plus"></i> Participer
            </button>
            <button class="action-btn" onclick="shareEvent(${event.id})">
              <i class="fas fa-share"></i> Partager
            </button>
          </div>
        </div>
      `).join('');
    }

    // Afficher les posts
    if (posts.length === 0 && events.length === 0) {
      feedHTML = `
        <div class="card" style="text-align: center; padding: 40px;">
          <i class="fas fa-newspaper" style="font-size: 48px; color: var(--primary); margin-bottom: 15px;"></i>
          <h3>Aucune publication</h3>
          <p style="opacity: 0.7;">Soyez le premier √† publier !</p>
          <button class="btn btn-primary" onclick="openCreateModal()" style="margin-top: 15px;">
            <i class="fas fa-plus"></i> Cr√©er une publication
          </button>
        </div>
      `;
    } else if (posts.length > 0) {
      feedHTML += posts.map(post => `
        <div class="post" data-post-id="${post.id}">
          <div class="post-header">
            <div class="post-user">
              <div class="user-avatar" style="background-image: url('${post.user_avatar || ''}')">
                ${!post.user_avatar ? (post.user_username ? post.user_username.charAt(0).toUpperCase() : 'U') : ''}
                ${post.user_username === 'HOLDEST13' || (currentUser && currentUser.partnership_level === 'premium') || post.user_certified ? 
                  '<div class="premium-star"><div class="sparkle"></div></div>' : ''}
              </div>
              <div class="user-info">
                <div class="user-name">
                  ${post.user_username || 'Utilisateur'}
                  ${post.user_followers >= 50 ? '<div class="premium-star" style="width: 16px; height: 16px; top: -2px; right: -2px;"><div class="sparkle"></div></div>' : ''}
                </div>
                <div class="post-time">${formatDate(post.created_at)}</div>
              </div>
            </div>
            ${post.earnings > 0 ? `
              <div class="earnings-badge">
                <i class="fas fa-coins"></i> ${post.earnings.toFixed(2)} ‚Ç¨
              </div>
            ` : ''}
          </div>
          
          <div class="post-content">
            <div class="post-title">${escapeHtml(post.title)}</div>
            <div class="post-text">${escapeHtml(post.content)}</div>
            
            ${post.media && post.media.length > 0 ? `
              <div class="post-media">
                ${post.media.map(media => 
                  media.type === 'image' ? 
                    `<img src="${media.url}" class="post-image" alt="Image de la publication">` :
                    `<video src="${media.url}" class="post-video" controls></video>`
                ).join('')}
              </div>
            ` : ''}

            <!-- Section commentaires -->
            <div class="comments-section">
              ${post.comments && post.comments.length > 0 ? post.comments.map(comment => `
                <div class="comment">
                  <div class="comment-avatar" style="background-image: url('${comment.avatar || ''}')">
                    ${!comment.avatar ? (comment.author ? comment.author.charAt(0).toUpperCase() : 'U') : ''}
                  </div>
                  <div class="comment-content">
                    <div class="comment-header">
                      <div class="comment-author">${comment.author}</div>
                      <div class="comment-time">${formatDate(comment.created_at)}</div>
                    </div>
                    <div class="comment-text">${escapeHtml(comment.text)}</div>
                  </div>
                </div>
              `).join('') : ''}
              
              <div class="comment-form">
                <input type="text" class="comment-input" id="comment-input-${post.id}" placeholder="Ajouter un commentaire..." onkeypress="if(event.key==='Enter') addComment(${post.id})">
                <button class="comment-submit" onclick="addComment(${post.id})">
                  <i class="fas fa-paper-plane"></i>
                </button>
              </div>
            </div>
          </div>
          
          <div class="post-actions">
            <button class="action-btn ${likedPosts.has(post.id) ? 'active' : ''}" onclick="toggleLike(${post.id})">
              <i class="fas fa-heart"></i> <span id="likes-${post.id}">${post.likes || 0}</span>
            </button>
            <button class="action-btn" onclick="toggleComments(${post.id})">
              <i class="fas fa-comment"></i> ${post.comments_count || post.comments?.length || 0}
            </button>
            <button class="action-btn" onclick="sharePost(${post.id})">
              <i class="fas fa-share"></i> ${post.shares || 0}
            </button>
            ${currentUser && currentUser.username !== post.user_username ? `
              <button class="action-btn" onclick="followUser('${post.user_username}')">
                <i class="fas fa-user-plus"></i> Suivre
              </button>
            ` : ''}
          </div>
        </div>
      `).join('');
    }

    feedContent.innerHTML = feedHTML;
  }

  function renderProducts() {
    const productsContent = document.getElementById('products-content');
    
    if (products.length === 0) {
      productsContent.innerHTML = `
        <div class="card" style="text-align: center; padding: 40px;">
          <i class="fas fa-shopping-bag" style="font-size: 48px; color: var(--primary); margin-bottom: 15px;"></i>
          <h3>Aucun produit disponible</h3>
          <p style="opacity: 0.7;">Notre boutique arrive bient√¥t</p>
        </div>
      `;
      return;
    }

    productsContent.innerHTML = products.map(product => `
      <div class="product-card">
        <img src="${product.image}" class="product-image" alt="${product.name}">
        <div class="product-info">
          <div class="product-name">${escapeHtml(product.name)}</div>
          <div class="product-price">${parseFloat(product.price).toFixed(2)} ‚Ç¨</div>
          <div style="font-size: 12px; opacity: 0.7; margin: 5px 0;">${product.description}</div>
          <div style="font-size: 12px; opacity: 0.7; margin-bottom: 8px;">Stock: ${product.stock}</div>
          <button class="buy-btn" onclick="addToCart(${product.id})" ${product.stock <= 0 ? 'disabled style="opacity: 0.5;"' : ''}>
            <i class="fas fa-cart-plus"></i> 
            ${product.stock <= 0 ? 'Rupture' : 'Ajouter au panier'}
          </button>
        </div>
      </div>
    `).join('');
  }

  function renderCart() {
    const cartContent = document.getElementById('cart-content');
    const cartTotal = document.getElementById('cart-total');
    
    if (cart.length === 0) {
      cartContent.innerHTML = `
        <div style="text-align: center; padding: 40px;">
          <i class="fas fa-shopping-cart" style="font-size: 48px; color: var(--primary); margin-bottom: 15px;"></i>
          <h3>Votre panier est vide</h3>
          <p style="opacity: 0.7;">Ajoutez des produits depuis la boutique</p>
        </div>
      `;
      cartTotal.classList.add('hidden');
      return;
    }

    cartContent.innerHTML = cart.map(item => `
      <div class="cart-item">
        <div class="cart-item-info">
          <div class="cart-item-name">${item.product.name}</div>
          <div class="cart-item-price">${parseFloat(item.product.price).toFixed(2)} ‚Ç¨</div>
        </div>
        <div class="cart-item-actions">
          <button class="quantity-btn" onclick="updateCartQuantity(${item.product.id}, ${item.quantity - 1})">
            <i class="fas fa-minus"></i>
          </button>
          <span style="margin: 0 10px; font-weight: 600;">${item.quantity}</span>
          <button class="quantity-btn" onclick="updateCartQuantity(${item.product.id}, ${item.quantity + 1})">
            <i class="fas fa-plus"></i>
          </button>
          <button class="quantity-btn" style="background: var(--danger); margin-left: 10px;" onclick="removeFromCart(${item.product.id})">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>
    `).join('');

    updateCartTotal();
    cartTotal.classList.remove('hidden');
  }

  function renderPartnerships() {
    const partnershipsContent = document.getElementById('partnerships-content');
    
    partnershipsContent.innerHTML = partnerships.map(partnership => `
      <div class="partnership-card ${partnership.level === 'premium' ? 'premium' : ''}">
        <div class="partnership-header">
          <h3>${partnership.title}</h3>
          <div class="partnership-price">${partnership.price} ‚Ç¨/mois</div>
        </div>
        <ul style="list-style: none; padding: 0; margin: 15px 0;">
          ${partnership.benefits.map(benefit => `
            <li style="padding: 5px 0; display: flex; align-items: center; gap: 8px;">
              <i class="fas fa-check" style="color: var(--secondary);"></i>
              <span>${benefit}</span>
            </li>
          `).join('')}
        </ul>
        <button class="btn ${currentUser && currentUser.partnership_level === partnership.level ? 'btn-secondary' : 'btn-primary'} btn-block" 
                onclick="subscribeToPartnership('${partnership.level}')"
                ${currentUser && currentUser.partnership_level === partnership.level ? 'disabled' : ''}>
          <i class="fas ${partnership.level === 'premium' ? 'fa-crown' : 'fa-check'}"></i>
          ${currentUser && currentUser.partnership_level === partnership.level ? 'Actif' : 'S\'abonner'}
        </button>
      </div>
    `).join('');
  }

  function renderNotifications() {
    const notificationsList = document.getElementById('notifications-list');
    
    if (notifications.length === 0) {
      notificationsList.innerHTML = `
        <div style="text-align: center; padding: 40px;">
          <i class="fas fa-bell-slash" style="font-size: 48px; color: var(--primary); margin-bottom: 15px;"></i>
          <h3>Aucune notification</h3>
          <p style="opacity: 0.7;">Vous serez notifi√© des nouvelles activit√©s</p>
        </div>
      `;
      return;
    }

    notificationsList.innerHTML = notifications.map(notification => `
      <div class="notification-item ${!notification.read ? 'unread' : ''}" onclick="markNotificationAsRead(${notification.id})">
        <div style="display: flex; align-items: start; gap: 15px;">
          <div class="notification-icon ${notification.type}">
            <i class="fas ${
              notification.type === 'success' ? 'fa-check' :
              notification.type === 'warning' ? 'fa-exclamation-triangle' :
              notification.type === 'earning' ? 'fa-coins' :
              notification.type === 'like' ? 'fa-heart' :
              notification.type === 'comment' ? 'fa-comment' :
              notification.type === 'share' ? 'fa-share' :
              'fa-info'
            }"></i>
          </div>
          <div style="flex: 1;">
            <div style="font-weight: 600; margin-bottom: 5px;">${notification.title}</div>
            <div style="font-size: 14px; opacity: 0.8; margin-bottom: 5px;">${notification.message}</div>
            <div style="font-size: 12px; opacity: 0.6;">${formatDate(notification.created_at)}</div>
          </div>
          ${!notification.read ? '<div style="width: 8px; height: 8px; background: var(--primary); border-radius: 50%;"></div>' : ''}
        </div>
      </div>
    `).join('');
  }

  function renderProfile() {
    const profileContent = document.getElementById('profile-content');
    
    if (!currentUser) return;
    
    profileContent.innerHTML = `
      <div style="text-align: center; padding: 20px 0;">
        <div class="user-avatar" style="width: 100px; height: 100px; margin: 0 auto 20px; background-image: url('${currentUser.avatar || ''}'); position: relative;">
          ${!currentUser.avatar ? currentUser.username.charAt(0).toUpperCase() : ''}
          ${currentUser.partnership_level === 'premium' || currentUser.username === 'HOLDEST13' || currentUser.certified ? 
            '<div class="premium-star"><div class="sparkle"></div></div>' : ''}
        </div>
        
        <h2 style="margin-bottom: 5px;">${currentUser.username}</h2>
        <p style="opacity: 0.7; margin-bottom: 20px;">
          <span class="badge ${currentUser.role === 'admin' ? 'badge-admin' : 'badge'}">
            ${currentUser.role === 'admin' ? 'üëë Administrateur' : 'üë§ Membre'}
          </span>
          ${currentUser.partnership_level === 'premium' ? '<span class="badge badge-premium" style="margin-left: 5px;">‚≠ê Premium</span>' : ''}
          ${currentUser.certified ? '<span class="badge" style="margin-left: 5px; background: var(--info);">‚úì Certifi√©</span>' : ''}
          <div style="margin-top: 5px;">üìß ${currentUser.email}</div>
        </p>
        
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-number">${userStats.posts || 0}</div>
            <div class="stat-label">Publications</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${userStats.followers || 0}</div>
            <div class="stat-label">Abonn√©s</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${userStats.following || 0}</div>
            <div class="stat-label">Abonnements</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${userStats.earnings ? userStats.earnings.toFixed(2) : '0.00'} ‚Ç¨</div>
            <div class="stat-label">Revenus</div>
          </div>
        </div>
        
        <div style="margin-top: 30px;">
          <button class="btn btn-secondary btn-block" onclick="changeAvatar()" style="margin-bottom: 10px;">
            <i class="fas fa-camera"></i> Changer la photo de profil
          </button>
          ${currentUser.followers >= 50 && !currentUser.certified ? `
            <button class="btn btn-primary btn-block" onclick="requestCertification()" style="margin-bottom: 10px;">
              <i class="fas fa-certificate"></i> Demander la certification
            </button>
          ` : ''}
          <button class="btn btn-primary" onclick="logout()" style="width: 100%; margin-bottom: 10px;">
            <i class="fas fa-sign-out-alt"></i> Se d√©connecter
          </button>
        </div>
      </div>
    `;
    
    // Afficher le solde utilisateur
    if (currentUser.balance !== undefined) {
      document.getElementById('user-balance').classList.remove('hidden');
      document.getElementById('balance-amount').textContent = currentUser.balance.toFixed(2) + ' ‚Ç¨';
    }
  }

  function renderAdminPanel() {
    // Rendu des utilisateurs pour l'admin
    const adminUsersList = document.getElementById('admin-users-list');
    adminUsersList.innerHTML = `
      <div class="user-card">
        <div class="user-avatar" style="background-image: url('')">H</div>
        <div>
          <div style="font-weight: 600;">HOLDEST13</div>
          <div style="font-size: 12px; opacity: 0.7;">holdest13@malgaz.com</div>
        </div>
        <div class="certification-controls">
          <span class="badge badge-admin">Admin</span>
          <span class="badge badge-premium">Premium</span>
        </div>
      </div>
      <div class="user-card">
        <div class="user-avatar" style="background-image: url('')">M</div>
        <div>
          <div style="font-weight: 600;">Marie</div>
          <div style="font-size: 12px; opacity: 0.7;">marie@example.com</div>
        </div>
        <div class="certification-controls">
          <button class="btn btn-primary" style="padding: 5px 10px; font-size: 12px;">Certifier</button>
          <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 12px;">Mod√©rer</button>
        </div>
      </div>
    `;
    
    // Mise √† jour des statistiques admin
    document.getElementById('admin-total-users').textContent = '125';
    document.getElementById('admin-total-posts').textContent = posts.length;
    document.getElementById('admin-total-products').textContent = products.length;
    document.getElementById('admin-total-revenue').textContent = '1,245.75';
  }

  // FONCTIONNALIT√âS PRINCIPALES
  async function toggleLike(postId) {
    if (!currentUser) {
      showNotification('Veuillez vous connecter pour liker', 'error');
      return;
    }

    try {
      await makeRequest(`/posts/${postId}/like`, {
        method: 'POST'
      });
      loadInitialData();
    } catch (error) {
      // Fallback local
      const post = posts.find(p => p.id === postId);
      if (post) {
        if (likedPosts.has(postId)) {
          likedPosts.delete(postId);
          post.likes = Math.max(0, (post.likes || 0) - 1);
        } else {
          likedPosts.add(postId);
          post.likes = (post.likes || 0) + 1;
        }
        saveLocalData();
        renderFeed();
      }
    }
  }

  async function addComment(postId) {
    if (!currentUser) {
      showNotification('Veuillez vous connecter pour commenter', 'error');
      return;
    }

    const input = document.getElementById(`comment-input-${postId}`);
    const text = input.value.trim();
    
    if (!text) {
      showNotification('Commentaire vide', 'error');
      return;
    }

    try {
      await makeRequest(`/posts/${postId}/comments`, {
        method: 'POST',
        body: JSON.stringify({ text })
      });
      
      input.value = '';
      loadInitialData();
      showNotification('Commentaire ajout√©! üí¨', 'success');
    } catch (error) {
      // Fallback local
      const post = posts.find(p => p.id === postId);
      if (post) {
        if (!post.comments) post.comments = [];
        post.comments.push({
          id: Date.now(),
          author: currentUser.username,
          avatar: currentUser.avatar,
          text: text,
          created_at: new Date().toISOString()
        });
        post.comments_count = (post.comments_count || 0) + 1;
        input.value = '';
        saveLocalData();
        renderFeed();
        showNotification('Commentaire ajout√©! üí¨', 'success');
      }
    }
  }

  async function addToCart(productId) {
    if (!currentUser) {
      showNotification('Veuillez vous connecter pour ajouter au panier', 'error');
      return;
    }

    try {
      await makeRequest('/cart/add', {
        method: 'POST',
        body: JSON.stringify({ productId, quantity: 1 })
      });
      
      loadInitialData();
      showNotification('Produit ajout√© au panier! üõí', 'success');
    } catch (error) {
      // Fallback local
      const product = products.find(p => p.id === productId);
      if (product && product.stock > 0) {
        const existingItem = cart.find(item => item.product.id === productId);
        if (existingItem) {
          existingItem.quantity += 1;
        } else {
          cart.push({
            product: product,
            quantity: 1
          });
        }
        product.stock -= 1;
        saveLocalData();
        renderCart();
        renderProducts();
        updateCartBadge();
        showNotification('Produit ajout√© au panier! üõí', 'success');
      } else {
        showNotification('Produit en rupture de stock', 'error');
      }
    }
  }

  function updateCartQuantity(productId, newQuantity) {
    if (newQuantity < 1) {
      removeFromCart(productId);
      return;
    }

    const item = cart.find(item => item.product.id === productId);
    if (item) {
      const product = products.find(p => p.id === productId);
      const quantityChange = newQuantity - item.quantity;
      
      if (product.stock >= quantityChange) {
        item.quantity = newQuantity;
        product.stock -= quantityChange;
        saveLocalData();
        renderCart();
        renderProducts();
        updateCartBadge();
      } else {
        showNotification('Stock insuffisant', 'error');
      }
    }
  }

  function removeFromCart(productId) {
    const item = cart.find(item => item.product.id === productId);
    if (item) {
      const product = products.find(p => p.id === productId);
      product.stock += item.quantity;
      cart = cart.filter(item => item.product.id !== productId);
      saveLocalData();
      renderCart();
      renderProducts();
      updateCartBadge();
      showNotification('Produit retir√© du panier', 'info');
    }
  }

  async function createContent() {
    if (!currentUser) return;

    const createFunction = currentCreateType === 'post' ? createPost : 
                          currentCreateType === 'event' ? createEvent : 
                          createProduct;
    
    await createFunction();
  }

  async function createPost() {
    const title = document.getElementById('post-title').value;
    const content = document.getElementById('post-content').value;

    if (!title || !content) {
      showNotification('Titre et contenu requis', 'error');
      return;
    }

    try {
      await makeRequest('/posts', {
        method: 'POST',
        body: JSON.stringify({ 
          title, 
          content,
          type: 'post'
        })
      });
      
      closeCreateModal();
      loadInitialData();
      showNotification('Publication cr√©√©e avec succ√®s! üéâ', 'success');
    } catch (error) {
      // Fallback local
      const newPost = {
        id: Date.now(),
        title: title,
        content: content,
        user_username: currentUser.username,
        user_avatar: currentUser.avatar,
        user_followers: currentUser.followers,
        user_certified: currentUser.certified,
        created_at: new Date().toISOString(),
        likes: 0,
        comments_count: 0,
        shares: 0,
        earnings: 0,
        media: getPostMedia(),
        comments: []
      };
      posts.unshift(newPost);
      saveLocalData();
      closeCreateModal();
      renderAll();
      showNotification('Publication cr√©√©e avec succ√®s! üéâ', 'success');
    }
  }

  async function createEvent() {
    const title = document.getElementById('event-title').value;
    const description = document.getElementById('event-description').value;
    const date = document.getElementById('event-date').value;
    const time = document.getElementById('event-time').value;
    const location = document.getElementById('event-location').value;
    const price = document.getElementById('event-price').value;
    const capacity = document.getElementById('event-capacity').value;

    if (!title || !description || !date || !location || !price) {
      showNotification('Tous les champs sont requis', 'error');
      return;
    }

    try {
      await makeRequest('/events', {
        method: 'POST',
        body: JSON.stringify({ 
          title, 
          description,
          date,
          time,
          location,
          price,
          capacity: parseInt(capacity)
        })
      });
      
      closeCreateModal();
      loadInitialData();
      showNotification('√âv√©nement cr√©√© avec succ√®s! üé™', 'success');
    } catch (error) {
      // Fallback local
      const newEvent = {
        id: Date.now(),
        title: title,
        description: description,
        date: date,
        time: time,
        location: location,
        price: price,
        capacity: parseInt(capacity),
        attendees: 0,
        image: getEventImage(),
        user_username: currentUser.username,
        user_avatar: currentUser.avatar,
        created_at: new Date().toISOString()
      };
      events.unshift(newEvent);
      saveLocalData();
      closeCreateModal();
      renderAll();
      showNotification('√âv√©nement cr√©√© avec succ√®s! üé™', 'success');
    }
  }

  async function createProduct() {
    const name = document.getElementById('product-name').value;
    const description = document.getElementById('product-description').value;
    const price = document.getElementById('product-price').value;
    const stock = document.getElementById('product-stock').value;

    if (!name || !description || !price || !stock) {
      showNotification('Tous les champs sont requis', 'error');
      return;
    }

    try {
      await makeRequest('/products', {
        method: 'POST',
        body: JSON.stringify({ 
          name, 
          description,
          price: parseFloat(price),
          stock: parseInt(stock)
        })
      });
      
      closeCreateModal();
      loadInitialData();
      showNotification('Produit cr√©√© avec succ√®s! üõçÔ∏è', 'success');
    } catch (error) {
      // Fallback local
      const newProduct = {
        id: Date.now(),
        name: name,
        description: description,
        price: parseFloat(price).toFixed(2),
        stock: parseInt(stock),
        image: getProductImage(),
        sales: 0
      };
      products.push(newProduct);
      saveLocalData();
      closeCreateModal();
      renderAll();
      showNotification('Produit cr√©√© avec succ√®s! üõçÔ∏è', 'success');
    }
  }

  function subscribeToPartnership(level) {
    if (!currentUser) {
      showNotification('Veuillez vous connecter', 'error');
      return;
    }

    currentUser.partnership_level = level;
    localStorage.setItem('user', JSON.stringify(currentUser));
    
    renderProfile();
    renderPartnerships();
    showNotification(`Partenariat ${level} activ√© avec succ√®s! ‚ú®`, 'success');
  }

  function attendEvent(eventId) {
    if (!currentUser) {
      showNotification('Veuillez vous connecter pour participer', 'error');
      return;
    }

    const event = events.find(e => e.id === eventId);
    if (event && event.attendees < event.capacity) {
      event.attendees += 1;
      saveLocalData();
      renderFeed();
      showNotification('Vous participez √† cet √©v√©nement! üéâ', 'success');
    } else {
      showNotification('√âv√©nement complet ou erreur', 'error');
    }
  }

  function followUser(username) {
    if (!currentUser) {
      showNotification('Veuillez vous connecter pour suivre un utilisateur', 'error');
      return;
    }

    showNotification(`Vous suivez maintenant ${username}! üë§`, 'success');
    
    // Mettre √† jour les statistiques de l'utilisateur
    if (currentUser.username === 'HOLDEST13') {
      currentUser.following += 1;
      localStorage.setItem('user', JSON.stringify(currentUser));
      renderProfile();
    }
  }

  function requestCertification() {
    if (!currentUser) return;
    
    if (currentUser.followers >= 50) {
      currentUser.certified = true;
      localStorage.setItem('user', JSON.stringify(currentUser));
      renderProfile();
      showNotification('F√©licitations! Vous √™tes maintenant certifi√©! ‚úÖ', 'success');
    } else {
      showNotification('Vous devez avoir au moins 50 abonn√©s pour √™tre certifi√©', 'error');
    }
  }

  function viewStory(storyId) {
    const story = stories.find(s => s.id === storyId);
    if (story) {
      showNotification(`Visionnage de l'histoire de ${story.user_username}`, 'info');
    }
  }

  function searchContent(query) {
    if (query.length < 2) return;
    
    // Filtrer les posts en fonction de la recherche
    const filteredPosts = posts.filter(post => 
      post.title.toLowerCase().includes(query.toLowerCase()) || 
      post.content.toLowerCase().includes(query.toLowerCase()) ||
      post.user_username.toLowerCase().includes(query.toLowerCase())
    );
    
    // Afficher les r√©sultats de recherche
    const feedContent = document.getElementById('feed-content');
    if (filteredPosts.length > 0) {
      feedContent.innerHTML = filteredPosts.map(post => `
        <div class="post" data-post-id="${post.id}">
          <div class="post-header">
            <div class="post-user">
              <div class="user-avatar" style="background-image: url('${post.user_avatar || ''}')">
                ${!post.user_avatar ? (post.user_username ? post.user_username.charAt(0).toUpperCase() : 'U') : ''}
              </div>
              <div class="user-info">
                <div class="user-name">${post.user_username || 'Utilisateur'}</div>
                <div class="post-time">${formatDate(post.created_at)}</div>
              </div>
            </div>
          </div>
          
          <div class="post-content">
            <div class="post-title">${escapeHtml(post.title)}</div>
            <div class="post-text">${escapeHtml(post.content)}</div>
          </div>
        </div>
      `).join('');
    } else {
      feedContent.innerHTML = `
        <div class="card" style="text-align: center; padding: 40px;">
          <i class="fas fa-search" style="font-size: 48px; color: var(--primary); margin-bottom: 15px;"></i>
          <h3>Aucun r√©sultat trouv√©</h3>
          <p style="opacity: 0.7;">Aucune publication ne correspond √† votre recherche</p>
        </div>
      `;
    }
  }

  // FONCTIONS POUR LES IMAGES
  function previewPostMedia() {
    const preview = document.getElementById('media-preview');
    const files = document.getElementById('post-media').files;
    
    preview.innerHTML = '';
    
    for (let file of files) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const mediaElement = file.type.startsWith('image/') ? 
          `<img src="${e.target.result}" class="post-image" alt="Preview">` :
          `<video src="${e.target.result}" class="post-video" controls></video>`;
        
        preview.innerHTML += mediaElement;
      };
      reader.readAsDataURL(file);
    }
  }

  function previewEventImage() {
    const preview = document.getElementById('event-image-preview');
    const file = document.getElementById('event-image').files[0];
    
    preview.innerHTML = '';
    
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        preview.innerHTML = `<img src="${e.target.result}" class="post-image" alt="Preview √©v√©nement">`;
      };
      reader.readAsDataURL(file);
    }
  }

  function previewProductImage() {
    const preview = document.getElementById('product-image-preview');
    const file = document.getElementById('product-image').files[0];
    
    preview.innerHTML = '';
    
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        preview.innerHTML = `<img src="${e.target.result}" class="post-image" alt="Preview produit">`;
      };
      reader.readAsDataURL(file);
    }
  }

  function getPostMedia() {
    const files = document.getElementById('post-media').files;
    const media = [];
    
    for (let file of files) {
      const reader = new FileReader();
      reader.onload = function(e) {
        media.push({
          type: file.type.startsWith('image/') ? 'image' : 'video',
          url: e.target.result
        });
      };
      reader.readAsDataURL(file);
    }
    
    return media;
  }

  function getEventImage() {
    const file = document.getElementById('event-image').files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        return e.target.result;
      };
      reader.readAsDataURL(file);
    }
    return "https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=500&h=300&fit=crop";
  }

  function getProductImage() {
    const file = document.getElementById('product-image').files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        return e.target.result;
      };
      reader.readAsDataURL(file);
    }
    return "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=300&h=300&fit=crop";
  }

  function createOrder() {
    if (cart.length === 0) {
      showNotification('Votre panier est vide', 'error');
      return;
    }

    document.getElementById('order-modal').classList.remove('hidden');
    renderOrderSummary();
  }

  function renderOrderSummary() {
    const orderSummary = document.getElementById('order-summary');
    const total = calculateCartTotal();
    
    orderSummary.innerHTML = `
      <h3 style="margin-bottom: 15px;">R√©capitulatif de commande</h3>
      ${cart.map(item => `
        <div style="display: flex; justify-content: space-between; padding: 5px 0;">
          <span>${item.product.name} √ó ${item.quantity}</span>
          <span>${(parseFloat(item.product.price) * item.quantity).toFixed(2)} ‚Ç¨</span>
        </div>
      `).join('')}
      <div style="border-top: 1px solid var(--glass-border); margin-top: 10px; padding-top: 10px; font-weight: 600;">
        <div style="display: flex; justify-content: space-between;">
          <span>Total:</span>
          <span>${total.toFixed(2)} ‚Ç¨</span>
        </div>
      </div>
    `;
  }

  function confirmOrder() {
    const shippingAddress = document.getElementById('shipping-address').value;
    const paymentMethod = document.getElementById('payment-method').value;

    if (!shippingAddress || !paymentMethod) {
      showNotification('Veuillez remplir tous les champs', 'error');
      return;
    }

    // Traitement de la commande
    const orderTotal = calculateCartTotal();
    
    // Ajouter une notification
    notifications.unshift({
      id: Date.now(),
      title: "üéâ Commande confirm√©e !",
      message: `Votre commande de ${orderTotal.toFixed(2)} ‚Ç¨ a √©t√© pass√©e avec succ√®s. Livraison √† : ${shippingAddress}`,
      type: "success",
      read: false,
      created_at: new Date().toISOString()
    });
    unreadNotifications++;
    
    // Vider le panier
    cart = [];
    
    saveLocalData();
    closeOrderModal();
    renderAll();
    showNotification('Commande cr√©√©e avec succ√®s! üéâ', 'success');
  }

  // FONCTIONS UTILITAIRES
  function showCreateFab() {
    document.getElementById('create-fab').classList.remove('hidden');
  }

  function showNotificationsFab() {
    const fab = document.getElementById('notifications-fab');
    fab.classList.remove('hidden');
    updateNotificationBadge();
  }

  function openCreateModal() {
    document.getElementById('create-modal').classList.remove('hidden');
    switchCreateTab('post');
  }

  function closeCreateModal() {
    document.getElementById('create-modal').classList.add('hidden');
    // R√©initialiser les formulaires
    document.getElementById('post-title').value = '';
    document.getElementById('post-content').value = '';
    document.getElementById('post-media').value = '';
    document.getElementById('media-preview').innerHTML = '';
    
    document.getElementById('event-title').value = '';
    document.getElementById('event-description').value = '';
    document.getElementById('event-date').value = '';
    document.getElementById('event-time').value = '';
    document.getElementById('event-location').value = '';
    document.getElementById('event-price').value = '';
    document.getElementById('event-capacity').value = '';
    document.getElementById('event-image').value = '';
    document.getElementById('event-image-preview').innerHTML = '';
    
    document.getElementById('product-name').value = '';
    document.getElementById('product-description').value = '';
    document.getElementById('product-price').value = '';
    document.getElementById('product-stock').value = '';
    document.getElementById('product-image').value = '';
    document.getElementById('product-image-preview').innerHTML = '';
  }

  function closeOrderModal() {
    document.getElementById('order-modal').classList.add('hidden');
    document.getElementById('shipping-address').value = '';
    document.getElementById('payment-method').value = '';
  }

  function openNotifications() {
    document.getElementById('notifications-panel').classList.add('open');
  }

  function closeNotifications() {
    document.getElementById('notifications-panel').classList.remove('open');
  }

  function markNotificationAsRead(notificationId) {
    const notification = notifications.find(n => n.id === notificationId);
    if (notification && !notification.read) {
      notification.read = true;
      unreadNotifications = Math.max(0, unreadNotifications - 1);
      saveLocalData();
      renderNotifications();
      updateNotificationBadge();
    }
  }

  function markAllNotificationsAsRead() {
    notifications.forEach(notification => {
      notification.read = true;
    });
    unreadNotifications = 0;
    saveLocalData();
    renderNotifications();
    updateNotificationBadge();
    showNotification('Toutes les notifications marqu√©es comme lues', 'success');
  }

  function sharePost(postId) {
    const post = posts.find(p => p.id === postId);
    if (post) {
      post.shares = (post.shares || 0) + 1;
      saveLocalData();
      renderFeed();
      
      if (navigator.share) {
        navigator.share({
          title: post.title,
          text: post.content,
          url: window.location.href
        });
      } else {
        navigator.clipboard.writeText(window.location.href);
        showNotification('Lien copi√© dans le presse-papier! üìã', 'success');
      }
    }
  }

  function shareEvent(eventId) {
    const event = events.find(e => e.id === eventId);
    if (event) {
      if (navigator.share) {
        navigator.share({
          title: event.title,
          text: `Rejoignez-moi √† cet √©v√©nement: ${event.description}`,
          url: window.location.href
        });
      } else {
        navigator.clipboard.writeText(window.location.href);
        showNotification('Lien de l\'√©v√©nement copi√©! üìã', 'success');
      }
    }
  }

  function setupNavigation() {
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabName = tab.getAttribute('data-tab');
        switchSection(tabName);
      });
    });
  }

  function switchSection(sectionName) {
    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
    document.querySelector(`[data-tab="${sectionName}"]`).classList.add('active');
    
    document.querySelectorAll('.section').forEach(section => {
      section.classList.remove('active');
    });
    document.getElementById(sectionName).classList.add('active');
    
    currentSection = sectionName;
  }

  function showNotification(message, type = 'success') {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
      <div style="display: flex; align-items: center; gap: 10px;">
        <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'}"></i>
        <span>${message}</span>
      </div>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
      notification.style.animation = 'slideInRight 0.3s ease reverse';
      setTimeout(() => notification.remove(), 300);
    }, 4000);
  }

  function updateStats() {
    document.getElementById('total-products').textContent = products.length;
    document.getElementById('total-sales').textContent = products.reduce((total, product) => total + (product.sales || 0), 0);
  }

  function updateCartBadge() {
    const cartBadge = document.getElementById('cart-badge');
    const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
    
    if (totalItems > 0) {
      cartBadge.textContent = totalItems > 99 ? '99+' : totalItems;
      cartBadge.classList.remove('hidden');
    } else {
      cartBadge.classList.add('hidden');
    }
  }

  function updateNotificationBadge() {
    const navBadge = document.getElementById('notification-badge');
    const floatingBadge = document.getElementById('floating-notification-badge');
    
    if (unreadNotifications > 0) {
      const badgeText = unreadNotifications > 99 ? '99+' : unreadNotifications;
      if (navBadge) {
        navBadge.textContent = badgeText;
        navBadge.classList.remove('hidden');
      }
      if (floatingBadge) {
        floatingBadge.textContent = badgeText;
        floatingBadge.classList.remove('hidden');
      }
    } else {
      if (navBadge) navBadge.classList.add('hidden');
      if (floatingBadge) floatingBadge.classList.add('hidden');
    }
  }

  function updateCartTotal() {
    const total = calculateCartTotal();
    document.getElementById('total-amount').textContent = total.toFixed(2) + ' ‚Ç¨';
  }

  function calculateCartTotal() {
    return cart.reduce((total, item) => {
      const price = parseFloat(item.product.price) || 0;
      return total + (price * item.quantity);
    }, 0);
  }

  function formatDate(dateString) {
    const date = new Date(dateString);
    const now = new Date();
    const diff = now - date;
    
    if (diff < 60000) return '√Ä l\'instant';
    if (diff < 3600000) return `Il y a ${Math.floor(diff / 60000)} min`;
    
    if (date.toDateString() === now.toDateString()) {
      return `Aujourd'hui √† ${date.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}`;
    }
    
    const yesterday = new Date(now);
    yesterday.setDate(yesterday.getDate() - 1);
    if (date.toDateString() === yesterday.toDateString()) {
      return `Hier √† ${date.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}`;
    }
    
    return date.toLocaleDateString('fr-FR', { 
      day: 'numeric', 
      month: 'short', 
      year: 'numeric' 
    });
  }

  function formatDisplayDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('fr-FR', {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
  }

  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  function toggleComments(postId) {
    const postElement = document.querySelector(`[data-post-id="${postId}"]`);
    const commentsSection = postElement.querySelector('.comments-section');
    
    if (commentsSection.style.display === 'none') {
      commentsSection.style.display = 'block';
    } else {
      commentsSection.style.display = 'none';
    }
  }

  function showRegisterForm() {
    document.getElementById('login-form').classList.add('hidden');
    document.getElementById('register-form').classList.remove('hidden');
    document.getElementById('forgot-password-form').classList.add('hidden');
  }

  function showLoginForm() {
    document.getElementById('register-form').classList.add('hidden');
    document.getElementById('login-form').classList.remove('hidden');
    document.getElementById('forgot-password-form').classList.add('hidden');
  }

  // FONCTIONS POUR L'AVATAR
  function changeAvatar() {
    document.getElementById('avatar-modal').classList.remove('hidden');
    previewAvatar();
  }

  function closeAvatarModal() {
    document.getElementById('avatar-modal').classList.add('hidden');
    document.getElementById('avatar-input').value = '';
  }

  function previewAvatar() {
    const preview = document.getElementById('preview-avatar');
    const file = document.getElementById('avatar-input').files[0];
    
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        preview.style.backgroundImage = `url('${e.target.result}')`;
        preview.innerHTML = '';
        // Ajouter l'√©toile premium si l'utilisateur est premium
        if (currentUser && (currentUser.partnership_level === 'premium' || currentUser.username === 'HOLDEST13' || currentUser.certified)) {
          preview.innerHTML = '<div class="premium-star"><div class="sparkle"></div></div>';
        }
      };
      reader.readAsDataURL(file);
    } else {
      // Afficher l'avatar actuel ou l'initiale
      preview.style.backgroundImage = currentUser.avatar ? `url('${currentUser.avatar}')` : '';
      preview.innerHTML = currentUser.avatar ? '' : currentUser.username.charAt(0).toUpperCase();
      // Ajouter l'√©toile premium si l'utilisateur est premium
      if (currentUser && (currentUser.partnership_level === 'premium' || currentUser.username === 'HOLDEST13' || currentUser.certified)) {
        preview.innerHTML += '<div class="premium-star"><div class="sparkle"></div></div>';
      }
    }
  }

  function saveAvatar() {
    const file = document.getElementById('avatar-input').files[0];
    
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        currentUser.avatar = e.target.result;
        localStorage.setItem('user', JSON.stringify(currentUser));
        
        // Mettre √† jour l'avatar dans tous les posts de l'utilisateur
        posts.forEach(post => {
          if (post.user_username === currentUser.username) {
            post.user_avatar = e.target.result;
          }
        });
        
        saveLocalData();
        closeAvatarModal();
        renderAll();
        showNotification('Photo de profil mise √† jour! üì∏', 'success');
      };
      reader.readAsDataURL(file);
    } else {
      showNotification('Veuillez s√©lectionner une image', 'error');
    }
  }

  // EXPOSER LES FONCTIONS GLOBALES
  window.login = login;
  window.register = register;
  window.resetPassword = resetPassword;
  window.showForgotPasswordForm = showForgotPasswordForm;
  window.logout = logout;
  window.showRegisterForm = showRegisterForm;
  window.showLoginForm = showLoginForm;
  window.toggleLike = toggleLike;
  window.addComment = addComment;
  window.toggleComments = toggleComments;
  window.addToCart = addToCart;
  window.updateCartQuantity = updateCartQuantity;
  window.removeFromCart = removeFromCart;
  window.createContent = createContent;
  window.openCreateModal = openCreateModal;
  window.closeCreateModal = closeCreateModal;
  window.previewPostMedia = previewPostMedia;
  window.previewEventImage = previewEventImage;
  window.previewProductImage = previewProductImage;
  window.sharePost = sharePost;
  window.shareEvent = shareEvent;
  window.attendEvent = attendEvent;
  window.subscribeToPartnership = subscribeToPartnership;
  window.followUser = followUser;
  window.requestCertification = requestCertification;
  window.viewStory = viewStory;
  window.searchContent = searchContent;
  window.changeAvatar = changeAvatar;
  window.closeAvatarModal = closeAvatarModal;
  window.previewAvatar = previewAvatar;
  window.saveAvatar = saveAvatar;
  window.createOrder = createOrder;
  window.confirmOrder = confirmOrder;
  window.closeOrderModal = closeOrderModal;
  window.openNotifications = openNotifications;
  window.closeNotifications = closeNotifications;
  window.markNotificationAsRead = markNotificationAsRead;
  window.markAllNotificationsAsRead = markAllNotificationsAsRead;
  window.switchSection = switchSection;
</script>
</body>
    </html>
