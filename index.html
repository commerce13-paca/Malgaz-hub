<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MalGaz-Hub 401</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <style>
        :root {
            --primary-color: #ff2d55;
            --secondary-color: #5856d6;
            --dark-bg: #000000;
            --card-bg: #1c1c1e;
            --text-primary: #ffffff;
            --text-secondary: #8e8e93;
            --accent: #32d74b;
            --youtube-red: #ff0000;
            --navbar-height: 60px;
            --header-height: 60px;
            --safe-area-top: env(safe-area-inset-top, 0px);
            --safe-area-bottom: env(safe-area-inset-bottom, 0px);
            --safe-area-left: env(safe-area-inset-left, 0px);
            --safe-area-right: env(safe-area-inset-right, 0px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
            -webkit-text-size-adjust: 100%;
        }

        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            background-color: var(--dark-bg);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            position: fixed;
            touch-action: pan-y;
        }

        /* Interface caméra VERTICALE comme Snapchat */
        .camera-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            height: -webkit-fill-available;
            height: calc(var(--vh, 1vh) * 100);
            background-color: #000;
            z-index: 4000;
            display: flex;
            flex-direction: column;
            padding-top: var(--safe-area-top);
            padding-left: var(--safe-area-left);
            padding-right: var(--safe-area-right);
            padding-bottom: var(--safe-area-bottom);
            touch-action: none;
        }

        .camera-container.hidden {
            display: none;
        }

        .camera-header {
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: transparent;
            z-index: 10;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding-top: calc(12px + var(--safe-area-top));
        }

        .camera-preview {
            flex: 1;
            position: relative;
            overflow: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .camera-view {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .camera-feed {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
        }

        .camera-feed.portrait {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .camera-feed.landscape {
            width: auto;
            height: 100%;
            object-fit: contain;
        }

        .camera-feed.front {
            transform: scaleX(-1);
        }

        .camera-feed.back {
            transform: scaleX(1);
        }

        /* Contrôles caméra positionnés correctement */
        .camera-controls {
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: transparent;
            z-index: 10;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding-bottom: calc(30px + var(--safe-area-bottom));
        }

        .capture-btn {
            width: 78px;
            height: 78px;
            border-radius: 50%;
            background-color: white;
            border: 6px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 25px;
            transition: all 0.2s;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .capture-btn:active {
            transform: scale(0.9);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .capture-btn.recording {
            background-color: var(--primary-color);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 45, 85, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(255, 45, 85, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 45, 85, 0); }
        }

        .camera-options {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 350px;
            position: relative;
        }

        .camera-option {
            background: rgba(0, 0, 0, 0.3);
            border: none;
            color: white;
            font-size: 1.3rem;
            padding: 12px;
            opacity: 0.9;
            transition: all 0.2s;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            cursor: pointer;
        }

        .camera-option:active {
            opacity: 1;
            background: rgba(255, 255, 255, 0.1);
        }

        .switch-camera {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.5);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            border: none;
            z-index: 100;
            backdrop-filter: blur(10px);
            cursor: pointer;
        }

        /* Navigation bottom */
        .navbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: calc(var(--navbar-height) + var(--safe-area-bottom));
            background-color: rgba(28, 28, 30, 0.98);
            backdrop-filter: blur(30px);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 1000;
            border-top: 1px solid rgba(255, 255, 255, 0.08);
            padding-bottom: var(--safe-area-bottom);
            padding-left: var(--safe-area-left);
            padding-right: var(--safe-area-right);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px 12px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.65rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 12px;
            min-width: 60px;
            cursor: pointer;
        }

        .nav-item:hover, .nav-item:active {
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-item.active {
            color: var(--primary-color);
            transform: translateY(-2px);
        }

        .nav-item i {
            font-size: 1.3rem;
            margin-bottom: 4px;
            transition: transform 0.3s ease;
        }

        .nav-item.active i {
            transform: scale(1.1);
        }

        .nav-item.camera {
            background: linear-gradient(135deg, var(--primary-color), #ff375f);
            color: white;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            margin-top: -28px;
            box-shadow: 0 6px 20px rgba(255, 45, 85, 0.4);
            border: 4px solid var(--dark-bg);
            transition: all 0.3s ease;
        }

        .nav-item.camera:active {
            transform: scale(0.95);
        }

        /* Contenu principal avec scroll snap */
        .main-content {
            height: 100vh;
            height: calc(var(--vh, 1vh) * 100);
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            padding-bottom: calc(var(--navbar-height) + var(--safe-area-bottom));
            display: none;
            width: 100%;
            position: relative;
            scroll-snap-type: y mandatory;
        }

        .main-content.active {
            display: block;
        }

        .page {
            display: none;
            min-height: 100vh;
            width: 100%;
            scroll-snap-align: start;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Header avec logo et profil */
        .header {
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--dark-bg);
            position: sticky;
            top: 0;
            z-index: 100;
            height: var(--header-height);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            padding-top: calc(15px + var(--safe-area-top));
            padding-left: calc(15px + var(--safe-area-left));
            padding-right: calc(15px + var(--safe-area-right));
        }

        .logo {
            font-size: 1.4rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        .logo span {
            color: var(--accent);
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .header-btn {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.2rem;
            padding: 8px;
            border-radius: 50%;
            transition: background 0.2s;
            position: relative;
            cursor: pointer;
        }

        .header-btn:active {
            background: rgba(255, 255, 255, 0.1);
        }

        .notification-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 8px;
            height: 8px;
            background: var(--primary-color);
            border-radius: 50%;
            border: 2px solid var(--dark-bg);
        }

        /* Profil dans header */
        .header-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .header-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            border: 2px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        .header-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* PAGE ACCUEIL avec scroll snap pour les vidéos */
        #homePage {
            padding-bottom: 80px;
            width: 100%;
            height: 100vh;
            height: calc(var(--vh, 1vh) * 100);
            overflow-y: auto;
            scroll-snap-type: y mandatory;
            -webkit-overflow-scrolling: touch;
        }

        /* Stories améliorées */
        .stories-container {
            padding: 15px 15px 10px 15px;
            overflow-x: auto;
            white-space: nowrap;
            scrollbar-width: none;
            margin-bottom: 20px;
            width: 100%;
            -webkit-overflow-scrolling: touch;
            scroll-snap-align: start;
        }

        .stories-container::-webkit-scrollbar {
            display: none;
        }

        .story {
            display: inline-block;
            width: 80px;
            margin-right: 12px;
            text-align: center;
            vertical-align: top;
            position: relative;
            cursor: pointer;
        }

        .story-avatar {
            width: 68px;
            height: 68px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff2d55, #ff375f, #5856d6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 6px;
            border: 3px solid var(--dark-bg);
            background-clip: padding-box;
            position: relative;
            transition: transform 0.2s;
            overflow: hidden;
        }

        .story-avatar:active {
            transform: scale(0.95);
        }

        .story-avatar.my-story {
            border: 3px solid var(--dark-bg);
            background: var(--card-bg);
        }

        .story-avatar.my-story i {
            font-size: 1.5rem;
            color: var(--text-secondary);
        }

        .story-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .story-name {
            font-size: 0.7rem;
            color: var(--text-primary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-weight: 500;
        }

        .story-live {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary-color);
            color: white;
            font-size: 0.6rem;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 600;
            border: 2px solid var(--dark-bg);
        }

        /* Feed de vidéos amélioré - PLEIN ÉCRAN VERTICAL avec snap */
        .video-feed {
            display: flex;
            flex-direction: column;
            width: 100%;
            scroll-snap-type: y mandatory;
        }

        .video-container {
            position: relative;
            width: 100vw;
            background-color: #000;
            overflow: hidden;
            height: calc(var(--vh, 1vh) * 100);
            scroll-snap-align: start;
            scroll-snap-stop: always;
            display: flex;
            flex-direction: column;
        }

        .video-wrapper {
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .video-player {
            width: 100%;
            height: 100%;
            object-fit: contain;
            position: absolute;
            top: 0;
            left: 0;
            background-color: #000;
        }

        /* Pour les vidéos verticales */
        .video-player.vertical {
            object-fit: cover;
            height: 100%;
            width: auto;
            max-width: 100%;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Pour les vidéos horizontales */
        .video-player.horizontal {
            object-fit: contain;
            width: 100%;
            height: auto;
            max-height: 100%;
        }

        .video-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px 15px;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            z-index: 10;
            padding-bottom: calc(30px + var(--safe-area-bottom));
            pointer-events: none;
        }

        .video-overlay * {
            pointer-events: auto;
        }

        .video-info {
            margin-bottom: 15px;
        }

        .video-creator {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .creator-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            border: 2px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
            cursor: pointer;
        }

        .creator-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .creator-info {
            flex: 1;
        }

        .creator-name {
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 2px;
            cursor: pointer;
        }

        .creator-time {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .video-description {
            font-size: 0.95rem;
            margin-bottom: 10px;
            line-height: 1.4;
            max-height: 80px;
            overflow-y: auto;
        }

        .video-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 10px;
        }

        .tag {
            background-color: rgba(255, 255, 255, 0.15);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .video-actions {
            position: absolute;
            right: 15px;
            bottom: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            z-index: 20;
        }

        .action-btn {
            background: none;
            border: none;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.75rem;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.2s;
            cursor: pointer;
        }

        .action-btn:active {
            background: rgba(255, 255, 255, 0.1);
        }

        .action-btn i {
            font-size: 1.6rem;
            margin-bottom: 4px;
            background-color: rgba(0, 0, 0, 0.3);
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .action-btn.liked i {
            color: var(--primary-color);
        }

        .follow-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: auto;
            cursor: pointer;
        }

        .follow-btn.following {
            background: var(--text-secondary);
        }

        /* PAGE EXPLORER */
        #explorePage {
            padding: 15px;
            padding-left: calc(15px + var(--safe-area-left));
            padding-right: calc(15px + var(--safe-area-right));
            scroll-snap-align: start;
        }

        .search-bar {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 12px 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .search-bar i {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .search-input {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1rem;
            flex: 1;
            outline: none;
            width: 100%;
        }

        .search-input::placeholder {
            color: var(--text-secondary);
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 25px;
        }

        .category-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: transform 0.2s, background 0.2s;
            cursor: pointer;
        }

        .category-card:active {
            transform: scale(0.98);
            background: rgba(255, 255, 255, 0.05);
        }

        .category-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 12px;
            font-size: 1.3rem;
        }

        .category-title {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 4px;
        }

        .category-count {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .trending-section {
            margin-top: 25px;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .see-all {
            font-size: 0.85rem;
            color: var(--primary-color);
            font-weight: 500;
            cursor: pointer;
        }

        .trending-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .trending-card {
            background: var(--card-bg);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
        }

        .trending-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }

        .trending-info {
            padding: 12px;
        }

        .trending-name {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 4px;
        }

        .trending-stats {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* PAGE YOUTUBE */
        #youtubePage {
            padding: 15px;
            padding-bottom: 80px;
            padding-left: calc(15px + var(--safe-area-left));
            padding-right: calc(15px + var(--safe-area-right));
            scroll-snap-align: start;
        }

        .youtube-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 10px 0;
        }

        .youtube-logo {
            color: var(--youtube-red);
            font-size: 1.8rem;
        }

        .youtube-title {
            font-size: 1.4rem;
            font-weight: 700;
        }

        .youtube-search {
            position: relative;
            margin-bottom: 20px;
        }

        .youtube-search-input {
            width: 100%;
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 14px 50px 14px 20px;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: inherit;
        }

        .youtube-search-input:focus {
            outline: none;
            border-color: var(--youtube-red);
        }

        .youtube-search-btn {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
        }

        .youtube-categories {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            margin-bottom: 20px;
            padding-bottom: 5px;
            scrollbar-width: none;
        }

        .youtube-categories::-webkit-scrollbar {
            display: none;
        }

        .youtube-category {
            padding: 8px 16px;
            background: var(--card-bg);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.85rem;
            white-space: nowrap;
            transition: all 0.2s;
            cursor: pointer;
        }

        .youtube-category.active {
            background: var(--youtube-red);
            border-color: var(--youtube-red);
        }

        .youtube-videos {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .youtube-video-card {
            background: var(--card-bg);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
        }

        .youtube-thumbnail {
            width: 100%;
            height: 180px;
            object-fit: cover;
            display: block;
        }

        .youtube-video-info {
            padding: 12px;
        }

        .youtube-channel {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .youtube-channel-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff2d55, var(--youtube-red));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .youtube-channel-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .youtube-video-title {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 6px;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .youtube-video-stats {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .loading-video {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 180px;
            background: var(--card-bg);
            border-radius: 16px;
        }

        .loading-video i {
            font-size: 2rem;
            color: var(--youtube-red);
            animation: spin 1s linear infinite;
        }

        /* PAGE JEUX */
        #gamesPage {
            padding: 15px;
            padding-bottom: 80px;
            padding-left: calc(15px + var(--safe-area-left));
            padding-right: calc(15px + var(--safe-area-right));
            scroll-snap-align: start;
        }

        .games-carousel {
            margin-bottom: 25px;
        }

        .carousel-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .carousel-container {
            position: relative;
            overflow: hidden;
            border-radius: 20px;
            height: 180px;
        }

        .carousel-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .carousel-slide.active {
            opacity: 1;
            position: relative;
        }

        .carousel-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 20px;
        }

        .carousel-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            border-radius: 0 0 20px 20px;
        }

        .carousel-game-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .carousel-game-desc {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .carousel-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 12px;
        }

        .carousel-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: background 0.3s, transform 0.3s;
            cursor: pointer;
        }

        .carousel-dot.active {
            background: var(--primary-color);
            transform: scale(1.2);
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 25px;
        }

        .game-card {
            background: var(--card-bg);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: transform 0.2s;
            cursor: pointer;
        }

        .game-card:active {
            transform: scale(0.95);
        }

        .game-image {
            width: 100%;
            height: 100px;
            object-fit: cover;
        }

        .game-info {
            padding: 10px;
        }

        .game-title {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .game-category {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        /* PAGE PROFIL */
        #profilePage {
            padding-bottom: 80px;
            width: 100%;
            scroll-snap-align: start;
        }

        .profile-header {
            padding: 20px 15px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
            padding-left: calc(15px + var(--safe-area-left));
            padding-right: calc(15px + var(--safe-area-right));
        }

        .profile-top {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 600;
            border: 4px solid var(--dark-bg);
            position: relative;
            overflow: hidden;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .change-avatar {
            position: absolute;
            bottom: 0;
            right: 0;
            background: var(--primary-color);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            border: 3px solid var(--dark-bg);
            cursor: pointer;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .profile-username {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .profile-bio {
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 15px;
            color: var(--text-secondary);
        }

        .profile-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat {
            text-align: center;
            cursor: pointer;
        }

        .stat-number {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .profile-actions {
            display: flex;
            gap: 10px;
        }

        .profile-btn {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            font-size: 0.95rem;
            transition: opacity 0.2s;
            cursor: pointer;
        }

        .profile-btn:active {
            opacity: 0.8;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-secondary {
            background: var(--card-bg);
            color: var(--text-primary);
        }

        .profile-posts {
            padding: 15px;
            padding-left: calc(15px + var(--safe-area-left));
            padding-right: calc(15px + var(--safe-area-right));
        }

        .posts-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2px;
        }

        .post-thumbnail {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            background: var(--card-bg);
            display: block;
        }

        /* Modal pour publication amélioré */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--dark-bg);
            z-index: 5000;
            display: none;
            flex-direction: column;
            padding-top: var(--safe-area-top);
            padding-left: var(--safe-area-left);
            padding-right: var(--safe-area-right);
            padding-bottom: var(--safe-area-bottom);
        }

        .modal.active {
            display: flex;
        }

        .modal-header {
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(28, 28, 30, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            padding-bottom: 20px;
        }

        .create-post {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .post-user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .post-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            overflow: hidden;
        }

        .post-user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .post-input {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.1rem;
            width: 100%;
            min-height: 120px;
            resize: none;
            font-family: inherit;
            line-height: 1.4;
        }

        .post-input::placeholder {
            color: var(--text-secondary);
        }

        .post-input:focus {
            outline: none;
        }

        .media-preview {
            width: 100%;
            height: 200px;
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 15px;
            background: var(--card-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .media-preview img, .media-preview video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .remove-media {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .post-options {
            display: flex;
            justify-content: space-around;
            padding: 20px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .post-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-secondary);
            padding: 10px;
            border-radius: 12px;
            transition: background 0.2s;
            cursor: pointer;
        }

        .post-option:active {
            background: rgba(255, 255, 255, 0.05);
        }

        .post-option i {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        /* Animation de chargement */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--dark-bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-logo {
            font-size: 3rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Utilitaires */
        .hidden {
            display: none !important;
        }

        .fullscreen-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 1500;
            display: none;
            padding-top: var(--safe-area-top);
        }

        .fullscreen-video.active {
            display: block;
        }

        .fullscreen-video video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .close-fullscreen {
            position: absolute;
            top: calc(20px + var(--safe-area-top));
            right: 20px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.2rem;
            z-index: 10;
            cursor: pointer;
        }

        /* Modal YouTube intégré */
        .youtube-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark-bg);
            z-index: 6000;
            display: none;
            flex-direction: column;
            padding-top: var(--safe-area-top);
        }

        .youtube-modal.active {
            display: flex;
        }

        .youtube-modal-header {
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(28, 28, 30, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .youtube-modal-content {
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        .youtube-player {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Style pour les listes de followers/following */
        .users-list-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark-bg);
            z-index: 7000;
            display: none;
            flex-direction: column;
            padding-top: var(--safe-area-top);
        }

        .users-list-modal.active {
            display: flex;
        }

        .users-list-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .user-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            overflow: hidden;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-details h4 {
            font-size: 1rem;
            margin-bottom: 2px;
        }

        .user-details p {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .follow-action-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
        }

        .follow-action-btn.following {
            background: transparent;
            border: 1px solid var(--text-secondary);
            color: var(--text-secondary);
        }

        /* Modal profil utilisateur */
        .user-profile-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark-bg);
            z-index: 8000;
            display: none;
            flex-direction: column;
            padding-top: var(--safe-area-top);
        }

        .user-profile-modal.active {
            display: flex;
        }

        .user-profile-content {
            flex: 1;
            overflow-y: auto;
        }

        .profile-avatar-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 600;
            margin: 20px auto;
            overflow: hidden;
        }

        .profile-avatar-large img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Style pour les stories vues */
        .story.seen .story-avatar {
            opacity: 0.7;
        }

        .story.seen .story-avatar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 50%;
        }

        /* MODAL MESSAGERIE */
        .messages-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark-bg);
            z-index: 9000;
            display: none;
            flex-direction: column;
            padding-top: var(--safe-area-top);
        }

        .messages-modal.active {
            display: flex;
        }

        .messages-header {
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(28, 28, 30, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .messages-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .conversations-list {
            width: 100%;
            background: var(--card-bg);
            border-radius: 16px;
            margin: 15px;
            overflow-y: auto;
            max-height: 300px;
        }

        .conversation-item {
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
        }

        .conversation-item:last-child {
            border-bottom: none;
        }

        .conversation-item:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .conversation-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.2rem;
            overflow: hidden;
        }

        .conversation-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .conversation-info {
            flex: 1;
        }

        .conversation-name {
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 4px;
        }

        .conversation-last-message {
            font-size: 0.85rem;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }

        .conversation-time {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        .unread-badge {
            background: var(--primary-color);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
        }

        /* Chat messages */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            padding: 15px;
        }

        .chat-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .chat-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            overflow: hidden;
        }

        .chat-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .chat-user-info h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .chat-user-info p {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 15px 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            word-wrap: break-word;
        }

        .message.sent {
            align-self: flex-end;
            background: var(--primary-color);
            border-bottom-right-radius: 4px;
        }

        .message.received {
            align-self: flex-start;
            background: var(--card-bg);
            border-bottom-left-radius: 4px;
        }

        .message-text {
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .message-time {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 4px;
            text-align: right;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
            align-items: center;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .chat-input {
            flex: 1;
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 12px 20px;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: inherit;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .send-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .send-btn:active {
            transform: scale(0.95);
        }

        /* Bouton messagerie dans le header */
        .messages-btn {
            position: relative;
        }

        /* Responsive */
        @media (max-width: 374px) {
            .games-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .categories-grid {
                grid-template-columns: 1fr;
            }
            
            .profile-avatar {
                width: 80px;
                height: 80px;
            }
        }

        @media (min-width: 768px) {
            .main-content {
                max-width: 500px;
                margin: 0 auto;
                box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.05);
            }
            
            .navbar {
                max-width: 500px;
                left: 50%;
                transform: translateX(-50%);
            }
            
            .video-container {
                max-width: 500px;
                margin: 0 auto;
            }
        }

        /* Scrollbar personnalisée */
        .main-content::-webkit-scrollbar {
            width: 0;
        }

        /* Touch feedback */
        .touch-feedback:active {
            opacity: 0.7;
        }

        /* Pour iOS */
        @supports (-webkit-touch-callout: none) {
            .camera-container, .main-content {
                height: -webkit-fill-available;
            }
            
            .video-container {
                height: -webkit-fill-available;
            }
        }

        /* Orientation */
        @media (orientation: landscape) {
            .camera-feed {
                width: auto;
                height: 100%;
            }
        }

        /* Indicateur de scroll */
        .scroll-indicator {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            z-index: 100;
            backdrop-filter: blur(10px);
            display: none;
            animation: fadeInOut 3s ease;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body>
    <!-- Écran de chargement -->
    <div class="loading" id="loading">
        <div class="loading-logo">MalGaz-Hub<span>401</span></div>
        <div class="spinner"></div>
    </div>

    <!-- CAMÉRA VERTICALE AU PREMIER PLAN -->
    <div class="camera-container" id="cameraContainer">
        <div class="camera-header">
            <button class="camera-option" id="closeCamera">
                <i class="fas fa-times"></i>
            </button>
            <div style="color: white; font-weight: 500;">MalGaz Camera</div>
            <button class="camera-option" id="toggleFlash">
                <i class="fas fa-bolt"></i>
            </button>
        </div>
        
        <div class="camera-preview">
            <div class="camera-view" id="cameraView">
                <video class="camera-feed portrait" id="cameraFeed" autoplay playsinline></video>
                <button class="switch-camera" id="switchCamera">
                    <i class="fas fa-camera-rotate"></i>
                </button>
            </div>
        </div>
        
        <div class="camera-controls">
            <button class="capture-btn" id="captureBtn"></button>
            <div class="camera-options">
                <button class="camera-option" id="galleryBtn">
                    <i class="fas fa-image"></i>
                </button>
                <button class="camera-option" id="videoModeBtn">
                    <i class="fas fa-video"></i>
                </button>
                <button class="camera-option" id="effectsBtn">
                    <i class="fas fa-magic"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Interface principale (cachée au début) -->
    <div class="main-content" id="mainContent">
        <!-- Header avec profil intégré -->
        <div class="header">
            <div class="logo">MalGaz-Hub<span>401</span></div>
            <div class="header-actions">
                <button class="header-btn messages-btn" id="messagesBtn">
                    <i class="fas fa-comments"></i>
                    <span class="notification-badge"></span>
                </button>
                <button class="header-btn" id="searchBtn">
                    <i class="fas fa-search"></i>
                </button>
                <button class="header-btn" id="notificationsBtn">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge"></span>
                </button>
                <div class="header-profile" id="headerProfile">
                    <div class="header-avatar" id="headerAvatar">M</div>
                </div>
            </div>
        </div>

        <!-- Pages -->
        <div class="page active" id="homePage">
            <!-- Stories -->
            <div class="stories-container" id="storiesContainer">
                <!-- Stories générées dynamiquement -->
            </div>

            <!-- Feed de vidéos VERTICAL -->
            <div class="video-feed" id="videoFeed">
                <!-- Vidéos générées dynamiquement -->
            </div>
        </div>

        <div class="page" id="explorePage">
            <!-- Contenu Explorer -->
        </div>

        <div class="page" id="youtubePage">
            <!-- Contenu YouTube -->
        </div>

        <div class="page" id="gamesPage">
            <!-- Contenu Jeux -->
        </div>

        <div class="page" id="profilePage">
            <!-- Contenu Profil -->
        </div>
    </div>

    <!-- Navigation bottom -->
    <nav class="navbar">
        <a href="#" class="nav-item active" data-page="home">
            <i class="fas fa-home"></i>
            <span>Accueil</span>
        </a>
        <a href="#" class="nav-item" data-page="explore">
            <i class="fas fa-search"></i>
            <span>Explorer</span>
        </a>
        <a href="#" class="nav-item camera" id="openCameraBtn">
            <i class="fas fa-camera"></i>
        </a>
        <a href="#" class="nav-item" data-page="youtube">
            <i class="fab fa-youtube" style="color: #ff0000;"></i>
            <span style="color: #ff0000;">YouTube</span>
        </a>
        <a href="#" class="nav-item" data-page="games">
            <i class="fas fa-gamepad"></i>
            <span>Jeux</span>
        </a>
    </nav>

    <!-- Modal pour publication -->
    <div class="modal" id="postModal">
        <div class="modal-header">
            <button class="camera-option" id="closePostModal">
                <i class="fas fa-times"></i>
            </button>
            <div style="color: white; font-weight: 500;">Nouvelle publication</div>
            <button class="camera-option" id="publishPost" style="color: var(--primary-color);">
                Publier
            </button>
        </div>
        
        <div class="modal-content">
            <div class="create-post">
                <div class="post-user-info">
                    <div class="post-user-avatar" id="postUserAvatar">
                        <!-- Avatar chargé dynamiquement -->
                    </div>
                    <div>
                        <div style="font-weight: 600;" id="postUserName">Chargement...</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">Publier maintenant</div>
                    </div>
                </div>
                
                <textarea class="post-input" placeholder="Décrivez votre publication..." id="postCaption"></textarea>
                
                <div class="media-preview" id="mediaPreview">
                    <!-- Aperçu de la photo/vidéo -->
                    <div style="text-align: center; color: var(--text-secondary);">
                        <i class="fas fa-image" style="font-size: 3rem; margin-bottom: 10px;"></i>
                        <p>Aperçu de votre média</p>
                    </div>
                </div>
                
                <div class="post-options">
                    <div class="post-option" id="addPhoto">
                        <i class="fas fa-image"></i>
                        <span>Photo</span>
                    </div>
                    <div class="post-option" id="addVideo">
                        <i class="fas fa-video"></i>
                        <span>Vidéo</span>
                    </div>
                    <div class="post-option" id="addLocation">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>Lieu</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal profil utilisateur -->
    <div class="user-profile-modal" id="userProfileModal">
        <div class="modal-header">
            <button class="camera-option" id="closeUserProfile">
                <i class="fas fa-times"></i>
            </button>
            <div style="color: white; font-weight: 500;" id="userProfileTitle">Profil</div>
            <button class="camera-option" id="userProfileAction" style="color: var(--primary-color);">
                Suivre
            </button>
        </div>
        
        <div class="user-profile-content" id="userProfileContent">
            <!-- Contenu du profil chargé dynamiquement -->
        </div>
    </div>

    <!-- Modal édition profil -->
    <div class="modal" id="profileEditModal">
        <div class="modal-header">
            <button class="camera-option" id="closeProfileEdit">
                <i class="fas fa-times"></i>
            </button>
            <div style="color: white; font-weight: 500;">Modifier le profil</div>
            <button class="camera-option" id="saveProfile" style="color: var(--primary-color);">
                Enregistrer
            </button>
        </div>
        
        <div class="modal-content">
            <div class="form-group">
                <label class="form-label">Photo de profil</label>
                <div style="text-align: center;">
                    <div class="profile-avatar" id="editAvatarPreview" style="margin: 0 auto 20px; width: 100px; height: 100px;">
                        <div class="change-avatar" id="changeAvatarBtn">
                            <i class="fas fa-camera"></i>
                        </div>
                    </div>
                    <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Nom complet</label>
                <input type="text" class="form-input" id="editName" placeholder="Votre nom">
            </div>
            
            <div class="form-group">
                <label class="form-label">Nom d'utilisateur</label>
                <input type="text" class="form-input" id="editUsername" placeholder="@username">
            </div>
            
            <div class="form-group">
                <label class="form-label">Bio</label>
                <textarea class="form-textarea" id="editBio" placeholder="Décrivez-vous..."></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">Site web</label>
                <input type="url" class="form-input" id="editWebsite" placeholder="https://">
            </div>
        </div>
    </div>

    <!-- Modal jeu -->
    <div class="modal" id="gameModal">
        <div class="modal-header">
            <button class="camera-option" id="closeGameModal">
                <i class="fas fa-times"></i>
            </button>
            <div style="color: white; font-weight: 500;" id="gameModalTitle">Jeu</div>
            <button class="camera-option" style="visibility: hidden;">
                <i class="fas fa-cog"></i>
            </button>
        </div>
        
        <div class="modal-content">
            <iframe class="youtube-player" id="gameIframe" allowfullscreen></iframe>
        </div>
    </div>

    <!-- Modal YouTube intégré -->
    <div class="youtube-modal" id="youtubeModal">
        <div class="youtube-modal-header">
            <button class="camera-option" id="closeYouTubeModal">
                <i class="fas fa-times"></i>
            </button>
            <div style="color: white; font-weight: 500;" id="youtubeModalTitle">YouTube</div>
            <button class="camera-option" style="visibility: hidden;">
                <i class="fas fa-cog"></i>
            </button>
        </div>
        
        <div class="youtube-modal-content">
            <iframe class="youtube-player" id="youtubePlayer" allowfullscreen></iframe>
        </div>
    </div>

    <!-- Modal liste followers/following -->
    <div class="users-list-modal" id="usersListModal">
        <div class="modal-header">
            <button class="camera-option" id="closeUsersList">
                <i class="fas fa-times"></i>
            </button>
            <div style="color: white; font-weight: 500;" id="usersListTitle">Utilisateurs</div>
            <div style="width: 40px;"></div>
        </div>
        
        <div class="users-list-content" id="usersListContent">
            <!-- Liste chargée dynamiquement -->
        </div>
    </div>

    <!-- Modal messagerie -->
    <div class="messages-modal" id="messagesModal">
        <div class="messages-header">
            <button class="camera-option" id="closeMessages">
                <i class="fas fa-times"></i>
            </button>
            <div style="color: white; font-weight: 500;">Messagerie</div>
            <button class="camera-option" id="newMessageBtn" style="color: var(--primary-color);">
                <i class="fas fa-plus"></i>
            </button>
        </div>
        
        <div class="messages-content">
            <div class="conversations-list" id="conversationsList">
                <!-- Conversations chargées dynamiquement -->
            </div>
            
            <div class="chat-container" id="chatContainer" style="display: none;">
                <div class="chat-header" id="chatHeader">
                    <!-- En-tête du chat chargé dynamiquement -->
                </div>
                <div class="messages-container" id="messagesContainer">
                    <!-- Messages chargés dynamiquement -->
                </div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chatInput" placeholder="Écrivez un message...">
                    <button class="send-btn" id="sendMessageBtn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Vidéo en plein écran -->
    <div class="fullscreen-video" id="fullscreenVideo">
        <button class="close-fullscreen" id="closeFullscreen">
            <i class="fas fa-times"></i>
        </button>
        <video controls id="fullscreenVideoPlayer">
            Votre navigateur ne supporte pas la lecture de vidéos.
        </video>
    </div>

    <!-- Indicateur de scroll -->
    <div class="scroll-indicator" id="scrollIndicator">
        <i class="fas fa-arrow-down"></i> Défilez pour voir plus
    </div>

    <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
    <script>
        // Configuration YouTube API
        const YOUTUBE_API_KEY = 'AIzaSyDhfy-hOznVoLMAaJnpfcw3w7r4uj0Q-zo';
        
        // Données de l'application COMPLÈTES avec messagerie
        const appData = {
            currentUser: {
                id: 1,
                name: "MalGaz User",
                username: "@malgaz401",
                bio: "Bienvenue sur mon profil ! 🚀 Passionné de gaming, tech et vidéos.",
                avatar: null,
                posts: 24,
                followers: 1483,
                following: 356,
                website: "malgaz-hub.com",
                followingUsers: [2, 3, 4, 5],
                likedPosts: [1, 3],
                story: null
            },
            users: [
                {
                    id: 1,
                    name: "MalGaz User",
                    username: "@malgaz401",
                    avatar: null,
                    isFollowing: false,
                    isCurrentUser: true,
                    posts: 24,
                    followers: 1483,
                    following: 356,
                    bio: "Bienvenue sur mon profil ! 🚀 Passionné de gaming, tech et vidéos."
                },
                {
                    id: 2,
                    name: "Alex Gaming",
                    username: "@alex_gaming",
                    avatar: null,
                    isFollowing: true,
                    posts: 42,
                    followers: 12400,
                    following: 230,
                    bio: "Streamer professionnel • Gaming content creator 🎮"
                },
                {
                    id: 3,
                    name: "Sarah Tech",
                    username: "@sarah_tech",
                    avatar: null,
                    isFollowing: true,
                    posts: 18,
                    followers: 8900,
                    following: 156,
                    bio: "Tech reviewer & developer 📱💻"
                },
                {
                    id: 4,
                    name: "Mike Travel",
                    username: "@mike_travel",
                    avatar: null,
                    isFollowing: true,
                    posts: 56,
                    followers: 5600,
                    following: 89,
                    bio: "Globe-trotter 🌍 • Photographe voyage"
                },
                {
                    id: 5,
                    name: "Emma Style",
                    username: "@emma_style",
                    avatar: null,
                    isFollowing: false,
                    posts: 78,
                    followers: 23400,
                    following: 450,
                    bio: "Fashion influencer 👗 • Lifestyle content"
                }
            ],
            stories: [
                { 
                    id: 1, 
                    userId: 1,
                    type: 'image',
                    mediaUrl: null,
                    createdAt: new Date(),
                    seenBy: []
                },
                { 
                    id: 2, 
                    userId: 2,
                    type: 'image',
                    mediaUrl: 'https://picsum.photos/400/600?random=1',
                    createdAt: new Date(Date.now() - 2*60*60*1000),
                    seenBy: [1],
                    isLive: false
                },
                { 
                    id: 3, 
                    userId: 3,
                    type: 'video',
                    mediaUrl: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4',
                    createdAt: new Date(Date.now() - 4*60*60*1000),
                    seenBy: [],
                    isLive: true
                }
            ],
            posts: [
                {
                    id: 1,
                    userId: 2,
                    type: 'video',
                    mediaUrl: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4',
                    caption: "Nouveau record sur le dernier niveau ! 🎮 #gaming #record #victory",
                    likes: 3240,
                    comments: 189,
                    shares: 56,
                    createdAt: new Date(Date.now() - 2*60*60*1000),
                    tags: ["gaming", "record", "stream", "esport"],
                    location: "Paris, France",
                    videoOrientation: 'horizontal'
                },
                {
                    id: 2,
                    userId: 3,
                    type: 'image',
                    mediaUrl: 'https://picsum.photos/400/600?random=6',
                    caption: "Test du nouveau smartphone en conditions réelles 📱 #tech #review #gadget",
                    likes: 4120,
                    comments: 310,
                    shares: 92,
                    createdAt: new Date(Date.now() - 4*60*60*1000),
                    tags: ["tech", "review", "smartphone", "gadget"],
                    location: "San Francisco"
                },
                {
                    id: 3,
                    userId: 4,
                    type: 'video',
                    mediaUrl: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerFun.mp4',
                    caption: "Découverte des montagnes japonaises 🗻 #travel #japan #adventure #nature",
                    likes: 5280,
                    comments: 412,
                    shares: 128,
                    createdAt: new Date(Date.now() - 6*60*60*1000),
                    tags: ["travel", "japan", "mountains", "adventure"],
                    location: "Tokyo, Japan",
                    videoOrientation: 'horizontal'
                },
                {
                    id: 4,
                    userId: 5,
                    type: 'image',
                    mediaUrl: 'https://picsum.photos/400/600?random=7',
                    caption: "Nouvelle collection automne-hiver 2024 👗 #fashion #style #ootd",
                    likes: 8900,
                    comments: 523,
                    shares: 234,
                    createdAt: new Date(Date.now() - 8*60*60*1000),
                    tags: ["fashion", "style", "ootd", "collection"],
                    location: "Milan, Italy"
                }
            ],
            // Ajout de vidéos verticales
            verticalVideos: [
                {
                    id: 5,
                    userId: 2,
                    type: 'video',
                    mediaUrl: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4',
                    caption: "Découvrez ce nouveau jeu mobile incroyable! 📱 #mobilegaming #gaming #fun",
                    likes: 2150,
                    comments: 89,
                    shares: 42,
                    createdAt: new Date(Date.now() - 1*60*60*1000),
                    tags: ["mobile", "gaming", "fun", "gameplay"],
                    location: "Los Angeles",
                    videoOrientation: 'vertical'
                },
                {
                    id: 6,
                    userId: 3,
                    type: 'video',
                    mediaUrl: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4',
                    caption: "Unboxing du nouveau MacBook Pro! 🎥 #unboxing #tech #apple",
                    likes: 3800,
                    comments: 156,
                    shares: 78,
                    createdAt: new Date(Date.now() - 3*60*60*1000),
                    tags: ["unboxing", "tech", "apple", "macbook"],
                    location: "Cupertino",
                    videoOrientation: 'vertical'
                }
            ],
            games: [
                {
                    id: 1,
                    title: "The Last Man",
                    category: "Action",
                    image: "https://imgs2.dab3games.com/the-last-man-game816.png",
                    url: "https://lagged.com/games/play2/the-last-man-60104/",
                    description: "Survie contre les zombies"
                }
            ],
            exploreCategories: [
                { id: 1, name: "Tendances", icon: "fas fa-fire", count: "1.2K" },
                { id: 2, name: "Musique", icon: "fas fa-music", count: "856" },
                { id: 3, name: "Gaming", icon: "fas fa-gamepad", count: "2.4K" },
                { id: 4, name: "Sport", icon: "fas fa-futbol", count: "732" }
            ],
            trendingPosts: [
                { id: 1, name: "Championnat Gaming", image: "https://picsum.photos/400/300?random=8", views: "245K" },
                { id: 2, name: "Nouvelle Tech", image: "https://picsum.photos/400/300?random=9", views: "189K" },
                { id: 3, name: "Voyage Extreme", image: "https://picsum.photos/400/300?random=10", views: "312K" },
                { id: 4, name: "Mode 2024", image: "https://picsum.photos/400/300?random=11", views: "156K" }
            ],
            youtubeVideos: [],
            youtubeCategories: [
                "Toutes", "Musique", "Gaming", "Sport", "Actualités", 
                "Cuisine", "Tech", "Fitness", "Éducation", "Divertissement"
            ],
            // Données de messagerie
            conversations: [
                {
                    id: 1,
                    userId: 2,
                    lastMessage: "Salut! Tu as vu ma dernière vidéo?",
                    lastMessageTime: new Date(Date.now() - 30*60*1000),
                    unread: 2,
                    messages: [
                        {
                            id: 1,
                            senderId: 2,
                            text: "Salut! Comment ça va?",
                            time: new Date(Date.now() - 2*60*60*1000),
                            read: true
                        },
                        {
                            id: 2,
                            senderId: 1,
                            text: "Ça va bien merci! Et toi?",
                            time: new Date(Date.now() - 1.5*60*60*1000),
                            read: true
                        },
                        {
                            id: 3,
                            senderId: 2,
                            text: "Super! Tu as vu ma dernière vidéo?",
                            time: new Date(Date.now() - 1*60*60*1000),
                            read: true
                        },
                        {
                            id: 4,
                            senderId: 2,
                            text: "Salut! Tu as vu ma dernière vidéo?",
                            time: new Date(Date.now() - 30*60*1000),
                            read: false
                        }
                    ]
                },
                {
                    id: 2,
                    userId: 3,
                    lastMessage: "Le nouveau smartphone est incroyable!",
                    lastMessageTime: new Date(Date.now() - 2*60*60*1000),
                    unread: 0,
                    messages: [
                        {
                            id: 1,
                            senderId: 3,
                            text: "Salut! J'ai testé le nouveau smartphone",
                            time: new Date(Date.now() - 3*60*60*1000),
                            read: true
                        },
                        {
                            id: 2,
                            senderId: 1,
                            text: "Ah bon? Il est comment?",
                            time: new Date(Date.now() - 2.5*60*60*1000),
                            read: true
                        },
                        {
                            id: 3,
                            senderId: 3,
                            text: "Le nouveau smartphone est incroyable!",
                            time: new Date(Date.now() - 2*60*60*1000),
                            read: true
                        }
                    ]
                },
                {
                    id: 3,
                    userId: 4,
                    lastMessage: "Les photos du Japon sont prêtes!",
                    lastMessageTime: new Date(Date.now() - 1*24*60*60*1000),
                    unread: 1,
                    messages: [
                        {
                            id: 1,
                            senderId: 4,
                            text: "Salut! Je suis de retour du Japon",
                            time: new Date(Date.now() - 2*24*60*60*1000),
                            read: true
                        },
                        {
                            id: 2,
                            senderId: 1,
                            text: "Cool! Tu as pris des photos?",
                            time: new Date(Date.now() - 1.5*24*60*60*1000),
                            read: true
                        },
                        {
                            id: 3,
                            senderId: 4,
                            text: "Les photos du Japon sont prêtes!",
                            time: new Date(Date.now() - 1*24*60*60*1000),
                            read: false
                        }
                    ]
                }
            ]
        };

        // Variables globales
        let currentPage = 'home';
        let currentVideoIndex = 0;
        let isFrontCamera = true;
        let capturedMedia = null;
        let capturedMediaType = 'image';
        let videoPlayers = [];
        let carouselIndex = 0;
        let carouselInterval;
        let mediaStream = null;
        let isRecording = false;
        let mediaRecorder = null;
        let recordedChunks = [];
        
        // Variables YouTube
        let currentYouTubeVideo = null;
        let isFetchingYouTube = false;
        
        // Variables caméra
        let flashEnabled = false;
        let isVideoMode = false;
        
        // Variables profil
        let currentViewedUser = null;
        
        // Variables messagerie
        let currentConversation = null;
        let isInChat = false;

        // Éléments DOM
        const loadingScreen = document.getElementById('loading');
        const mainContent = document.getElementById('mainContent');
        const cameraContainer = document.getElementById('cameraContainer');
        const pages = document.querySelectorAll('.page');
        const navItems = document.querySelectorAll('.nav-item');
        const homePage = document.getElementById('homePage');
        const explorePage = document.getElementById('explorePage');
        const youtubePage = document.getElementById('youtubePage');
        const gamesPage = document.getElementById('gamesPage');
        const profilePage = document.getElementById('profilePage');
        const storiesContainer = document.getElementById('storiesContainer');
        const videoFeed = document.getElementById('videoFeed');
        const headerProfile = document.getElementById('headerProfile');
        const headerAvatar = document.getElementById('headerAvatar');
        
        // Boutons navigation
        const openCameraBtn = document.getElementById('openCameraBtn');
        const closeCameraBtn = document.getElementById('closeCamera');
        const switchCameraBtn = document.getElementById('switchCamera');
        const captureBtn = document.getElementById('captureBtn');
        const cameraFeed = document.getElementById('cameraFeed');
        const toggleFlash = document.getElementById('toggleFlash');
        const videoModeBtn = document.getElementById('videoModeBtn');
        const galleryBtn = document.getElementById('galleryBtn');
        
        // Messagerie
        const messagesBtn = document.getElementById('messagesBtn');
        const messagesModal = document.getElementById('messagesModal');
        const closeMessages = document.getElementById('closeMessages');
        const newMessageBtn = document.getElementById('newMessageBtn');
        const conversationsList = document.getElementById('conversationsList');
        const chatContainer = document.getElementById('chatContainer');
        const chatHeader = document.getElementById('chatHeader');
        const messagesContainer = document.getElementById('messagesContainer');
        const chatInput = document.getElementById('chatInput');
        const sendMessageBtn = document.getElementById('sendMessageBtn');
        
        // Modals
        const postModal = document.getElementById('postModal');
        const closePostModal = document.getElementById('closePostModal');
        const publishPostBtn = document.getElementById('publishPost');
        const mediaPreview = document.getElementById('mediaPreview');
        const addPhotoBtn = document.getElementById('addPhoto');
        const addVideoBtn = document.getElementById('addVideo');
        const postCaption = document.getElementById('postCaption');
        const postUserAvatar = document.getElementById('postUserAvatar');
        const postUserName = document.getElementById('postUserName');
        
        // Profil
        const userProfileModal = document.getElementById('userProfileModal');
        const closeUserProfile = document.getElementById('closeUserProfile');
        const userProfileTitle = document.getElementById('userProfileTitle');
        const userProfileContent = document.getElementById('userProfileContent');
        const userProfileAction = document.getElementById('userProfileAction');
        
        const profileEditModal = document.getElementById('profileEditModal');
        const closeProfileEdit = document.getElementById('closeProfileEdit');
        const saveProfileBtn = document.getElementById('saveProfile');
        const editAvatarPreview = document.getElementById('editAvatarPreview');
        const changeAvatarBtn = document.getElementById('changeAvatarBtn');
        const avatarInput = document.getElementById('avatarInput');
        const editName = document.getElementById('editName');
        const editUsername = document.getElementById('editUsername');
        const editBio = document.getElementById('editBio');
        const editWebsite = document.getElementById('editWebsite');
        
        // Jeux
        const gameModal = document.getElementById('gameModal');
        const closeGameModal = document.getElementById('closeGameModal');
        const gameIframe = document.getElementById('gameIframe');
        const gameModalTitle = document.getElementById('gameModalTitle');
        
        // YouTube
        const youtubeModal = document.getElementById('youtubeModal');
        const closeYouTubeModal = document.getElementById('closeYouTubeModal');
        const youtubePlayer = document.getElementById('youtubePlayer');
        const youtubeModalTitle = document.getElementById('youtubeModalTitle');
        
        // Users list
        const usersListModal = document.getElementById('usersListModal');
        const closeUsersList = document.getElementById('closeUsersList');
        const usersListTitle = document.getElementById('usersListTitle');
        const usersListContent = document.getElementById('usersListContent');
        
        // Fullscreen video
        const fullscreenVideo = document.getElementById('fullscreenVideo');
        const closeFullscreenBtn = document.getElementById('closeFullscreen');
        const fullscreenVideoPlayer = document.getElementById('fullscreenVideoPlayer');
        
        // Scroll indicator
        const scrollIndicator = document.getElementById('scrollIndicator');

        // Initialisation - Ouvre directement la caméra comme Snapchat
        document.addEventListener('DOMContentLoaded', function() {
            setVH();
            window.addEventListener('resize', setVH);
            window.addEventListener('orientationchange', setVH);
            
            setTimeout(() => {
                loadingScreen.style.display = 'none';
                cameraContainer.classList.remove('hidden');
                setupCamera();
                initApp();
            }, 1500);
        });

        // Fonction pour ajuster la hauteur sur mobile
        function setVH() {
            let vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
            
            // Réajuster la hauteur des vidéos
            document.querySelectorAll('.video-container').forEach(container => {
                container.style.height = 'calc(var(--vh, 1vh) * 100)';
            });
        }

        function initApp() {
            // Initialiser les données
            initUserData();
            generateStories();
            generateVideoFeed();
            generateExplorePage();
            generateYouTubePage();
            generateGamesPage();
            generateProfilePage();
            generateConversationsList();
            setupVideoAutoplay();
            setupEventListeners();
            startCarousel();
            
            // Charger les vidéos YouTube
            fetchYouTubeVideos('tendances');
            
            // Mettre à jour le header
            updateHeaderProfile();
            
            // Mettre à jour le badge des messages
            updateMessagesBadge();
            
            // Afficher l'indicateur de scroll
            showScrollIndicator();
        }

        function initUserData() {
            // Initialiser les avatars des utilisateurs
            appData.users.forEach(user => {
                if (!user.avatar) {
                    user.avatar = `https://ui-avatars.com/api/?name=${encodeURIComponent(user.name)}&background=${getRandomColor()}&color=fff&size=128`;
                }
            });
            
            // Initialiser l'avatar de l'utilisateur courant
            if (!appData.currentUser.avatar) {
                appData.currentUser.avatar = `https://ui-avatars.com/api/?name=${encodeURIComponent(appData.currentUser.name)}&background=ff2d55&color=fff&size=128`;
            }
            
            // Initialiser les posts avec les données utilisateur
            appData.posts.forEach(post => {
                const user = appData.users.find(u => u.id === post.userId);
                if (user) {
                    post.user = user;
                }
            });
            
            // Initialiser les vidéos verticales
            appData.verticalVideos.forEach(video => {
                const user = appData.users.find(u => u.id === video.userId);
                if (user) {
                    video.user = user;
                }
            });
            
            // Initialiser les stories avec les données utilisateur
            appData.stories.forEach(story => {
                const user = appData.users.find(u => u.id === story.userId);
                if (user) {
                    story.user = user;
                }
            });
            
            // Initialiser les conversations avec les données utilisateur
            appData.conversations.forEach(conversation => {
                const user = appData.users.find(u => u.id === conversation.userId);
                if (user) {
                    conversation.user = user;
                }
            });
        }

        function getRandomColor() {
            const colors = ['ff2d55', '5856d6', '32d74b', 'ff9500', 'ffcc00', '5ac8fa', '007aff'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // Navigation entre pages
        function setupNavigation() {
            navItems.forEach(item => {
                if (!item.classList.contains('camera')) {
                    item.addEventListener('click', function(e) {
                        e.preventDefault();
                        const page = this.dataset.page;
                        
                        if (page !== currentPage) {
                            // Mettre à jour l'état actif
                            navItems.forEach(nav => nav.classList.remove('active'));
                            this.classList.add('active');
                            
                            // Changer de page
                            pages.forEach(p => p.classList.remove('active'));
                            document.getElementById(page + 'Page').classList.add('active');
                            currentPage = page;
                            
                            // Redémarrer le carousel si jeux
                            if (page === 'games') {
                                startCarousel();
                            }
                            
                            // Charger les vidéos YouTube si c'est la page YouTube
                            if (page === 'youtube' && appData.youtubeVideos.length === 0) {
                                fetchYouTubeVideos('tendances');
                            }
                        }
                    });
                }
            });
            
            // Header profile click - Ouvre le profil
            headerProfile.addEventListener('click', () => {
                navItems.forEach(nav => nav.classList.remove('active'));
                pages.forEach(p => p.classList.remove('active'));
                profilePage.classList.add('active');
                currentPage = 'profile';
                updateProfilePage();
            });
            
            // Bouton caméra dans la navbar
            openCameraBtn.addEventListener('click', (e) => {
                e.preventDefault();
                openCamera();
            });
            
            // Bouton messagerie
            messagesBtn.addEventListener('click', () => {
                openMessagesModal();
            });
        }

        // Générer les stories améliorées
        function generateStories() {
            storiesContainer.innerHTML = '';
            
            // Ajouter story de l'utilisateur
            const userStory = appData.stories.find(s => s.userId === 1);
            const storyElement = document.createElement('div');
            storyElement.className = 'story';
            storyElement.innerHTML = `
                <div class="story-avatar my-story" id="addStoryBtn">
                    <i class="fas fa-plus"></i>
                </div>
                <div class="story-name">Votre story</div>
            `;
            storiesContainer.appendChild(storyElement);
            
            // Ajouter stories des autres utilisateurs
            appData.stories
                .filter(story => story.userId !== 1)
                .forEach(story => {
                    const user = appData.users.find(u => u.id === story.userId);
                    if (!user) return;
                    
                    const isSeen = story.seenBy.includes(1);
                    
                    const storyElement = document.createElement('div');
                    storyElement.className = `story ${isSeen ? 'seen' : ''}`;
                    storyElement.dataset.storyId = story.id;
                    storyElement.innerHTML = `
                        <div class="story-avatar">
                            ${story.mediaUrl ? 
                                `<img src="${story.mediaUrl}" alt="${user.name}">` : 
                                user.name.charAt(0)
                            }
                            ${story.isLive ? '<div class="story-live">LIVE</div>' : ''}
                        </div>
                        <div class="story-name">${user.name}</div>
                    `;
                    
                    storyElement.addEventListener('click', () => viewStory(story.id));
                    storiesContainer.appendChild(storyElement);
                });
                
            // Événement pour ajouter une story
            document.getElementById('addStoryBtn').addEventListener('click', () => {
                showNotification("Ouvrez la caméra pour ajouter une story");
                openCamera();
            });
        }

        function viewStory(storyId) {
            const story = appData.stories.find(s => s.id === storyId);
            if (!story) return;
            
            // Marquer comme vue
            if (!story.seenBy.includes(1)) {
                story.seenBy.push(1);
            }
            
            // Ouvrir la story
            if (story.type === 'image') {
                openFullscreenVideo(story.mediaUrl);
            } else if (story.type === 'video') {
                openFullscreenVideo(story.mediaUrl);
            }
        }

        // Générer le feed de vidéos avec système de followers et vidéos verticales
        function generateVideoFeed() {
            videoFeed.innerHTML = '';
            
            // Combiner les posts et les vidéos verticales
            const allPosts = [...appData.posts, ...appData.verticalVideos];
            
            // Trier par date
            allPosts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            allPosts.forEach((post, index) => {
                const user = post.user;
                const isLiked = appData.currentUser.likedPosts.includes(post.id);
                const isFollowing = appData.currentUser.followingUsers.includes(post.userId);
                const videoOrientation = post.videoOrientation || 'horizontal';
                
                const videoContainer = document.createElement('div');
                videoContainer.className = 'video-container';
                videoContainer.dataset.index = index;
                videoContainer.dataset.orientation = videoOrientation;
                
                videoContainer.innerHTML = `
                    <div class="video-wrapper">
                        ${post.type === 'video' ? `
                            <video class="video-player ${videoOrientation}" playsinline loop preload="auto" data-index="${index}">
                                <source src="${post.mediaUrl}" type="video/mp4">
                            </video>
                        ` : `
                            <img src="${post.mediaUrl}" class="video-player" style="width:100%;height:100%;object-fit:cover;">
                        `}
                    </div>
                    <div class="video-overlay">
                        <div class="video-info">
                            <div class="video-creator">
                                <div class="creator-avatar" data-user-id="${user.id}">
                                    ${user.avatar ? 
                                        `<img src="${user.avatar}" alt="${user.name}">` : 
                                        user.name.charAt(0)
                                    }
                                </div>
                                <div class="creator-info">
                                    <div class="creator-name" data-user-id="${user.id}">@${user.username}</div>
                                    <div class="creator-time">${formatTimeAgo(post.createdAt)} • ${post.location || ''}</div>
                                </div>
                                ${!isFollowing && user.id !== 1 ? `
                                    <button class="follow-btn follow-user-btn" data-user-id="${user.id}">
                                        Suivre
                                    </button>
                                ` : user.id !== 1 ? `
                                    <button class="follow-btn follow-user-btn following" data-user-id="${user.id}">
                                        Suivi
                                    </button>
                                ` : ''}
                            </div>
                            <div class="video-description">${post.caption}</div>
                            <div class="video-tags">
                                ${post.tags ? post.tags.map(tag => `<span class="tag">#${tag}</span>`).join('') : ''}
                            </div>
                        </div>
                    </div>
                    <div class="video-actions">
                        <button class="action-btn like-btn ${isLiked ? 'liked' : ''}" data-post-id="${post.id}">
                            <i class="${isLiked ? 'fas' : 'far'} fa-heart"></i>
                            <span>${formatNumber(post.likes)}</span>
                        </button>
                        <button class="action-btn comment-btn">
                            <i class="fas fa-comment"></i>
                            <span>${formatNumber(post.comments)}</span>
                        </button>
                        <button class="action-btn share-btn">
                            <i class="fas fa-share"></i>
                            <span>${formatNumber(post.shares)}</span>
                        </button>
                        ${post.type === 'video' ? `
                            <button class="action-btn fullscreen-btn" data-media="${post.mediaUrl}" data-orientation="${videoOrientation}">
                                <i class="fas fa-expand"></i>
                                <span>Plein écran</span>
                            </button>
                        ` : ''}
                        <button class="action-btn message-btn" data-user-id="${user.id}">
                            <i class="fas fa-comment"></i>
                            <span>Message</span>
                        </button>
                    </div>
                `;
                
                videoFeed.appendChild(videoContainer);
            });
            
            initVideoPlayers();
            setupVideoScrollSnap();
        }

        // Configurer le scroll snap pour les vidéos
        function setupVideoScrollSnap() {
            const videoContainers = document.querySelectorAll('.video-container');
            let isScrolling = false;
            let scrollTimeout;
            
            homePage.addEventListener('scroll', function() {
                if (!isScrolling) {
                    isScrolling = true;
                    
                    clearTimeout(scrollTimeout);
                    scrollTimeout = setTimeout(() => {
                        isScrolling = false;
                        
                        // Trouver la vidéo la plus proche du centre
                        const containerHeight = homePage.clientHeight;
                        const scrollTop = homePage.scrollTop;
                        
                        let closestIndex = 0;
                        let minDistance = Infinity;
                        
                        videoContainers.forEach((container, index) => {
                            const containerTop = container.offsetTop;
                            const distance = Math.abs(containerTop - scrollTop - containerHeight/2);
                            
                            if (distance < minDistance) {
                                minDistance = distance;
                                closestIndex = index;
                            }
                        });
                        
                        // Jouer la vidéo la plus proche
                        playVideoAt(closestIndex);
                        currentVideoIndex = closestIndex;
                    }, 100);
                }
            });
        }

        function playVideoAt(index) {
            // Pause toutes les vidéos
            document.querySelectorAll('.video-player').forEach(video => {
                if (video.pause) video.pause();
            });
            
            // Jouer la vidéo à l'index spécifié
            const video = document.querySelector(`.video-player[data-index="${index}"]`);
            if (video && video.play) {
                video.play().catch(e => console.log("Autoplay bloqué"));
            }
        }

        // Formatage du temps relatif
        function formatTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / (1000 * 60));
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            
            if (diffMins < 1) return "À l'instant";
            if (diffMins < 60) return `Il y a ${diffMins} min`;
            if (diffHours < 24) return `Il y a ${diffHours} h`;
            if (diffDays < 7) return `Il y a ${diffDays} j`;
            return date.toLocaleDateString('fr-FR');
        }

        // Générer la page Explorer
        function generateExplorePage() {
            explorePage.innerHTML = `
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" class="search-input" placeholder="Rechercher des vidéos, personnes...">
                </div>
                
                <div class="categories-grid">
                    ${appData.exploreCategories.map(category => `
                        <div class="category-card touch-feedback" data-category="${category.name}">
                            <div class="category-icon">
                                <i class="${category.icon}"></i>
                            </div>
                            <div class="category-title">${category.name}</div>
                            <div class="category-count">${category.count} vidéos</div>
                        </div>
                    `).join('')}
                </div>
                
                <div class="trending-section">
                    <div class="section-title">
                        <span>Tendances actuelles</span>
                        <a href="#" class="see-all">Voir tout</a>
                    </div>
                    
                    <div class="trending-grid">
                        ${appData.trendingPosts.map(post => `
                            <div class="trending-card touch-feedback">
                                <img src="${post.image}" alt="${post.name}" class="trending-image">
                                <div class="trending-info">
                                    <div class="trending-name">${post.name}</div>
                                    <div class="trending-stats">${post.views} vues</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            // Événements des catégories
            document.querySelectorAll('.category-card').forEach(card => {
                card.addEventListener('click', function() {
                    const category = this.dataset.category;
                    showNotification(`Recherche dans la catégorie: ${category}`);
                });
            });
        }

        // Générer la page YouTube
        function generateYouTubePage() {
            youtubePage.innerHTML = `
                <div class="youtube-header">
                    <div class="youtube-logo">
                        <i class="fab fa-youtube"></i>
                    </div>
                    <div class="youtube-title">YouTube</div>
                </div>
                
                <div class="youtube-search">
                    <input type="text" class="youtube-search-input" placeholder="Rechercher des vidéos..." id="youtubeSearchInput">
                    <button class="youtube-search-btn" id="youtubeSearchBtn">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                
                <div class="youtube-categories" id="youtubeCategories">
                    ${appData.youtubeCategories.map((category, index) => `
                        <div class="youtube-category ${index === 0 ? 'active' : ''}" data-category="${category}">
                            ${category}
                        </div>
                    `).join('')}
                </div>
                
                <div class="youtube-videos" id="youtubeVideos">
                    <div class="loading-video">
                        <i class="fab fa-youtube"></i>
                        <div style="margin-left: 10px;">Chargement des vidéos...</div>
                    </div>
                </div>
            `;
            
            setupYouTubePageEvents();
        }

        // Événements pour la page YouTube
        function setupYouTubePageEvents() {
            // Catégories
            const categories = document.querySelectorAll('.youtube-category');
            categories.forEach(category => {
                category.addEventListener('click', function() {
                    categories.forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    const selectedCategory = this.dataset.category;
                    
                    if (selectedCategory === 'Toutes') {
                        fetchYouTubeVideos('tendances');
                    } else {
                        fetchYouTubeVideos(selectedCategory);
                    }
                });
            });
            
            // Recherche
            const searchBtn = document.getElementById('youtubeSearchBtn');
            const searchInput = document.getElementById('youtubeSearchInput');
            
            searchBtn.addEventListener('click', () => {
                const query = searchInput.value.trim();
                if (query) {
                    fetchYouTubeVideos(query);
                }
            });
            
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const query = this.value.trim();
                    if (query) {
                        fetchYouTubeVideos(query);
                    }
                }
            });
        }

        // Récupérer les vidéos YouTube
        async function fetchYouTubeVideos(query = 'tendances') {
            if (isFetchingYouTube) return;
            
            isFetchingYouTube = true;
            
            const videosContainer = document.getElementById('youtubeVideos');
            videosContainer.innerHTML = `
                <div class="loading-video">
                    <i class="fab fa-youtube"></i>
                    <div style="margin-left: 10px;">Recherche de vidéos...</div>
                </div>
            `;
            
            try {
                const searchUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=20&q=${encodeURIComponent(query)}&type=video&key=${YOUTUBE_API_KEY}`;
                const response = await fetch(searchUrl);
                
                if (!response.ok) {
                    throw new Error(`Erreur API: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (!data.items || data.items.length === 0) {
                    videosContainer.innerHTML = `
                        <div class="loading-video">
                            <i class="fas fa-exclamation-circle"></i>
                            <div style="margin-left: 10px;">Aucune vidéo trouvée pour "${query}"</div>
                        </div>
                    `;
                    appData.youtubeVideos = [];
                    return;
                }
                
                const youtubeVideos = data.items.map(item => ({
                    id: item.id.videoId,
                    title: item.snippet.title,
                    channel: item.snippet.channelTitle,
                    channelInitial: item.snippet.channelTitle ? item.snippet.channelTitle.charAt(0).toUpperCase() : 'Y',
                    views: "0",
                    time: formatYouTubeDate(item.snippet.publishedAt),
                    thumbnail: item.snippet.thumbnails.medium ? item.snippet.thumbnails.medium.url : item.snippet.thumbnails.default.url,
                    videoId: item.id.videoId,
                    duration: "0:00"
                }));
                
                appData.youtubeVideos = youtubeVideos;
                updateYouTubeVideosDisplay(youtubeVideos);
                
            } catch (error) {
                console.error('Erreur YouTube API:', error);
                const fallbackVideos = getFallbackVideos(query);
                appData.youtubeVideos = fallbackVideos;
                updateYouTubeVideosDisplay(fallbackVideos);
                
                showNotification("Mode démo activé");
            } finally {
                isFetchingYouTube = false;
            }
        }

        function getFallbackVideos(query) {
            const fallbackVideos = [
                {
                    id: "yt1",
                    title: "TOP 10 Musiques du Moment 2024",
                    channel: "Music Hits",
                    channelInitial: "MH",
                    views: "2.4M",
                    time: "Il y a 2 jours",
                    thumbnail: "https://i.ytimg.com/vi/KfXvjxbRhZk/mqdefault.jpg",
                    videoId: "KfXvjxbRhZk",
                    duration: "15:24"
                },
                {
                    id: "yt2",
                    title: "Tutoriel Python - Apprendre en 1 heure",
                    channel: "Dev Academy",
                    channelInitial: "DA",
                    views: "1.8M",
                    time: "Il y a 1 semaine",
                    thumbnail: "https://i.ytimg.com/vi/_uQrJ0TkZlc/mqdefault.jpg",
                    videoId: "_uQrJ0TkZlc",
                    duration: "58:12"
                },
                {
                    id: "yt3",
                    title: "Les Meilleurs Moments Gaming 2024",
                    channel: "Gaming Clips",
                    channelInitial: "GC",
                    views: "3.2M",
                    time: "Il y a 3 jours",
                    thumbnail: "https://i.ytimg.com/vi/9bZkp7q19f0/mqdefault.jpg",
                    videoId: "9bZkp7q19f0",
                    duration: "24:36"
                }
            ];
            
            if (query && query !== 'tendances') {
                return fallbackVideos.filter(video => 
                    video.title.toLowerCase().includes(query.toLowerCase()) ||
                    video.channel.toLowerCase().includes(query.toLowerCase())
                );
            }
            
            return fallbackVideos;
        }

        function formatYouTubeDate(publishedAt) {
            const date = new Date(publishedAt);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return "Aujourd'hui";
            if (diffDays === 1) return "Il y a 1 jour";
            if (diffDays < 7) return `Il y a ${diffDays} jours`;
            if (diffDays < 30) return `Il y a ${Math.floor(diffDays / 7)} semaines`;
            if (diffDays < 365) return `Il y a ${Math.floor(diffDays / 30)} mois`;
            return `Il y a ${Math.floor(diffDays / 365)} ans`;
        }

        function updateYouTubeVideosDisplay(videos) {
            const videosContainer = document.getElementById('youtubeVideos');
            
            if (videos.length === 0) {
                videosContainer.innerHTML = `
                    <div class="loading-video">
                        <i class="fas fa-exclamation-circle"></i>
                        <div style="margin-left: 10px;">Aucune vidéo trouvée</div>
                    </div>
                `;
                return;
            }
            
            videosContainer.innerHTML = videos.map(video => `
                <div class="youtube-video-card touch-feedback" data-video-id="${video.videoId}">
                    <img src="${video.thumbnail}" alt="${video.title}" class="youtube-thumbnail">
                    <div class="youtube-video-info">
                        <div class="youtube-channel">
                            <div class="youtube-channel-avatar">${video.channelInitial}</div>
                            <div class="youtube-channel-name">${video.channel}</div>
                        </div>
                        <div class="youtube-video-title">${video.title}</div>
                        <div class="youtube-video-stats">
                            <span>${video.views} vues</span>
                            <span>•</span>
                            <span>${video.time}</span>
                        </div>
                    </div>
                </div>
            `).join('');
            
            const videoCards = document.querySelectorAll('.youtube-video-card');
            videoCards.forEach(card => {
                card.addEventListener('click', function() {
                    const videoId = this.dataset.videoId;
                    const video = videos.find(v => v.videoId === videoId);
                    if (video) openYouTubeVideo(video);
                });
            });
        }

        // Ouvrir une vidéo YouTube DANS L'APPLICATION
        function openYouTubeVideo(video) {
            currentYouTubeVideo = video;
            youtubeModalTitle.textContent = video.title;
            
            // URL YouTube intégrée SANS redirection
            const videoUrl = `https://www.youtube.com/embed/${video.videoId}?autoplay=1&rel=0&modestbranding=1&controls=1`;
            youtubePlayer.src = videoUrl;
            
            youtubeModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Générer la page Jeux
        function generateGamesPage() {
            const featuredGames = appData.games.slice(0, 3);
            
            gamesPage.innerHTML = `
                <div class="games-carousel">
                    <div class="carousel-title">Jeux en vedette</div>
                    <div class="carousel-container" id="carouselContainer">
                        ${featuredGames.map((game, index) => `
                            <div class="carousel-slide ${index === 0 ? 'active' : ''}" data-game-id="${game.id}">
                                <img src="${game.image}" alt="${game.title}" class="carousel-image">
                                <div class="carousel-overlay">
                                    <div class="carousel-game-title">${game.title}</div>
                                    <div class="carousel-game-desc">${game.description}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="carousel-dots" id="carouselDots">
                        ${featuredGames.map((_, index) => `
                            <div class="carousel-dot ${index === 0 ? 'active' : ''}" data-index="${index}"></div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="section-title">Tous les jeux</div>
                <div class="games-grid" id="gamesGrid">
                    ${appData.games.map(game => `
                        <div class="game-card touch-feedback" data-game-id="${game.id}">
                            <img src="${game.image}" alt="${game.title}" class="game-image">
                            <div class="game-info">
                                <div class="game-title">${game.title}</div>
                                <div class="game-category">${game.category}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            setupGamesEvents();
        }

        // Générer la page Profil
        function generateProfilePage() {
            updateProfilePage();
        }

        function updateProfilePage() {
            profilePage.innerHTML = `
                <div class="profile-header">
                    <div class="profile-top">
                        <div class="profile-avatar" id="profileAvatar">
                            ${appData.currentUser.avatar ? 
                                `<img src="${appData.currentUser.avatar}" alt="Avatar">` : 
                                appData.currentUser.name.charAt(0)
                            }
                            <div class="change-avatar" id="openProfileEdit">
                                <i class="fas fa-camera"></i>
                            </div>
                        </div>
                        <div class="profile-info">
                            <div class="profile-name" id="profileName">${appData.currentUser.name}</div>
                            <div class="profile-username" id="profileUsername">${appData.currentUser.username}</div>
                            <div class="profile-bio" id="profileBio">${appData.currentUser.bio}</div>
                            ${appData.currentUser.website ? 
                                `<div class="profile-website" id="profileWebsite" style="font-size: 0.9rem; color: var(--primary-color); margin-bottom: 15px;">
                                    <i class="fas fa-link"></i> ${appData.currentUser.website}
                                </div>` : ''
                            }
                            <div class="profile-stats">
                                <div class="stat" id="postsStat">
                                    <div class="stat-number" id="postsCount">${appData.currentUser.posts}</div>
                                    <div class="stat-label">Publications</div>
                                </div>
                                <div class="stat" id="followersStat">
                                    <div class="stat-number" id="followersCount">${formatNumber(appData.currentUser.followers)}</div>
                                    <div class="stat-label">Abonnés</div>
                                </div>
                                <div class="stat" id="followingStat">
                                    <div class="stat-number" id="followingCount">${appData.currentUser.following}</div>
                                    <div class="stat-label">Abonnements</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="profile-actions">
                        <button class="profile-btn btn-primary" id="editProfileBtn">Modifier le profil</button>
                        <button class="profile-btn btn-secondary" id="shareProfileBtn">Partager le profil</button>
                    </div>
                </div>
                
                <div class="profile-posts">
                    <div class="section-title">Mes publications</div>
                    <div class="posts-grid" id="postsGrid">
                        ${Array.from({length: appData.currentUser.posts}, (_, i) => `
                            <div class="post-thumbnail" style="background: linear-gradient(135deg, #${getRandomColor()}, #${getRandomColor()});"></div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            setupProfileEvents();
        }

        // Formater les nombres
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        // Initialiser les joueurs vidéo avec système de likes et follows
        function initVideoPlayers() {
            const videoElements = document.querySelectorAll('.video-player');
            videoPlayers = [];
            
            videoElements.forEach((video, index) => {
                if (video.tagName === 'VIDEO') {
                    videoPlayers[index] = video;
                    
                    // Configurer l'affichage en fonction de l'orientation
                    const container = video.closest('.video-container');
                    const orientation = container ? container.dataset.orientation : 'horizontal';
                    
                    if (orientation === 'vertical') {
                        video.classList.add('vertical');
                        video.classList.remove('horizontal');
                    } else {
                        video.classList.add('horizontal');
                        video.classList.remove('vertical');
                    }
                    
                    video.addEventListener('click', function() {
                        const mediaUrl = this.src || this.querySelector('source')?.src;
                        const orientation = this.classList.contains('vertical') ? 'vertical' : 'horizontal';
                        openFullscreenVideo(mediaUrl, orientation);
                    });
                }
                
                // Bouton like
                const likeBtn = document.querySelector(`.like-btn[data-post-id]`);
                if (likeBtn) {
                    likeBtn.addEventListener('click', function() {
                        const postId = parseInt(this.dataset.postId);
                        const allPosts = [...appData.posts, ...appData.verticalVideos];
                        const post = allPosts.find(p => p.id === postId);
                        const icon = this.querySelector('i');
                        const span = this.querySelector('span');
                        
                        if (post) {
                            const isLiked = appData.currentUser.likedPosts.includes(postId);
                            
                            if (isLiked) {
                                // Retirer le like
                                const likeIndex = appData.currentUser.likedPosts.indexOf(postId);
                                if (likeIndex > -1) {
                                    appData.currentUser.likedPosts.splice(likeIndex, 1);
                                }
                                post.likes--;
                                icon.classList.remove('fas');
                                icon.classList.add('far');
                                this.classList.remove('liked');
                            } else {
                                // Ajouter le like
                                appData.currentUser.likedPosts.push(postId);
                                post.likes++;
                                icon.classList.remove('far');
                                icon.classList.add('fas');
                                this.classList.add('liked');
                            }
                            
                            span.textContent = formatNumber(post.likes);
                        }
                    });
                }
                
                // Bouton follow
                const followBtn = document.querySelector(`.follow-user-btn[data-user-id]`);
                if (followBtn) {
                    followBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const userId = parseInt(this.dataset.userId);
                        const user = appData.users.find(u => u.id === userId);
                        
                        if (user) {
                            const isFollowing = appData.currentUser.followingUsers.includes(userId);
                            
                            if (isFollowing) {
                                // Arrêter de suivre
                                const followIndex = appData.currentUser.followingUsers.indexOf(userId);
                                if (followIndex > -1) {
                                    appData.currentUser.followingUsers.splice(followIndex, 1);
                                }
                                appData.currentUser.following--;
                                user.followers--;
                                this.textContent = 'Suivre';
                                this.classList.remove('following');
                                showNotification(`Vous ne suivez plus @${user.username}`);
                            } else {
                                // Commencer à suivre
                                appData.currentUser.followingUsers.push(userId);
                                appData.currentUser.following++;
                                user.followers++;
                                this.textContent = 'Suivi';
                                this.classList.add('following');
                                showNotification(`Vous suivez maintenant @${user.username}`);
                            }
                            
                            // Mettre à jour les compteurs
                            updateProfileCounters();
                        }
                    });
                }
                
                // Clic sur avatar ou nom d'utilisateur
                const creatorAvatar = document.querySelector(`.creator-avatar[data-user-id]`);
                const creatorName = document.querySelector(`.creator-name[data-user-id]`);
                
                if (creatorAvatar) {
                    creatorAvatar.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const userId = parseInt(this.dataset.userId);
                        openUserProfile(userId);
                    });
                }
                
                if (creatorName) {
                    creatorName.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const userId = parseInt(this.dataset.userId);
                        openUserProfile(userId);
                    });
                }
                
                // Bouton plein écran
                const fullscreenBtn = document.querySelector(`.fullscreen-btn[data-media]`);
                if (fullscreenBtn) {
                    fullscreenBtn.addEventListener('click', function() {
                        const mediaUrl = this.getAttribute('data-media');
                        const orientation = this.getAttribute('data-orientation') || 'horizontal';
                        openFullscreenVideo(mediaUrl, orientation);
                    });
                }
                
                // Bouton message
                const messageBtn = document.querySelector(`.message-btn[data-user-id]`);
                if (messageBtn) {
                    messageBtn.addEventListener('click', function() {
                        const userId = parseInt(this.dataset.userId);
                        startConversation(userId);
                    });
                }
            });
        }

        // Configurer l'autoplay des vidéos
        function setupVideoAutoplay() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const video = entry.target;
                    const index = parseInt(video.dataset.index);
                    
                    if (entry.isIntersecting) {
                        if (video.tagName === 'VIDEO') {
                            video.play().catch(e => console.log("Autoplay bloqué"));
                        }
                        currentVideoIndex = index;
                    } else {
                        if (video.tagName === 'VIDEO') {
                            video.pause();
                        }
                    }
                });
            }, {
                threshold: 0.8,
                rootMargin: '0px'
            });
            
            document.querySelectorAll('.video-player').forEach(video => {
                if (video.tagName === 'VIDEO') {
                    observer.observe(video);
                }
            });
        }

        // Carousel des jeux
        function startCarousel() {
            if (carouselInterval) clearInterval(carouselInterval);
            
            const slides = document.querySelectorAll('.carousel-slide');
            const dots = document.querySelectorAll('.carousel-dot');
            
            if (slides.length === 0) return;
            
            carouselInterval = setInterval(() => {
                carouselIndex = (carouselIndex + 1) % slides.length;
                updateCarousel();
            }, 4000);
            
            dots.forEach(dot => {
                dot.addEventListener('click', function() {
                    carouselIndex = parseInt(this.dataset.index);
                    updateCarousel();
                    clearInterval(carouselInterval);
                    carouselInterval = setInterval(() => {
                        carouselIndex = (carouselIndex + 1) % slides.length;
                        updateCarousel();
                    }, 4000);
                });
            });
            
            slides.forEach(slide => {
                slide.addEventListener('click', function() {
                    const gameId = parseInt(this.dataset.gameId);
                    const game = appData.games.find(g => g.id === gameId);
                    if (game) openGame(game);
                });
            });
        }

        function updateCarousel() {
            const slides = document.querySelectorAll('.carousel-slide');
            const dots = document.querySelectorAll('.carousel-dot');
            
            slides.forEach((slide, index) => {
                slide.classList.remove('active');
                if (index === carouselIndex) {
                    setTimeout(() => slide.classList.add('active'), 50);
                }
            });
            
            dots.forEach((dot, index) => {
                dot.classList.remove('active');
                if (index === carouselIndex) dot.classList.add('active');
            });
        }

        // Événements pour les jeux
        function setupGamesEvents() {
            const gameCards = document.querySelectorAll('.game-card');
            gameCards.forEach(card => {
                card.addEventListener('click', function() {
                    const gameId = parseInt(this.dataset.gameId);
                    const game = appData.games.find(g => g.id === gameId);
                    if (game) openGame(game);
                });
            });
        }

        // Ouvrir un jeu
        function openGame(game) {
            gameModalTitle.textContent = game.title;
            gameIframe.src = game.url;
            gameModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Événements pour le profil avec système followers/following
        function setupProfileEvents() {
            // Bouton modifier profil
            const editProfileBtn = document.getElementById('editProfileBtn');
            const openProfileEdit = document.getElementById('openProfileEdit');
            
            if (editProfileBtn) editProfileBtn.addEventListener('click', openProfileEditModal);
            if (openProfileEdit) openProfileEdit.addEventListener('click', openProfileEditModal);
            
            // Bouton partager profil
            const shareProfileBtn = document.getElementById('shareProfileBtn');
            if (shareProfileBtn) {
                shareProfileBtn.addEventListener('click', () => {
                    if (navigator.share) {
                        navigator.share({
                            title: `Profil de ${appData.currentUser.name}`,
                            text: `Découvrez le profil de ${appData.currentUser.name} sur MalGaz-Hub`,
                            url: window.location.href
                        });
                    } else {
                        showNotification("Lien du profil copié !");
                    }
                });
            }
            
            // Statistiques cliquables
            const postsStat = document.getElementById('postsStat');
            const followersStat = document.getElementById('followersStat');
            const followingStat = document.getElementById('followingStat');
            
            if (followersStat) {
                followersStat.addEventListener('click', () => showUsersList('followers'));
            }
            
            if (followingStat) {
                followingStat.addEventListener('click', () => showUsersList('following'));
            }
        }

        // Afficher liste followers/following
        function showUsersList(type) {
            let users = [];
            let title = '';
            
            if (type === 'followers') {
                // Simuler des followers (en réalité, ce serait les utilisateurs qui suivent l'utilisateur courant)
                users = appData.users.filter(user => 
                    user.id !== 1 && Math.random() > 0.5
                );
                title = 'Abonnés';
            } else if (type === 'following') {
                // Utilisateurs que l'utilisateur courant suit
                users = appData.users.filter(user => 
                    appData.currentUser.followingUsers.includes(user.id)
                );
                title = 'Abonnements';
            }
            
            usersListTitle.textContent = `${title} (${users.length})`;
            usersListContent.innerHTML = '';
            
            if (users.length === 0) {
                usersListContent.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                        <i class="fas fa-users" style="font-size: 3rem; margin-bottom: 15px;"></i>
                        <p>Aucun ${type === 'followers' ? 'abonné' : 'abonnement'} pour le moment</p>
                    </div>
                `;
            } else {
                users.forEach(user => {
                    const isFollowing = appData.currentUser.followingUsers.includes(user.id);
                    const userItem = document.createElement('div');
                    userItem.className = 'user-item';
                    userItem.innerHTML = `
                        <div class="user-info" data-user-id="${user.id}">
                            <div class="user-avatar">
                                ${user.avatar ? 
                                    `<img src="${user.avatar}" alt="${user.name}">` : 
                                    user.name.charAt(0)
                                }
                            </div>
                            <div class="user-details">
                                <h4>${user.name}</h4>
                                <p>${user.username}</p>
                                <p style="font-size: 0.75rem; color: var(--accent);">
                                    ${formatNumber(user.followers || 0)} abonnés
                                </p>
                            </div>
                        </div>
                        ${user.id !== 1 ? `
                            <button class="follow-action-btn ${isFollowing ? 'following' : ''}" data-user-id="${user.id}">
                                ${isFollowing ? 'Suivi' : 'Suivre'}
                            </button>
                        ` : ''}
                    `;
                    usersListContent.appendChild(userItem);
                });
                
                // Événements des boutons follow
                usersListContent.querySelectorAll('.follow-action-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const userId = parseInt(this.dataset.userId);
                        const user = appData.users.find(u => u.id === userId);
                        
                        if (user) {
                            const isFollowing = appData.currentUser.followingUsers.includes(userId);
                            
                            if (isFollowing) {
                                // Arrêter de suivre
                                const followIndex = appData.currentUser.followingUsers.indexOf(userId);
                                if (followIndex > -1) {
                                    appData.currentUser.followingUsers.splice(followIndex, 1);
                                }
                                appData.currentUser.following--;
                                user.followers--;
                                this.textContent = 'Suivre';
                                this.classList.remove('following');
                                showNotification(`Vous ne suivez plus @${user.username}`);
                            } else {
                                // Commencer à suivre
                                appData.currentUser.followingUsers.push(userId);
                                appData.currentUser.following++;
                                user.followers++;
                                this.textContent = 'Suivi';
                                this.classList.add('following');
                                showNotification(`Vous suivez maintenant @${user.username}`);
                            }
                            
                            updateProfileCounters();
                        }
                    });
                });
                
                // Clic sur les infos utilisateur pour ouvrir le profil
                usersListContent.querySelectorAll('.user-info').forEach(userInfo => {
                    userInfo.addEventListener('click', function() {
                        const userId = parseInt(this.dataset.userId);
                        openUserProfile(userId);
                    });
                });
            }
            
            usersListModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Ouvrir profil utilisateur
        function openUserProfile(userId) {
            const user = appData.users.find(u => u.id === userId);
            if (!user) return;
            
            currentViewedUser = user;
            userProfileTitle.textContent = user.username;
            
            const isFollowing = appData.currentUser.followingUsers.includes(userId);
            userProfileAction.textContent = isFollowing ? 'Suivi' : 'Suivre';
            userProfileAction.dataset.userId = userId;
            
            userProfileContent.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div class="profile-avatar-large">
                        ${user.avatar ? 
                            `<img src="${user.avatar}" alt="${user.name}">` : 
                            user.name.charAt(0)
                        }
                    </div>
                    <div style="margin-top: 15px;">
                        <h2 style="font-size: 1.5rem; font-weight: bold;">${user.name}</h2>
                        <p style="color: var(--text-secondary); margin-top: 5px;">${user.username}</p>
                        <p style="margin-top: 15px; line-height: 1.4;">${user.bio}</p>
                    </div>
                    <div style="display: flex; justify-content: center; gap: 30px; margin-top: 25px;">
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; font-weight: bold;">${user.posts || 0}</div>
                            <div style="font-size: 0.9rem; color: var(--text-secondary);">Publications</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; font-weight: bold;">${formatNumber(user.followers || 0)}</div>
                            <div style="font-size: 0.9rem; color: var(--text-secondary);">Abonnés</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; font-weight: bold;">${user.following || 0}</div>
                            <div style="font-size: 0.9rem; color: var(--text-secondary);">Abonnements</div>
                        </div>
                    </div>
                    <div style="margin-top: 25px;">
                        <button class="profile-btn btn-primary" id="messageUserBtn" style="width: 80%;" data-user-id="${user.id}">
                            <i class="fas fa-comment"></i> Envoyer un message
                        </button>
                    </div>
                </div>
            `;
            
            // Ajouter événement au bouton message
            setTimeout(() => {
                const messageBtn = document.getElementById('messageUserBtn');
                if (messageBtn) {
                    messageBtn.addEventListener('click', function() {
                        const userId = parseInt(this.dataset.userId);
                        startConversation(userId);
                        userProfileModal.classList.remove('active');
                    });
                }
            }, 100);
            
            userProfileModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Ouvrir modal édition profil
        function openProfileEditModal() {
            editName.value = appData.currentUser.name;
            editUsername.value = appData.currentUser.username;
            editBio.value = appData.currentUser.bio;
            editWebsite.value = appData.currentUser.website;
            
            editAvatarPreview.innerHTML = appData.currentUser.avatar ? 
                `<img src="${appData.currentUser.avatar}" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover;">` :
                appData.currentUser.name.charAt(0);
            
            editAvatarPreview.innerHTML += `
                <div class="change-avatar" id="changeAvatarBtn">
                    <i class="fas fa-camera"></i>
                </div>
            `;
            
            profileEditModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Configurer les événements
        function setupEventListeners() {
            setupNavigation();
            
            // Caméra
            closeCameraBtn.addEventListener('click', closeCamera);
            switchCameraBtn.addEventListener('click', switchCamera);
            toggleFlash.addEventListener('click', toggleFlashMode);
            videoModeBtn.addEventListener('click', toggleVideoMode);
            galleryBtn.addEventListener('click', openGallery);
            
            // Capture
            captureBtn.addEventListener('click', captureMedia);
            
            // Publication
            addPhotoBtn.addEventListener('click', () => openFilePicker('image'));
            addVideoBtn.addEventListener('click', () => openFilePicker('video'));
            
            closePostModal.addEventListener('click', () => {
                postModal.classList.remove('active');
                document.body.style.overflow = 'auto';
                resetPostModal();
            });
            
            publishPostBtn.addEventListener('click', publishPost);
            
            // Profil utilisateur
            closeUserProfile.addEventListener('click', () => {
                userProfileModal.classList.remove('active');
                document.body.style.overflow = 'auto';
                currentViewedUser = null;
            });
            
            userProfileAction.addEventListener('click', function() {
                if (currentViewedUser) {
                    const userId = currentViewedUser.id;
                    const isFollowing = appData.currentUser.followingUsers.includes(userId);
                    
                    if (isFollowing) {
                        // Arrêter de suivre
                        const followIndex = appData.currentUser.followingUsers.indexOf(userId);
                        if (followIndex > -1) {
                            appData.currentUser.followingUsers.splice(followIndex, 1);
                        }
                        appData.currentUser.following--;
                        currentViewedUser.followers--;
                        this.textContent = 'Suivre';
                        showNotification(`Vous ne suivez plus @${currentViewedUser.username}`);
                    } else {
                        // Commencer à suivre
                        appData.currentUser.followingUsers.push(userId);
                        appData.currentUser.following++;
                        currentViewedUser.followers++;
                        this.textContent = 'Suivi';
                        showNotification(`Vous suivez maintenant @${currentViewedUser.username}`);
                    }
                    
                    updateProfileCounters();
                }
            });
            
            // Profil édition
            closeProfileEdit.addEventListener('click', () => {
                profileEditModal.classList.remove('active');
                document.body.style.overflow = 'auto';
            });
            
            saveProfileBtn.addEventListener('click', saveProfile);
            changeAvatarBtn.addEventListener('click', () => avatarInput.click());
            
            avatarInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) handleAvatarUpload(file);
            });
            
            // Jeux
            closeGameModal.addEventListener('click', () => {
                gameModal.classList.remove('active');
                gameIframe.src = '';
                document.body.style.overflow = 'auto';
            });
            
            // YouTube
            closeYouTubeModal.addEventListener('click', () => {
                youtubeModal.classList.remove('active');
                youtubePlayer.src = '';
                document.body.style.overflow = 'auto';
            });
            
            // Users list
            closeUsersList.addEventListener('click', () => {
                usersListModal.classList.remove('active');
                document.body.style.overflow = 'auto';
            });
            
            // Messagerie
            closeMessages.addEventListener('click', closeMessagesModal);
            newMessageBtn.addEventListener('click', showNewMessageModal);
            sendMessageBtn.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // Fullscreen video
            closeFullscreenBtn.addEventListener('click', () => {
                fullscreenVideo.classList.remove('active');
                fullscreenVideoPlayer.pause();
                fullscreenVideoPlayer.src = '';
                
                if (videoPlayers[currentVideoIndex]) {
                    videoPlayers[currentVideoIndex].play().catch(e => console.log("Autoplay bloqué"));
                }
            });
        }

        // Configurer la caméra AVANT/ARRIÈRE avec orientation verticale
        async function setupCamera() {
            try {
                const constraints = {
                    video: { 
                        facingMode: isFrontCamera ? 'user' : 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 },
                        aspectRatio: { ideal: 9/16 } // Forcer le format portrait
                    }, 
                    audio: false 
                };
                
                if (mediaStream) {
                    mediaStream.getTracks().forEach(track => track.stop());
                }
                
                mediaStream = await navigator.mediaDevices.getUserMedia(constraints);
                cameraFeed.srcObject = mediaStream;
                
                // Appliquer le miroir pour la caméra frontale
                cameraFeed.classList.remove('front', 'back');
                cameraFeed.classList.add(isFrontCamera ? 'front' : 'back');
                cameraFeed.classList.add('portrait');
                
            } catch (err) {
                console.log("Erreur caméra:", err);
                cameraFeed.style.display = 'none';
                cameraView.innerHTML += `
                    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #333; color: white; flex-direction: column;">
                        <i class="fas fa-camera" style="font-size: 3rem; margin-bottom: 20px;"></i>
                        <p>Caméra simulée</p>
                        <p style="font-size: 0.8rem; opacity: 0.7;">Utilisez votre caméra réelle</p>
                    </div>
                `;
            }
        }

        // Changer de caméra
        function switchCamera() {
            isFrontCamera = !isFrontCamera;
            setupCamera();
            showNotification(`Caméra ${isFrontCamera ? 'avant' : 'arrière'} activée`);
        }

        // Activer/désactiver flash
        function toggleFlashMode() {
            flashEnabled = !flashEnabled;
            const icon = toggleFlash.querySelector('i');
            if (flashEnabled) {
                icon.style.color = '#ffcc00';
                showNotification("Flash activé");
            } else {
                icon.style.color = 'white';
                showNotification("Flash désactivé");
            }
        }

        // Basculer mode photo/vidéo
        function toggleVideoMode() {
            isVideoMode = !isVideoMode;
            const icon = videoModeBtn.querySelector('i');
            if (isVideoMode) {
                icon.style.color = 'var(--primary-color)';
                captureBtn.style.background = 'var(--primary-color)';
                showNotification("Mode vidéo activé");
            } else {
                icon.style.color = 'white';
                captureBtn.style.background = 'white';
                showNotification("Mode photo activé");
            }
        }

        // Ouvrir la caméra
        function openCamera() {
            cameraContainer.classList.remove('hidden');
            mainContent.classList.remove('active');
            document.body.style.overflow = 'hidden';
            
            // Démarrer la caméra si pas déjà fait
            if (!mediaStream) {
                setupCamera();
            }
        }

        // Fermer la caméra
        function closeCamera() {
            cameraContainer.classList.add('hidden');
            mainContent.classList.add('active');
            document.body.style.overflow = 'auto';
            
            // Arrêter l'enregistrement si en cours
            if (isRecording) {
                stopRecording();
            }
        }

        // Ouvrir la galerie
        function openGallery() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*,video/*';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) handleMediaSelection(file);
            };
            input.click();
        }

        // Sélectionner média depuis galerie
        function handleMediaSelection(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                capturedMedia = e.target.result;
                capturedMediaType = file.type.startsWith('video') ? 'video' : 'image';
                closeCamera();
                openPostModal();
            };
            reader.readAsDataURL(file);
        }

        // Capturer photo ou vidéo
        function captureMedia() {
            if (isVideoMode) {
                if (!isRecording) {
                    startRecording();
                } else {
                    stopRecording();
                }
            } else {
                capturePhoto();
            }
        }

        // Capturer une photo
        function capturePhoto() {
            const canvas = document.createElement('canvas');
            const video = cameraFeed;
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            const ctx = canvas.getContext('2d');
            
            // Appliquer le miroir si caméra frontale
            if (isFrontCamera) {
                ctx.translate(canvas.width, 0);
                ctx.scale(-1, 1);
            }
            
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Ajouter un filtre ou effet si flash activé
            if (flashEnabled) {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
            
            capturedMedia = canvas.toDataURL('image/jpeg');
            capturedMediaType = 'image';
            
            closeCamera();
            openPostModal();
        }

        // Démarrer l'enregistrement vidéo
        function startRecording() {
            if (!mediaStream) return;
            
            recordedChunks = [];
            
            try {
                mediaRecorder = new MediaRecorder(mediaStream);
                
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    capturedMedia = URL.createObjectURL(blob);
                    capturedMediaType = 'video';
                    
                    closeCamera();
                    openPostModal();
                };
                
                mediaRecorder.start();
                isRecording = true;
                captureBtn.classList.add('recording');
                showNotification("Enregistrement en cours...");
                
            } catch (err) {
                console.error("Erreur enregistrement:", err);
                showNotification("Erreur d'enregistrement");
            }
        }

        // Arrêter l'enregistrement
        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                captureBtn.classList.remove('recording');
                showNotification("Vidéo enregistrée");
            }
        }

        // Ouvrir sélecteur de fichier
        function openFilePicker(type) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = type === 'video' ? 'video/*' : 'image/*';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        capturedMedia = e.target.result;
                        capturedMediaType = type;
                        updateMediaPreview();
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }

        // Ouvrir modal publication
        function openPostModal() {
            // Mettre à jour l'avatar et nom d'utilisateur
            postUserAvatar.innerHTML = appData.currentUser.avatar ? 
                `<img src="${appData.currentUser.avatar}" alt="${appData.currentUser.name}">` :
                appData.currentUser.name.charAt(0);
            postUserName.textContent = appData.currentUser.name;
            
            // Mettre à jour l'aperçu média
            updateMediaPreview();
            
            postModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Mettre à jour l'aperçu média
        function updateMediaPreview() {
            if (capturedMedia) {
                if (capturedMediaType === 'image') {
                    mediaPreview.innerHTML = `
                        <img src="${capturedMedia}" alt="Aperçu photo">
                        <button class="remove-media" id="removeMedia">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                } else {
                    mediaPreview.innerHTML = `
                        <video src="${capturedMedia}" controls style="width:100%;height:100%;object-fit:contain;"></video>
                        <button class="remove-media" id="removeMedia">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                }
                
                // Événement pour supprimer le média
                document.getElementById('removeMedia').addEventListener('click', (e) => {
                    e.stopPropagation();
                    capturedMedia = null;
                    capturedMediaType = 'image';
                    mediaPreview.innerHTML = `
                        <div style="text-align: center; color: var(--text-secondary);">
                            <i class="fas fa-image" style="font-size: 3rem; margin-bottom: 10px;"></i>
                            <p>Aperçu de votre média</p>
                        </div>
                    `;
                });
            }
        }

        // Réinitialiser modal publication
        function resetPostModal() {
            capturedMedia = null;
            capturedMediaType = 'image';
            postCaption.value = '';
            mediaPreview.innerHTML = `
                <div style="text-align: center; color: var(--text-secondary);">
                    <i class="fas fa-image" style="font-size: 3rem; margin-bottom: 10px;"></i>
                    <p>Aperçu de votre média</p>
                </div>
            `;
        }

        // Publier une photo/vidéo
        function publishPost() {
            const caption = postCaption.value.trim();
            
            if (!capturedMedia) {
                showNotification("Veuillez sélectionner une photo ou une vidéo");
                return;
            }
            
            // Déterminer l'orientation de la vidéo
            let videoOrientation = 'horizontal';
            if (capturedMediaType === 'video') {
                // En mode démo, on suppose que les vidéos de l'utilisateur sont verticales
                videoOrientation = 'vertical';
            }
            
            // Créer un nouveau post
            const newPost = {
                id: appData.posts.length + appData.verticalVideos.length + 1,
                userId: 1,
                type: capturedMediaType,
                mediaUrl: capturedMedia,
                caption: caption || "Nouvelle publication",
                likes: 0,
                comments: 0,
                shares: 0,
                createdAt: new Date(),
                tags: extractTags(caption),
                location: "Paris, France",
                user: appData.users.find(u => u.id === 1),
                videoOrientation: videoOrientation
            };
            
            // Ajouter le post
            if (capturedMediaType === 'video' && videoOrientation === 'vertical') {
                appData.verticalVideos.unshift(newPost);
            } else {
                appData.posts.unshift(newPost);
            }
            
            // Mettre à jour le compteur de posts
            appData.currentUser.posts++;
            
            // Créer une story si c'est une image
            if (capturedMediaType === 'image') {
                const newStory = {
                    id: appData.stories.length + 1,
                    userId: 1,
                    type: 'image',
                    mediaUrl: capturedMedia,
                    createdAt: new Date(),
                    seenBy: [],
                    isLive: false
                };
                appData.stories.unshift(newStory);
            }
            
            // Fermer le modal
            postModal.classList.remove('active');
            document.body.style.overflow = 'auto';
            
            // Réinitialiser
            resetPostModal();
            
            // Mettre à jour l'affichage
            updateProfileCounters();
            generateVideoFeed();
            generateStories();
            setupVideoAutoplay();
            
            showNotification("Publication ajoutée avec succès !");
            
            // Retourner à l'accueil
            setTimeout(() => {
                navItems.forEach(nav => nav.classList.remove('active'));
                navItems[0].classList.add('active');
                pages.forEach(p => p.classList.remove('active'));
                homePage.classList.add('active');
                currentPage = 'home';
            }, 500);
        }

        // Extraire les tags du texte
        function extractTags(text) {
            if (!text) return [];
            const tags = text.match(/#[\w\u00C0-\u017F]+/g) || [];
            return tags.map(tag => tag.slice(1)).slice(0, 4);
        }

        // Gérer l'upload d'avatar
        function handleAvatarUpload(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                appData.currentUser.avatar = e.target.result;
                updateProfileDisplay();
                updateHeaderProfile();
                showNotification("Photo de profil mise à jour");
            };
            reader.readAsDataURL(file);
        }

        // Sauvegarder le profil
        function saveProfile() {
            appData.currentUser.name = editName.value;
            appData.currentUser.username = editUsername.value;
            appData.currentUser.bio = editBio.value;
            appData.currentUser.website = editWebsite.value;
            
            // Générer un nouvel avatar si pas d'upload
            if (!appData.currentUser.avatar) {
                appData.currentUser.avatar = `https://ui-avatars.com/api/?name=${encodeURIComponent(appData.currentUser.name)}&background=${getRandomColor()}&color=fff&size=128`;
            }
            
            updateProfileDisplay();
            updateHeaderProfile();
            profileEditModal.classList.remove('active');
            document.body.style.overflow = 'auto';
            
            showNotification("Profil mis à jour !");
        }

        // Mettre à jour l'affichage du profil
        function updateProfileDisplay() {
            const profileName = document.getElementById('profileName');
            const profileUsername = document.getElementById('profileUsername');
            const profileBio = document.getElementById('profileBio');
            const profileWebsite = document.getElementById('profileWebsite');
            const profileAvatar = document.getElementById('profileAvatar');
            const postsCount = document.getElementById('postsCount');
            const followersCount = document.getElementById('followersCount');
            const followingCount = document.getElementById('followingCount');
            
            if (profileName) profileName.textContent = appData.currentUser.name;
            if (profileUsername) profileUsername.textContent = appData.currentUser.username;
            if (profileBio) profileBio.textContent = appData.currentUser.bio;
            if (postsCount) postsCount.textContent = appData.currentUser.posts;
            if (followersCount) followersCount.textContent = formatNumber(appData.currentUser.followers);
            if (followingCount) followingCount.textContent = appData.currentUser.following;
            
            if (profileAvatar) {
                profileAvatar.innerHTML = appData.currentUser.avatar ? 
                    `<img src="${appData.currentUser.avatar}" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover;">` :
                    appData.currentUser.name.charAt(0);
                profileAvatar.innerHTML += `
                    <div class="change-avatar" id="openProfileEdit">
                        <i class="fas fa-camera"></i>
                    </div>
                `;
            }
            
            if (profileWebsite) {
                if (appData.currentUser.website) {
                    profileWebsite.innerHTML = `<i class="fas fa-link"></i> ${appData.currentUser.website}`;
                } else {
                    profileWebsite.innerHTML = '';
                }
            }
        }

        // Mettre à jour les compteurs du profil
        function updateProfileCounters() {
            const followersCount = document.getElementById('followersCount');
            const followingCount = document.getElementById('followingCount');
            
            if (followersCount) followersCount.textContent = formatNumber(appData.currentUser.followers);
            if (followingCount) followingCount.textContent = appData.currentUser.following;
        }

        // Mettre à jour le header avec le profil
        function updateHeaderProfile() {
            if (appData.currentUser.avatar) {
                headerAvatar.innerHTML = `<img src="${appData.currentUser.avatar}" alt="${appData.currentUser.name}" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">`;
            } else {
                headerAvatar.textContent = appData.currentUser.name.charAt(0);
            }
        }

        // Ouvrir vidéo plein écran
        function openFullscreenVideo(mediaUrl, orientation = 'horizontal') {
            fullscreenVideoPlayer.src = mediaUrl;
            fullscreenVideo.classList.add('active');
            fullscreenVideoPlayer.play();
            
            // Appliquer le style en fonction de l'orientation
            if (orientation === 'vertical') {
                fullscreenVideoPlayer.style.objectFit = 'cover';
                fullscreenVideoPlayer.style.width = 'auto';
                fullscreenVideoPlayer.style.height = '100%';
            } else {
                fullscreenVideoPlayer.style.objectFit = 'contain';
                fullscreenVideoPlayer.style.width = '100%';
                fullscreenVideoPlayer.style.height = 'auto';
            }
            
            // Pause toutes les vidéos en cours
            videoPlayers.forEach(video => {
                if (video && video.pause) video.pause();
            });
        }

        // MESSAGERIE
        function generateConversationsList() {
            conversationsList.innerHTML = '';
            
            if (appData.conversations.length === 0) {
                conversationsList.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                        <i class="fas fa-comments" style="font-size: 3rem; margin-bottom: 15px;"></i>
                        <p>Aucune conversation</p>
                        <p style="font-size: 0.9rem;">Commencez une nouvelle conversation</p>
                    </div>
                `;
                return;
            }
            
            appData.conversations.forEach(conversation => {
                const user = conversation.user;
                const lastMessageTime = formatTimeAgo(conversation.lastMessageTime);
                
                const conversationElement = document.createElement('div');
                conversationElement.className = 'conversation-item';
                conversationElement.dataset.conversationId = conversation.id;
                conversationElement.innerHTML = `
                    <div class="conversation-avatar">
                        ${user.avatar ? 
                            `<img src="${user.avatar}" alt="${user.name}">` : 
                            user.name.charAt(0)
                        }
                    </div>
                    <div class="conversation-info">
                        <div class="conversation-name">${user.name}</div>
                        <div class="conversation-last-message">${conversation.lastMessage}</div>
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 5px;">
                        <div class="conversation-time">${lastMessageTime}</div>
                        ${conversation.unread > 0 ? `
                            <div class="unread-badge">${conversation.unread}</div>
                        ` : ''}
                    </div>
                `;
                
                conversationElement.addEventListener('click', () => openChat(conversation.id));
                conversationsList.appendChild(conversationElement);
            });
        }

        function openMessagesModal() {
            messagesModal.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Afficher la liste des conversations
            chatContainer.style.display = 'none';
            conversationsList.style.display = 'block';
            isInChat = false;
            
            // Mettre à jour le badge
            updateMessagesBadge();
        }

        function closeMessagesModal() {
            messagesModal.classList.remove('active');
            document.body.style.overflow = 'auto';
            isInChat = false;
        }

        function openChat(conversationId) {
            const conversation = appData.conversations.find(c => c.id === conversationId);
            if (!conversation) return;
            
            currentConversation = conversation;
            
            // Mettre à jour l'en-tête du chat
            chatHeader.innerHTML = `
                <div class="chat-avatar">
                    ${conversation.user.avatar ? 
                        `<img src="${conversation.user.avatar}" alt="${conversation.user.name}">` : 
                        conversation.user.name.charAt(0)
                    }
                </div>
                <div class="chat-user-info">
                    <h3>${conversation.user.name}</h3>
                    <p>En ligne</p>
                </div>
            `;
            
            // Afficher les messages
            updateMessagesDisplay();
            
            // Basculer vers le chat
            conversationsList.style.display = 'none';
            chatContainer.style.display = 'flex';
            isInChat = true;
            
            // Marquer les messages comme lus
            conversation.unread = 0;
            updateMessagesBadge();
        }

        function updateMessagesDisplay() {
            if (!currentConversation) return;
            
            messagesContainer.innerHTML = '';
            
            currentConversation.messages.forEach(message => {
                const isSent = message.senderId === 1;
                const messageTime = formatTimeAgo(message.time);
                
                const messageElement = document.createElement('div');
                messageElement.className = `message ${isSent ? 'sent' : 'received'}`;
                messageElement.innerHTML = `
                    <div class="message-text">${message.text}</div>
                    <div class="message-time">${messageTime}</div>
                `;
                
                messagesContainer.appendChild(messageElement);
            });
            
            // Scroller vers le bas
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function sendMessage() {
            const text = chatInput.value.trim();
            if (!text || !currentConversation) return;
            
            // Créer le nouveau message
            const newMessage = {
                id: currentConversation.messages.length + 1,
                senderId: 1,
                text: text,
                time: new Date(),
                read: true
            };
            
            // Ajouter au tableau de messages
            currentConversation.messages.push(newMessage);
            currentConversation.lastMessage = text;
            currentConversation.lastMessageTime = new Date();
            
            // Mettre à jour l'affichage
            updateMessagesDisplay();
            
            // Réinitialiser l'input
            chatInput.value = '';
            
            // Mettre à jour la liste des conversations
            generateConversationsList();
            
            // Simuler une réponse après 1 seconde
            setTimeout(() => {
                const replyMessage = {
                    id: currentConversation.messages.length + 1,
                    senderId: currentConversation.userId,
                    text: getRandomReply(),
                    time: new Date(),
                    read: false
                };
                
                currentConversation.messages.push(replyMessage);
                currentConversation.lastMessage = replyMessage.text;
                currentConversation.lastMessageTime = new Date();
                currentConversation.unread = (currentConversation.unread || 0) + 1;
                
                updateMessagesDisplay();
                generateConversationsList();
                updateMessagesBadge();
            }, 1000);
        }

        function getRandomReply() {
            const replies = [
                "Salut! Ça va?",
                "Super vidéo!",
                "Merci pour ton message!",
                "Je regarde ça!",
                "À bientôt!",
                "Très intéressant!",
                "D'accord, je note!",
                "Parfait!",
                "Je suis d'accord!",
                "Génial!"
            ];
            return replies[Math.floor(Math.random() * replies.length)];
        }

        function startConversation(userId) {
            const user = appData.users.find(u => u.id === userId);
            if (!user) return;
            
            // Vérifier si une conversation existe déjà
            let conversation = appData.conversations.find(c => c.userId === userId);
            
            if (!conversation) {
                // Créer une nouvelle conversation
                conversation = {
                    id: appData.conversations.length + 1,
                    userId: userId,
                    lastMessage: "Nouvelle conversation",
                    lastMessageTime: new Date(),
                    unread: 0,
                    messages: [],
                    user: user
                };
                
                appData.conversations.push(conversation);
            }
            
            // Ouvrir la messagerie et le chat
            messagesModal.classList.add('active');
            document.body.style.overflow = 'hidden';
            openChat(conversation.id);
        }

        function showNewMessageModal() {
            const usersToMessage = appData.users.filter(user => 
                user.id !== 1 && !appData.conversations.some(c => c.userId === user.id)
            );
            
            if (usersToMessage.length === 0) {
                showNotification("Vous avez déjà une conversation avec tous les utilisateurs");
                return;
            }
            
            // Créer une liste d'utilisateurs pour démarrer une nouvelle conversation
            const modalContent = document.createElement('div');
            modalContent.style.padding = '20px';
            modalContent.innerHTML = `
                <h3 style="margin-bottom: 20px;">Nouveau message</h3>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    ${usersToMessage.map(user => `
                        <div class="user-item" data-user-id="${user.id}" style="cursor: pointer;">
                            <div class="user-info">
                                <div class="user-avatar">
                                    ${user.avatar ? 
                                        `<img src="${user.avatar}" alt="${user.name}">` : 
                                        user.name.charAt(0)
                                    }
                                </div>
                                <div class="user-details">
                                    <h4>${user.name}</h4>
                                    <p>${user.username}</p>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            // Remplacer temporairement le contenu
            const originalContent = messagesModal.querySelector('.messages-content');
            const originalHeader = messagesModal.querySelector('.messages-header');
            
            messagesModal.innerHTML = '';
            messagesModal.appendChild(originalHeader.cloneNode(true));
            messagesModal.appendChild(modalContent);
            
            // Mettre à jour les événements
            const closeBtn = messagesModal.querySelector('.camera-option');
            closeBtn.addEventListener('click', () => {
                messagesModal.classList.remove('active');
                document.body.style.overflow = 'auto';
                // Restaurer l'interface originale
                setTimeout(() => {
                    initApp();
                }, 100);
            });
            
            // Événements pour les utilisateurs
            modalContent.querySelectorAll('.user-item').forEach(item => {
                item.addEventListener('click', function() {
                    const userId = parseInt(this.dataset.userId);
                    startConversation(userId);
                });
            });
        }

        function updateMessagesBadge() {
            const totalUnread = appData.conversations.reduce((total, conv) => total + (conv.unread || 0), 0);
            const badge = messagesBtn.querySelector('.notification-badge');
            
            if (totalUnread > 0) {
                badge.style.display = 'block';
            } else {
                badge.style.display = 'none';
            }
        }

        // Afficher une notification
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                left: 50%;
                transform: translateX(-50%);
                background: var(--card-bg);
                color: var(--text-primary);
                padding: 12px 20px;
                border-radius: 12px;
                z-index: 9999;
                font-size: 0.9rem;
                border: 1px solid rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(20px);
                animation: slideIn 0.3s ease;
                max-width: 90%;
                text-align: center;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
            
            // Ajouter les animations CSS si pas déjà présentes
            if (!document.querySelector('#notification-animations')) {
                const style = document.createElement('style');
                style.id = 'notification-animations';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(-50%) translateY(-20px); opacity: 0; }
                        to { transform: translateX(-50%) translateY(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(-50%) translateY(0); opacity: 1; }
                        to { transform: translateX(-50%) translateY(-20px); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // Afficher l'indicateur de scroll
        function showScrollIndicator() {
            scrollIndicator.style.display = 'block';
            
            setTimeout(() => {
                scrollIndicator.style.display = 'none';
            }, 3000);
            
            // Masquer l'indicateur après le premier scroll
            homePage.addEventListener('scroll', function() {
                scrollIndicator.style.display = 'none';
            }, { once: true });
        }

        // Gestion du tactile mobile
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) e.preventDefault();
        }, { passive: false });

        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(e) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) e.preventDefault();
            lastTouchEnd = now;
        }, false);

        document.addEventListener('touchmove', function(e) {
            if (e.scale && e.scale !== 1) e.preventDefault();
        }, { passive: false });

        window.addEventListener('orientationchange', function() {
            setTimeout(() => {
                videoPlayers.forEach(video => {
                    if (video) video.style.height = '100%';
                });
                setVH();
            }, 300);
        });

        // Nettoyer les streams à la fermeture
        window.addEventListener('beforeunload', function() {
            if (mediaStream) {
                mediaStream.getTracks().forEach(track => track.stop());
            }
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
            }
        });

        // Pour iOS - Désactiver le zoom avec deux doigts
        document.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        });
    </script>
</body>
</html>
